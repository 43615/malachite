use malachite_base::num::arithmetic::traits::{EqModPowerOfTwo, ModPowerOfTwo};
use malachite_base::num::basic::integers::PrimitiveInteger;
use malachite_base::num::conversion::traits::WrappingFrom;
use malachite_nz::integer::Integer;
use malachite_nz::natural::arithmetic::div_exact::{
    _limbs_modular_div_divide_and_conquer, _limbs_modular_div_mod_divide_and_conquer,
    _limbs_modular_div_mod_schoolbook, _limbs_modular_div_schoolbook, limbs_modular_invert,
    limbs_modular_invert_scratch_len,
};
#[cfg(feature = "32_bit_limbs")]
use malachite_nz::natural::arithmetic::div_exact_limb::limbs_modular_invert_limb;
use malachite_nz::natural::Natural;
use malachite_nz::platform::Limb;

use common::{test_properties, test_properties_custom_scale};
use malachite_test::inputs::base::{
    pairs_of_unsigned_vec_var_12, quadruples_of_three_unsigned_vecs_and_unsigned_var_3,
    quadruples_of_three_unsigned_vecs_and_unsigned_var_4,
    quadruples_of_three_unsigned_vecs_and_unsigned_var_5,
    quadruples_of_three_unsigned_vecs_and_unsigned_var_6,
};

fn verify_limbs_modular_invert(ds: &[Limb], is: &[Limb]) {
    let d = Natural::from_limbs_asc(ds);
    let i = Natural::from_limbs_asc(is);
    let pow = u64::wrapping_from(ds.len()) << Limb::LOG_WIDTH;
    assert!((d * i).eq_mod_power_of_two(1 as Limb, pow));
}

#[cfg(feature = "32_bit_limbs")]
#[test]
fn test_limbs_modular_invert() {
    let test = |is_in: &[Limb], ds: &[Limb], is_out: &[Limb]| {
        let n = ds.len();
        let mut is = is_in.to_vec();
        let mut scratch = vec![0; limbs_modular_invert_scratch_len(n)];
        limbs_modular_invert(&mut is, ds, &mut scratch);
        assert_eq!(&is[..n], is_out);
        assert_eq!(&is[n..], &is_in[n..]);
        verify_limbs_modular_invert(ds, is_out);
    };
    // rn < DC_BDIV_Q_THRESHOLD
    test(&[10; 3], &[1], &[1]);
    test(&[10; 3], &[3], &[2863311531]);
    test(&[10; 3], &[5], &[3435973837]);
    test(&[10; 3], &[7], &[3067833783]);
    test(&[10; 3], &[1, 1, 1], &[1, 4294967295, 4294967295]);
    test(&[10; 4], &[1, 2, 3, 4], &[1, 4294967294, 0, 0]);
    test(&[10; 4], &[1, 0, 0, 0], &[1, 0, 0, 0]);
    test(&[10; 4], &[0xffff_ffff; 4], &[0xffff_ffff; 4]);
    // rn >= DC_BDIV_Q_THRESHOLD
    test(
        &[10; 162],
        &[
            3228372949, 511037199, 1766844847, 2482988267, 1469636570, 157644737, 1548533671,
            1988920387, 949768135, 3990423112, 2320976801, 2511643497, 3093682328, 3428374192,
            1438878145, 2361210316, 3906032124, 2138110309, 1599933050, 3823943671, 2259360130,
            823468722, 3291657189, 1273080994, 1300170623, 1148822796, 467501062, 3149282203,
            94789064, 4211146202, 938886545, 537979797, 2587941131, 108323731, 2067107670,
            105331677, 1935250512, 1452284826, 1800549345, 723680431, 2794168985, 904704921,
            3016862976, 1287705882, 4132038308, 624608496, 1997184254, 448598152, 1820893106,
            195416787, 651904977, 2955157364, 94342663, 437349382, 377636621, 3709576977,
            1757632127, 4278237941, 34068629, 2454145994, 4156002276, 3961922656, 2767617077,
            3288237973, 4240277740, 1356471757, 9181081, 1636990395, 1662834396, 626816820,
            2875878941, 921881987, 2158368015, 840508787, 3305037379, 3711054769, 1268398179,
            3896061030, 1052597619, 2040268853, 3162123944, 1619537254, 4260249983, 788774918,
            323831598, 70896907, 791692982, 1081190864, 2374371095, 1425732171, 2496438238,
            4066183598, 2164924109, 3370833658, 4001560838, 1910191661, 4219785120, 451095085,
            3421655677, 2108533585, 3424568374, 2891875753, 3180562301, 954785991, 2447015474,
            3930894331, 715625138, 2543510489, 360538720, 3774920082, 2598943309, 2345969301,
            1201240332, 3131955258, 115485203, 1731266015, 3565733667, 3708968152, 3343319896,
            4164543588, 958613110, 460381838, 508487067, 79603149, 4226757805, 2221491775,
            793628682, 2721231001, 1503226493, 3320680646, 536612991, 1986939605, 3925890122,
            953289772, 453639997, 3182429348, 3743006936, 4003692116, 1964545970, 4050648413,
            4076626036, 416351025, 1696831244, 3133590002, 1111664786, 2906324009, 1439094475,
            2214055485, 2798705323, 435684851, 3596001227, 3036344489, 3889898941, 1065048513,
            4016594719, 4180638855, 3698313403, 2650988185, 407962531, 3005112678, 4110843613,
            1265856698,
        ],
        &[
            991539581, 170886811, 1946164502, 4138638160, 4166973165, 3436035151, 3104724201,
            1844757770, 2340741284, 3474459530, 2913154637, 1985603183, 1490032629, 404439462,
            2516898868, 4063787328, 2068346028, 3562917355, 3607751063, 4085533551, 3185010719,
            4194162665, 3987252641, 3919902763, 1349071027, 3498237178, 1424577630, 2755258000,
            1356884618, 432658210, 1133331071, 1971536170, 609062776, 2584940413, 503389674,
            833096403, 2005416443, 873663129, 600036946, 1888391296, 3845065736, 2778213007,
            3174588960, 860483363, 3214125890, 241195760, 4142060378, 3524395685, 2521966985,
            3548302474, 4280709033, 1127351847, 3384545423, 1156416795, 2964727747, 2348926815,
            3088158836, 914441803, 741513463, 43888624, 3905516593, 2467124760, 57532003,
            2507495445, 3391285900, 917840688, 1449210608, 83470763, 2386746834, 518977089,
            2745927519, 1466192189, 1209060587, 1707570892, 1673078302, 921540600, 3312933158,
            503196443, 2601292096, 584811553, 315531478, 2613557634, 1029661810, 1565433701,
            2749963283, 797016668, 2524006881, 4144613766, 342648943, 3634335756, 2886479078,
            3729634162, 2446396883, 2646833057, 3809228466, 1241062391, 1771218854, 1859001695,
            181499665, 2243910284, 3135305341, 1144637960, 377778783, 462714009, 1503150032,
            2671008870, 2934075825, 1452005121, 869697216, 2087204075, 3565024128, 3030614795,
            4198797483, 4039346519, 601848748, 4060938550, 2096365943, 2015345784, 2227066926,
            2589779098, 2064017544, 3930785044, 572495510, 1372658164, 2267700924, 3842986739,
            1865979088, 727501730, 3530720452, 2082196229, 744666215, 1657468106, 1799434953,
            1390303492, 713826320, 92635671, 3263118136, 4104386251, 2272448841, 2859245350,
            3739570419, 2388112539, 2973693102, 2566815653, 909557454, 3719121807, 4178393753,
            2424198070, 1957898281, 1984544495, 1408061170, 3310277440, 1794952171, 452701329,
            3882836884, 3298396236, 3967258537, 162517223, 3293672996, 764489620, 714009670,
            31373948,
        ],
    );
    // rn >= BINV_NEWTON_THRESHOLD
    // rn < d_len
    test(
        &[10; 1_539],
        &[
            2598813973, 1904197782, 1215006787, 2930851058, 147918011, 1108782873, 2193711651,
            927233146, 4123817534, 3041706771, 2553964352, 2170557862, 2838589053, 2708835560,
            2407955329, 1653207324, 2470552742, 3357058396, 1072990020, 1514783799, 1734243804,
            1048851304, 3193592152, 1383793603, 2063694499, 3485786208, 990960024, 3569185429,
            1155708496, 1416333121, 623402323, 3585705881, 2928088588, 4117621841, 3292316347,
            2217241313, 1950216441, 1391040412, 2926386224, 3240560579, 3973468920, 2847202482,
            2728825575, 2388048350, 3463506691, 3707514927, 865702555, 681215612, 2250616248,
            1724513618, 364443494, 318451745, 1623887866, 1280032334, 35195442, 3837277484,
            3573894817, 1602810477, 2072874171, 3800895590, 4253419440, 3499691102, 3587932863,
            3517441378, 514856216, 1648457744, 1474005402, 700069688, 1803098596, 378514692,
            3068261379, 3834605983, 93188389, 516236732, 2468656032, 4095977127, 3706578522,
            3452719188, 1052956630, 813640425, 3047313546, 754584849, 3584789926, 347367947,
            1332536470, 94171148, 626270691, 665836088, 426974652, 749957497, 1566095325,
            3066600838, 4106843490, 318006871, 162882344, 3632111614, 720131390, 2147721707,
            2217002633, 2466031857, 1087787961, 753159680, 366300446, 3082468114, 3984408901,
            4057095635, 851983865, 4150513631, 1165194321, 2055798628, 2975996128, 2693369845,
            3726562839, 3482086133, 4069043610, 1448967233, 700979569, 1698695640, 2318799208,
            3684286306, 4092668018, 3628416641, 584456626, 1679287620, 1813093480, 177926224,
            998082621, 3120492909, 1996199168, 3491975384, 3147828383, 2087111449, 381360867,
            1127916110, 3472685226, 3293954452, 490729044, 3264678372, 1277191068, 4239255920,
            2343436004, 2451796708, 1844810428, 2031787164, 3768550378, 3743966167, 2637191163,
            3978079759, 4158883864, 1561267833, 539304561, 3435817790, 277956235, 4028949085,
            2643928548, 2755470882, 3796376394, 194519280, 98463778, 3179299980, 2447702226,
            150057260, 3463931601, 906456277, 990239469, 512339370, 2261507614, 2826877099,
            3855453279, 2271503686, 841719073, 1591142177, 2651714174, 3361609137, 3279250024,
            3326254458, 333896144, 3528172547, 3941409760, 1558812882, 3841874000, 3172301956,
            4257828380, 4114850067, 2182891616, 2046840523, 1555755083, 2209766728, 2332501890,
            607500373, 4124706810, 1713777506, 2341598661, 2284959418, 2746608689, 867377978,
            336903700, 2503448208, 701980251, 2377952035, 614377477, 4284955660, 3814775340,
            74129761, 1280559390, 2313692692, 1849232614, 2933185433, 1636271207, 630083065,
            433420841, 471362220, 4210050941, 406797277, 582028044, 528813510, 2576049278,
            540310007, 2789529550, 3534664845, 3236430259, 1506736021, 1977751182, 2006662671,
            3679126532, 3806292929, 322589328, 2243078958, 2178902647, 2189720772, 3791358339,
            1508304160, 1013509043, 3587377598, 3623382349, 1086144534, 1599008554, 1093927956,
            2876914186, 543927302, 2219667262, 3853928343, 2487266159, 2613372592, 3550686437,
            3716813778, 961453654, 2039051889, 4283100852, 3145660844, 1250225831, 198998794,
            3726057928, 2284062625, 2219120593, 2244278486, 3790941761, 4203700163, 3879487839,
            2965718505, 2863698764, 63056401, 475617471, 399914031, 459648012, 3133447831,
            3412742746, 1512219896, 402842103, 4119870394, 2231397283, 1516833787, 1104380754,
            128232714, 296865691, 1663298638, 716369560, 2904885147, 4237273250, 343946912,
            2604094031, 217784841, 1162604926, 1345215097, 1426555576, 3614102008, 3943750939,
            1639058309, 3296139198, 1330339563, 426593850, 1532081057, 1300177557, 1482433791,
            812987015, 3232993095, 1037853411, 645052957, 2928052694, 1226934622, 2336175954,
            1920836876, 2517428765, 3726338359, 4041660846, 2092081260, 3380258824, 1697518166,
            3349439761, 743024530, 1795639086, 1779094250, 503268222, 3554837208, 2986098469,
            2762697287, 232864157, 3768291070, 2983947152, 1577288457, 1050740564, 834028049,
            1274280907, 3769464765, 1910494593, 2197778112, 2813074316, 2881147492, 1559228213,
            1461309572, 1700587844, 2988103759, 1717431083, 951586291, 1707887130, 985013185,
            3532658879, 2597699341, 1911327175, 3080664111, 3484272917, 794091071, 2311407322,
            342113645, 1768703425, 2382063884, 3831832486, 3217975952, 3451120056, 3035392294,
            136312738, 1699608380, 700762772, 3631031559, 1846450824, 1131124755, 1046357323,
            2552828340, 2598371768, 795498120, 3174589062, 3838467339, 2334795665, 3324675939,
            3403942196, 2075108646, 4259667163, 545251542, 749294402, 3324014447, 1729518387,
            3551096145, 1758729590, 2379344936, 2455329109, 1757426268, 1706226190, 902425986,
            2432676044, 2039145952, 410402636, 1639537846, 1305863342, 256740017, 3207555620,
            3925040779, 668173470, 1141011911, 4212893794, 1581027147, 363670779, 2004465281,
            1138726957, 645471449, 3585049231, 2777598154, 2922780411, 2222055902, 3815639175,
            429697628, 4000303790, 3545345324, 3542109929, 509705074, 3722614775, 1753809005,
            1973665455, 3780943261, 2494678174, 2641931684, 3388813526, 3347201186, 619828405,
            2625911693, 3122659421, 3479474745, 3245356132, 1832479544, 3308783684, 1963028441,
            640786937, 1641844190, 211570630, 1733515651, 2171524601, 3396267685, 3914881000,
            996687218, 1617466047, 3343054134, 1737892381, 3544966831, 3416864496, 107959379,
            2249494870, 793869312, 3685840230, 1757287133, 1655716303, 4226516527, 2538565645,
            278467613, 2644886589, 2699974905, 1984329139, 1005957589, 789155264, 3666799939,
            1611583926, 809907316, 3452803056, 1107204019, 2209104411, 1462179962, 2853352142,
            3225410978, 2108213590, 4192481899, 1912371245, 1171525154, 3712460427, 2560727022,
            1086797266, 952026066, 685685805, 1936296543, 3499184244, 196202245, 3078070455,
            2171291372, 2730765878, 1573851700, 2931331934, 2847177501, 3478529515, 2313080814,
            1556316903, 1559216686, 3130885922, 1862119430, 3274978261, 206968409, 2624567354,
            1978029702, 4063454216, 2415324407, 1518621963, 747943965, 1111109939, 4070402813,
            3113587512, 898431887, 316373197, 3046639257, 173632841, 3798588025, 1794547053,
            272903937, 863380298, 2774736392, 2777149271, 3206794646, 32657715, 1025716581,
            1615425071, 3173842612, 2073903119, 2153824733, 2329799226, 2341967952, 473768936,
            3486256934, 2848218304, 2428724257, 3159637305, 2126501230, 765243196, 3425509759,
            1131263732, 2515711177, 3855554546, 1023477320, 787209967, 336492935, 2359162223,
            1128313353, 2209616384, 389804749, 535230248, 2210531774, 3227122449, 1267072928,
            675693308, 1385601874, 1416098547, 4192675028, 2716632450, 4177948782, 13560634,
            3703614488, 3901742123, 2270254077, 3759771486, 581228935, 3949774462, 3458012976,
            4163726158, 1602955605, 3047124020, 1612897320, 2437308530, 2370536309, 1561087937,
            2116794827, 1579558066, 431023695, 689842616, 2342172842, 4203138565, 2160272314,
            4192374041, 3675193896, 1455954294, 3940635994, 4025127357, 4027321239, 1155472117,
            1928138697, 1875048682, 4087308487, 4291614860, 1175537429, 3503698743, 2187471558,
            2673330725, 2702107217, 2763809959, 2274134903, 1077148334, 2166895545, 1831099412,
            3296218829, 2076626325, 1104984380, 1764164194, 3056784327, 1988083103, 3849746178,
            3460231757, 3983590507, 1641801163, 1321487487, 2277192156, 1700397327, 4163993314,
            118570737, 2510013157, 342313019, 328214482, 1456063300, 3771950632, 1226087686,
            2343733178, 1108934200, 3650307976, 118441436, 3857631518, 1808729865, 2826187782,
            2596972674, 1966611164, 988201436, 3909729734, 2034457184, 3137580128, 437202273,
            1431097330, 2630459633, 2423317302, 1422128850, 3011012632, 3611423092, 3531891566,
            1592039994, 734168534, 3492902008, 947200226, 1735249159, 3526990689, 1725556774,
            1693403463, 3317454666, 2042191731, 3608995702, 497650714, 628421679, 2465885637,
            4008542175, 68576338, 1372104957, 1927020046, 3573635655, 3090117252, 1774561696,
            3603424898, 55089895, 2060875413, 116850528, 183816573, 478639013, 3736973628,
            3606174188, 3086193394, 2548388100, 2591332019, 3032618195, 469584388, 1770142568,
            205800329, 174943950, 260521576, 2114953066, 3428041459, 860714084, 1560598053,
            2885505481, 3365355923, 2821218095, 814424502, 94258256, 2857874640, 3213633690,
            239445181, 1741311155, 70754202, 469749979, 469377271, 634558134, 1314018935,
            2663122712, 3425107874, 616125297, 1220520411, 363320242, 1717903421, 2177377494,
            2683338356, 210565640, 3061448891, 1561105018, 3639722552, 2586119577, 264509957,
            1416442444, 572448512, 3316197518, 4101471127, 1909662580, 3289492851, 702940172,
            1747588119, 3288795988, 1441233966, 678854386, 2604723913, 373703246, 2055937039,
            1124872113, 1294098600, 4165350921, 347872377, 4149215174, 3215450946, 3307233717,
            3600358822, 2659616884, 552889201, 1684681790, 1821948043, 2909781107, 917768879,
            2259947602, 2019396153, 3413299181, 603749894, 2467542574, 4017401393, 2519998741,
            1106606352, 2283516402, 4262893045, 931507531, 257221572, 1471379658, 4223521274,
            2958168654, 1643148068, 537294061, 3213657938, 3835022365, 3594404173, 777970857,
            1918635217, 1702205904, 1047564373, 67547546, 3019489110, 483595975, 4130252917,
            3081408781, 436773586, 1982914868, 3527757249, 1553562987, 4080227164, 822023069,
            1427193014, 2565421648, 3942884687, 586018307, 1138884595, 2613035769, 486310535,
            233458001, 106898418, 170926111, 3212999317, 3194995097, 827548055, 1783632131,
            1458445783, 4273893842, 4169283956, 3425898311, 1900133873, 2830934989, 3597188167,
            60014629, 2917912426, 3137954804, 1361341056, 4180775481, 946784052, 4199341441,
            976101959, 1662997785, 1179237245, 372119531, 2815699743, 2114995295, 3901740963,
            3080952004, 938243235, 1717858705, 1880470411, 3714648015, 2698621435, 4276694893,
            327245390, 2823511048, 1178264505, 2316760826, 1757942990, 1568677829, 1199580238,
            3100459677, 1386893348, 1600406349, 3128791813, 874040538, 2965907285, 8663319,
            2919597841, 1169807363, 2130724711, 2817929643, 2594603073, 975728895, 3248945863,
            1506505714, 8259384, 2395186489, 64139190, 254403781, 3179528072, 3318835559,
            872874473, 3221533853, 1278142055, 2865063695, 2096015856, 3893588672, 1650965167,
            852689473, 2456343381, 2227877463, 3533995396, 2567915364, 3260019114, 3354960043,
            317493973, 4088542285, 603804423, 3133721086, 2455680365, 2501599681, 2371144161,
            4224001882, 3900064951, 2295679614, 483545534, 500738921, 259183629, 2958675979,
            3886544014, 3382548497, 1341558649, 764676712, 2686742281, 3585367009, 2470017030,
            280649561, 504360831, 3177630390, 691028027, 3630869823, 1850039925, 693186712,
            2234334464, 3019783104, 1258253876, 2759186239, 2705660533, 1535024585, 16228098,
            3597194253, 3856258376, 2530800309, 1756061934, 3703461702, 1458672824, 3009579190,
            325542092, 974024523, 937809905, 180338019, 728257472, 1334683442, 1531729599,
            4257819380, 3701291761, 2423233504, 3786098144, 776062663, 3861731850, 3717496633,
            2918219359, 2369401162, 1963105504, 2673826226, 3238671093, 568083438, 4121947082,
            3892853652, 1632686679, 2302193583, 3211408318, 1938993158, 4122064270, 311269184,
            2105346675, 1581174365, 2485158976, 2443260070, 1986431168, 1124848188, 1841087451,
            2704521996, 1214274421, 3662035084, 2837679678, 4043497550, 552208260, 1644975825,
            1950150273, 4027848966, 4079004873, 647675052, 223752470, 637576072, 949880156,
            2749078102, 2043391316, 1008133, 253411434, 3799679907, 238227057, 2495985662,
            1475105846, 2961884606, 652180469, 1691635637, 1430944868, 15398684, 2278485165,
            3795142783, 2981896799, 1330890913, 2239691223, 407470744, 3702570774, 1624292191,
            3703366632, 2187395861, 2415878960, 2303069741, 1369122706, 2750340520, 4035673151,
            1425244662, 25186311, 123582970, 2490005251, 936607532, 4115073120, 2730391719,
            2823090688, 396451377, 2182998280, 1365726601, 4033770954, 3047868289, 2336389408,
            688454315, 1299725781, 3304644284, 4238176839, 3914620151, 3029466942, 3172492309,
            1190474536, 569450335, 320580314, 4004925139, 2557991799, 1493351038, 949583033,
            3275441062, 1311907795, 106222620, 396788468, 3186456628, 517037899, 2177653619,
            370023265, 532558109, 3182151426, 954367771, 2865591818, 600183719, 2521622949,
            3079560626, 1906789399, 1612708432, 1801660151, 3565921772, 2688352000, 1101243899,
            888006794, 2233649225, 2671500356, 1504445832, 1199168343, 2043022343, 1250919220,
            1374956710, 1107550604, 957179006, 3319703903, 4110453611, 3311143947, 2774029776,
            1456730624, 1014119593, 3012545941, 1650066434, 3431589287, 3624715486, 1072097915,
            3568695028, 478299405, 362822053, 2632030958, 955747917, 2974153651, 2880247593,
            2837857407, 1533402093, 1550331006, 3833005459, 111580345, 1694562098, 2731241196,
            2659074758, 1347615125, 3711588514, 1514710939, 3788474419, 3668780501, 3266213391,
            4081085519, 1196081228, 1049947080, 1820720234, 3100382458, 2198468097, 3708538645,
            1035729054, 1784655621, 507574130, 2908640623, 3615200865, 1223546227, 3675568182,
            1661330896, 1399689373, 1323389692, 2981922901, 4156332999, 1902241850, 1428680890,
            3049572611, 4253261231, 2148214199, 1998921071, 3899443086, 1478235253, 3791927172,
            1483896530, 3565485437, 915921912, 2258155251, 3426051958, 3307670857, 3029363090,
            3673788309, 4082838999, 624603732, 573907442, 3116664857, 3586999255, 557493850,
            1739716128, 2397076308, 2312498391, 767640384, 2119706819, 2637314051, 1070866648,
            664107404, 616236779, 3020748367, 4122128780, 2009706384, 3245363034, 429196441,
            4195520565, 4209198410, 2158211364, 3659713923, 3985561806, 1747634790, 4115935838,
            2827667115, 3073689925, 1621229363, 2774950774, 2538390550, 3506768465, 718261358,
            564823729, 380006788, 897186389, 3414352487, 1032216622, 1469922191, 2196317056,
            2239269473, 3654751282, 613015420, 4098167098, 1281134924, 849099531, 2523299715,
            3904840545, 1997547696, 1158713208, 1289444182, 757815917, 899581875, 3622748533,
            3063686656, 2979790776, 1553609204, 355408616, 3897614956, 3680334470, 25191644,
            355655308, 111682127, 4053312775, 2921335050, 2200671456, 472639194, 1374183459,
            2738441274, 1596829615, 959522853, 1993763998, 1832301144, 2263515976, 993190648,
            4045308024, 2213735364, 4061773476, 2596920312, 1929252967, 3935609312, 982934883,
            3154772065, 4254233108, 1244999206, 765237459, 2528318166, 1563389556, 2293797399,
            3495759008, 48504250, 3182637462, 3138309477, 2147232621, 4810076, 3999234780,
            2279064264, 2264522982, 3079929466, 1524222187, 1598294545, 2049273389, 2729549735,
            2116985451, 2637892533, 1094214870, 2711414546, 418295062, 98357556, 296649589,
            2636445209, 4030461397, 3073508440, 4062358649, 1293566861, 1534697481, 1343281639,
            3078259374, 386875427, 1145986442, 1790533181, 2987076845, 237202537, 2194958623,
            935119723, 1921262864, 943957815, 2336181341, 2723699978, 1638860845, 2630349960,
            431757538, 4152375793, 3473513084, 2603606861, 4176464622, 3978369596, 981482293,
            929741839, 2111696471, 571254437, 1419237733, 901791748, 3340393111, 221970895,
            2605197016, 22565479, 1000841034, 2192399670, 1207300847, 356824298, 3009617459,
            2651652098, 2420275852, 1631602976, 575809994, 2928806259, 2831092106, 2629452482,
            2842897182, 1909556662, 2496151886, 3385330607, 957152776, 2804092840, 3551246686,
            2730894896, 2027253611, 2531182020, 2258110944, 1391264743, 3902230517, 3835546712,
            3424753892, 1147410244, 3448482025, 319341118, 1798380053, 2742193162, 2106010955,
            3267048655, 3886107336, 3334600393, 3772435523, 3985863328, 2950255062, 1012493134,
            3954831363, 325018235, 2523597002, 2454925521, 2861802043, 4209313262, 3868234463,
            1685691511, 2786322255, 4244960817, 1991229419, 4239301712, 576152977, 1652411241,
            1589394460, 521549473, 266587858, 961791319, 1146831103, 3469211532, 3501779101,
            2312218475, 2321025269, 1346459216, 472196028, 3771324053, 1495430908, 463405457,
            1940232183, 3937148918, 1156878514, 2831556660, 1644483662, 1787817713, 2339616130,
            3815974485, 2298018558, 71674109, 2675299410, 960845405, 3569711116, 1673611570,
            1769369631, 1437416980, 4174063039, 2062712084, 2133844948, 196794643, 1935768058,
            1831573341, 1418980930, 3294487604, 3544538744, 2334730191, 3988003806, 2274350901,
            2023027498, 3447859831, 1671781771, 4023665101, 1455029189, 2419433622, 2943475311,
            4198568768, 1395089836, 1092520718, 2430238564, 437551709, 4097009390, 3375079636,
            4154198223, 92070792, 974607811, 3873908092, 3374473679, 638725898, 1249915990,
            1085664087, 3927733894, 1217984426, 1825247311, 2107887775, 170602951, 1075337232,
            1842870533, 3647067870, 2444592832, 3013106942, 1161476947, 3743427689, 1263482478,
            69206560, 833594813, 3842989721, 337909675, 3392484922, 370017251, 27594915,
            2126835633, 1736323108, 1893331695, 1468455680, 1075562062, 455344215, 969605531,
            294398875, 883453327, 3994410499, 1964955910, 1983678849, 556499140, 2199399388,
            1506753515, 2562511167, 573514453, 1452183180, 3758124304, 2276736219, 3962356320,
            160602272, 2732947819, 1312555719, 808517807, 1646633687, 4057383018, 1177836167,
            2724613618, 724351202, 3082498407, 3292565482, 2024078169, 2339554384, 3963173875,
            2223760730, 2562066565, 2193608401, 1812209945, 1665831972, 1039920028, 3410644888,
            3314911306, 2847575459, 2005962667, 2392982038, 2769384144, 1673231309, 2605033025,
            3097232789, 525491643, 1088675733, 389231889, 4053722369, 1394160319, 920345783,
            1695188025, 1313259843, 2855284945, 1128781302, 1711293636, 2436253183, 2702553100,
            2342544037, 2382554808, 1645824427, 700888148, 3820471891, 2062002896, 1600256482,
            3523617235, 3825142862, 4016136295, 3838255962, 2953276340, 394106186, 956179026,
            3512260850, 3001113638, 1645204518, 555542490, 409962126, 479780262, 4202384502,
            549252742, 1340551826, 190095025, 2842856010, 446626748, 2565781573, 2172050474,
            85422525, 151000070, 2413238086, 224534468, 4102988065, 3524737259, 784974768,
            3778660388, 2573449273, 956921977, 1416256526, 3821996527, 1297167173, 2183926071,
            2745200336, 1745460864, 399929970, 3271657494, 1058524185, 3138265217, 3822962039,
            796872545, 555781465, 3355863387, 4265560398, 2445094472, 546611744, 958064176,
            2278895404, 2100057835, 789578969, 387055963, 1153298400, 4065547056, 3688020091,
            783181103, 1789734962, 1466117990, 1740574947, 1632230912, 4155788342, 1714025679,
            3862124914, 2247239755, 3047057899, 3610673443, 1450313039, 3533121399, 1564221183,
            4056883174, 319992191, 598075724, 2438292429, 901314271, 2157273664, 435275402,
            1774735757, 177332560, 3010394026, 3827445200, 2002098740, 1897812156, 454287770,
            2829500771, 3286056227, 1498747083, 3402858410, 58581019, 1048766033, 1640106396,
            3774636176, 1228719792, 1768725616, 3094025701, 3705595233, 2943515149,
        ],
        &[
            3303507517, 1737467916, 767592771, 4237693101, 2944498355, 2305367062, 2912464955,
            2039632714, 957753136, 3932250327, 2923226395, 758588986, 3276864736, 4129542782,
            3701423701, 1834120826, 1304646722, 2700953412, 4016654202, 1446197632, 4233056281,
            2795834408, 2358334260, 4031834794, 1761430989, 1322974963, 1041373666, 2212100552,
            2426361770, 4261631544, 3079923997, 556209919, 2565829294, 1158111010, 1485991528,
            4015229549, 3673606504, 611864921, 976174193, 806940030, 2732222596, 2259057471,
            2443961478, 4098098138, 644289655, 180553484, 4059537703, 708282117, 1433746242,
            1823452813, 685407883, 2203888447, 3826783627, 2594937784, 3968973728, 3226845414,
            2669006681, 531830322, 453908823, 3201286311, 919570600, 1858088761, 407253743,
            1432230279, 3303340419, 3210731060, 1388706247, 551779110, 351497524, 3064709178,
            2129368300, 1872141157, 2752241851, 2688864462, 597028566, 3593773250, 2480760169,
            1493938468, 320489468, 1206910552, 2899495800, 1583265563, 2935858872, 126264340,
            2083066625, 2827628121, 3109648374, 3916360359, 389087236, 3766699281, 1333824469,
            1218761052, 2129210405, 2527568435, 3858191140, 3930233522, 1058437374, 1654914995,
            911091073, 1037669921, 2949223555, 2606346852, 1104967551, 701746540, 416874025,
            683350868, 335950780, 486101025, 3696781531, 434131711, 3081485031, 4277564240,
            2555479895, 3850726160, 3227325468, 553377665, 199290481, 3982285635, 3468419008,
            3392035752, 1966268427, 1873702317, 2940911086, 2914228436, 1708633307, 662031149,
            621794577, 2395698305, 2735240556, 1414089965, 3294650435, 479604329, 2426263958,
            847381928, 873722272, 1110653081, 1951740102, 2731402038, 2556525098, 2219924857,
            1852070957, 2449841178, 1210250294, 3699155577, 1784858631, 243884741, 2161178521,
            2410975312, 2681491929, 437235103, 1281548845, 3357384194, 549196434, 4067561207,
            3450283139, 3652169421, 1874377644, 169053482, 1420061127, 395406675, 3332510954,
            3856194671, 3006496664, 809601906, 1922764991, 3111985626, 3390014784, 3048045015,
            2051558581, 2703813358, 3808996437, 3570075083, 3505603444, 35527898, 3996784836,
            4168425592, 1946706469, 856358712, 3661547641, 141395264, 3094553658, 629697921,
            3847603586, 2560897876, 2555855191, 1405066228, 896493515, 3694348082, 3454533550,
            885932680, 3723805569, 493727984, 2574262444, 610088096, 503058120, 2172357146,
            2481205990, 3987005657, 3085722243, 2250687621, 1050336745, 3740028373, 3019114451,
            1642616645, 1137174523, 354355265, 1455093279, 304460919, 4116447569, 2981853747,
            856638318, 3109624356, 3591169837, 4193437247, 443242328, 1666463852, 2097829509,
            2208974333, 1422720757, 3349658507, 2452053895, 2569932614, 47797786, 3752698672,
            2215739699, 1652083417, 3346170449, 585897335, 2075209213, 3518121114, 378885805,
            3744168278, 3903962084, 1064225611, 4197819881, 1867701541, 1058875078, 1828480385,
            35105056, 2154079979, 4006209278, 3153027209, 3695601551, 3461064991, 3223410438,
            3090214664, 4250727661, 167290560, 3088602589, 1392761792, 4016528315, 2899219207,
            2196701677, 1154503712, 810711706, 3932982426, 2420112400, 3293415319, 4134821524,
            3493789883, 3329390364, 3047733519, 1049261264, 3282299496, 482643201, 1333502492,
            3412458538, 3505648168, 1030433939, 3681403988, 4159258448, 821956, 3965405477,
            3688327, 2218271368, 3431171763, 2674850379, 2269778883, 596405244, 2839693344,
            4146102065, 3215467606, 1891293404, 973749441, 3640452446, 2709562759, 459831821,
            460230179, 2910252183, 2014822547, 3590552255, 2390315678, 1031487459, 1213313670,
            2511201602, 1511763753, 3969704570, 2909506049, 1760818720, 1110188569, 154546279,
            577049207, 1753565754, 4085487615, 3287577161, 2028144074, 4111187020, 3004119870,
            900037962, 2806754372, 748875551, 2620104615, 2513455401, 1585914851, 239727281,
            2605810930, 416537433, 2166996582, 1965459949, 758058785, 1510362220, 1824837142,
            3097689711, 3896639991, 4187903962, 372233538, 4010166025, 1907205494, 3036010338,
            1576810188, 3371537329, 2895423119, 3461187657, 1440946377, 2483629064, 2639054882,
            2819542476, 1677376583, 3628809647, 1237686175, 3985351720, 2642412817, 4013664855,
            2065613802, 817459407, 2876445270, 3076582045, 1810603735, 1174549530, 4260651012,
            1973700727, 2194803557, 2360115398, 3069422632, 1295376632, 1002159587, 4162264900,
            963230566, 193817342, 2402613170, 275479630, 116160077, 2599851335, 159870465,
            211768251, 4017718175, 931115106, 1004170356, 2730898374, 932870994, 1082826978,
            2961790318, 3424432922, 1300198410, 2280596007, 2164752687, 2135660458, 2665413409,
            378731924, 3146959946, 1447131084, 624620351, 1626838440, 3569823375, 787344599,
            398683074, 2909969062, 1166082222, 2222839820, 3445152909, 241015893, 3204685501,
            1212401564, 4123206390, 1295604587, 1098987770, 3308585450, 3613934791, 1755566651,
            3657857779, 1263036827, 3678216851, 2402921074, 3493820436, 1704692066, 403162744,
            3170124922, 3563160884, 3160828389, 464965432, 1118230114, 988354534, 356341207,
            3849468154, 686849000, 1566884214, 240572604, 3063337879, 731356349, 820769259,
            941504045, 2706839108, 2723874282, 278246299, 3880298064, 4262421502, 256437639,
            1773319540, 153110521, 565549233, 1853553593, 4289762574, 4098151149, 3144524222,
            4144088665, 2052608329, 1464290562, 2110534105, 1113619720, 2516886130, 2842359662,
            436774705, 2771156018, 1683247173, 3108637805, 2436817839, 4127310701, 3910938906,
            2062961202, 3341755081, 3583281049, 3534420977, 996954658, 4115691732, 1529857101,
            519089315, 1800475325, 2866891326, 3674269922, 4258687645, 1222536664, 119098982,
            3470430550, 2133110377, 10231145, 2797637322, 1573837132, 2948970055, 44978960,
            4025694418, 3346973726, 1067376893, 2502195176, 14223176, 2185770650, 2887537518,
            15571252, 2033910005, 63833522, 787872402, 3088869854, 940048320, 409417410,
            1084110155, 601749701, 914916762, 524011526, 846030561, 4258519014, 2487948410,
            3192173244, 3091400971, 3644666631, 532480229, 2780924927, 604543953, 756270658,
            2063413786, 61217573, 780610452, 955642466, 737073209, 97297839, 4258953485,
            2857641388, 304710700, 3918409840, 2194881876, 196515060, 1845737739, 80004705,
            3864082477, 2417895713, 1575272517, 2071122658, 4181848470, 699244129, 2719978593,
            3969766361, 3331919022, 1806356115, 1674881762, 3140317527, 1020055538, 928717808,
            3657371453, 3576271656, 1661098282, 2787948393, 1612552028, 3154905497, 1703392561,
            843717976, 1621287936, 964546377, 3549430129, 712295080, 2234282678, 4200849568,
            2117828027, 1392560869, 1138816605, 1628721368, 1719186629, 499638295, 2276446667,
            2040220810, 4170119435, 3098091505, 3464708059, 2446105454, 823802794, 561105361,
            2956734110, 85242489, 3594780155, 577528063, 3814286772, 3517308917, 1542560009,
            903130712, 3610028360, 1094281534, 428913785, 2017125716, 4147179238, 2416543280,
            2299224901, 3094092893, 690981050, 1074080982, 3806304984, 42870724, 661112767,
            951312097, 993899402, 1421924279, 3477956487, 2620630825, 421567847, 1135313615,
            1871766543, 2089515143, 3125551624, 2893389248, 1822212994, 608096287, 1209599323,
            1729308570, 3183687973, 4188910249, 4113106401, 3467805891, 421479009, 2067824783,
            1123275745, 3372672466, 1299403729, 2597804990, 4109910992, 3549093152, 1334873992,
            2837764304, 217816190, 2798635274, 1928429025, 3532349620, 1432073554, 894604604,
            1320754530, 2946314029, 1689416007, 4088210274, 3660222258, 1778465861, 2089083512,
            2489444834, 3020220872, 2955906475, 530018361, 3604331239, 266271770, 1093367251,
            2425988385, 756441106, 3810449360, 166826417, 4128383674, 2193768558, 1695641441,
            4163952927, 3844926416, 3179839754, 1485072550, 1035240603, 2716609076, 4025246794,
            1340294165, 3056622704, 1486949742, 582340579, 1925519282, 1050735048, 33509855,
            2342941070, 2747830341, 1845018013, 2064583117, 350099328, 937043595, 1618308339,
            1824995534, 1246976548, 2566004874, 3546659674, 659106533, 2844260619, 3911232451,
            1416070938, 2388309597, 316855261, 1695213219, 856692567, 50305942, 3668671854,
            155369786, 2137812662, 4211140628, 1042632363, 287846104, 2375035513, 1607313275,
            4018768752, 2592097421, 741212831, 2408601799, 903321756, 3509061462, 3142569462,
            4087971745, 3019038954, 1803053183, 2257944916, 1390909767, 2836222866, 371214087,
            3682888114, 2241578583, 3605759723, 963603499, 1055335598, 3601870947, 4058606066,
            377849537, 1843635487, 1835087927, 3393215451, 17492256, 3372299656, 3413139881,
            4264793180, 1928965951, 4021643980, 2269905143, 545062409, 1389035345, 948398528,
            271536224, 3504014149, 567335901, 3413496753, 3071719597, 1445310729, 1770797777,
            1267315070, 2207614182, 3493277503, 4282532855, 2107955232, 133857837, 2087779634,
            4056521208, 818046024, 1890865855, 2126495054, 697548852, 3485729598, 1695030614,
            893769923, 184087075, 1500071319, 2080614980, 2480313210, 3450043314, 1064086870,
            2786617720, 4034347698, 681412032, 2428347460, 3253322495, 3604525345, 1428905795,
            4035094721, 2101041634, 4183013229, 1705836765, 1682316444, 1879660152, 656187483,
            3706455747, 2213541704, 669373128, 1529444811, 2814804687, 908625065, 2227416512,
            2001006578, 607169088, 3393837756, 2682839326, 1093822620, 2249228026, 741792013,
            3650948262, 2073718838, 2268511569, 1643477360, 2804865813, 3375407338, 1318291972,
            1414889752, 2869309697, 1958772002, 4162044589, 344252635, 3226572534, 3577208303,
            1959437424, 899330854, 3892405212, 1622822546, 1644013310, 1300136815, 2640337368,
            2069864152, 1596350405, 3843745327, 1256171531, 870418775, 2393395126, 3876818506,
            3944780828, 4008626102, 3127368256, 3426341771, 2086853545, 3827677693, 313614572,
            3669266463, 4080954414, 1707330242, 2963410257, 3437453487, 2794195219, 3099230302,
            726769739, 2044701195, 1129715603, 1793697677, 2760059361, 2331714255, 2589913453,
            4127324884, 2881798920, 3400611219, 2052671160, 3546649304, 2164589537, 2812204213,
            3337755588, 3983060148, 1899178107, 776922408, 4182115872, 444866608, 1399651129,
            3474508713, 2842510671, 3402478835, 1423128980, 4178402672, 3172508430, 804756202,
            1597189857, 1958174560, 3392832851, 1197650976, 3772223860, 2054821761, 4011804750,
            474742851, 1329523696, 4032274332, 2454461926, 638843849, 2072449514, 764758175,
            3934751812, 4075369298, 3142015673, 3394043201, 1535751977, 1846529809, 959593533,
            2235839818, 2814770736, 247085892, 2629667206, 2957898589, 3933947035, 1295728615,
            3586572901, 4038985747, 1129159296, 1855469111, 1271614337, 1507173551, 332723961,
            1156816569, 1294330789, 4122256011, 299955786, 3523281781, 2491532525, 1960595579,
            1730519156, 499071642, 1575886120, 2620965123, 3289148909, 1154711404, 1451719777,
            2628469322, 1901725555, 823453464, 3761287780, 2261972333, 3596389504, 3137670793,
            82630428, 3159699693, 837229231, 344117878, 2381467908, 726572177, 304723155,
            3208229621, 1458659872, 1794857529, 3755652400, 2395146944, 4102358516, 3277747506,
            1818040372, 3936695066, 2397713693, 1708618418, 1728140834, 1261714327, 1581655946,
            2071676586, 1202217464, 1344775033, 4250653297, 2492875948, 1126916876, 2945410447,
            2941087697, 2560380036, 2546735705, 3178023445, 626886956, 484882355, 3357302024,
            4057372957, 2081549406, 3896175417, 2686162101, 1986295486, 1621237422, 3568031348,
            4006200466, 1442461868, 3844879388, 3501884160, 4038570281, 4208037469, 183139977,
            999125999, 530710734, 2507567639, 3058017326, 4201561530, 2864542147, 2696523106,
            2969212130, 2678586192, 844065498, 2655259915, 1258788749, 2827607705, 2237733350,
            3783297719, 2313239370, 950226942, 1280595939, 1196906959, 1606546303, 1844760556,
            228764146, 744772053, 1358152164, 1193261600, 2565492365, 1225744635, 4233301881,
            2253145769, 1602119788, 1365069640, 52910185, 2636770690, 3298764603, 1878144899,
            4262332977, 3649154366, 3690806265, 231714913, 2913226838, 1554707381, 2963669507,
            2049539773, 1775985343, 3627719803, 433359314, 3418531436, 793315695, 913341557,
            2380241821, 348855994, 234181973, 3722537381, 3525843118, 1275331720, 2537849571,
            2827984585, 1565515383, 642373946, 1576289295, 2688247425, 3614474901, 1917731824,
            2884918146, 1646964474, 2383030418, 2488801475, 1560749769, 139516483, 1142139281,
            3459274279, 2863576242, 2828722138, 717484310, 1564480623, 3172598637, 2368201724,
            2247871922, 419758505, 3015961787, 3098012702, 1041261606, 984280115, 2438811327,
            2578749598, 978582878, 968817491, 2965070269, 2780764697, 792560930, 4229722212,
            4114038484, 817420493, 3041070967, 3191549455, 56820468, 186749905, 784610516,
            1729092057, 1935036496, 3745217089, 631003694, 3845500664, 1776171936, 2105858365,
            1027041956, 1638191578, 3198133424, 3040033996, 3224025446, 2046726489, 3326226799,
            4261577923, 778164631, 4272446112, 967648331, 4223690387, 394608816, 2849103815,
            1132525868, 4239388057, 3710951992, 582192848, 1372476599, 1228786127, 444221576,
            1576598378, 4000181362, 2210214319, 3226877228, 3921989392, 3841275639, 1917309689,
            2860911813, 4290305048, 1796377659, 3485206273, 2654605026, 1122524178, 3609458012,
            1733743381, 2869375618, 3606400920, 2485406505, 617720548, 497728528, 3826929977,
            788489471, 1188098828, 3383811959, 836335995, 104474735, 994749139, 523424077,
            1334471135, 3246261832, 579729621, 539626281, 1917656426, 3649706685, 407844197,
            3736652416, 449727051, 2451735689, 854611863, 3476911840, 973228334, 374181454,
            174850286, 4178627179, 3564929895, 1321454916, 3996342532, 3051609408, 3899526499,
            1406247157, 803997219, 3125646376, 1606457001, 1405170718, 208843195, 1067743855,
            2152262286, 3179865614, 3639249079, 3035981075, 2732174588, 351444382, 2864637808,
            1006363319, 3244329910, 405573136, 562447830, 2108083668, 396995391, 326716392,
            3263476213, 46276814, 1326176087, 1851003306, 2516298844, 3058805571, 2774935984,
            1856888260, 2568955433, 3218178509, 649282170, 2256866690, 3674417033, 1111304414,
            2088271619, 3238685708, 1574098232, 4183705418, 1987306144, 1189150097, 1378845891,
            3654818831, 386424237, 515382663, 1197128686, 2542968522, 3887585643, 73911371,
            4058793301, 1696639371, 2561358933, 2221990016, 727444672, 1973624906, 3853875864,
            174963610, 2695490643, 1066818493, 150873363, 3952837259, 2936691596, 3233597847,
            2506388918, 3711816965, 2536068963, 2311484662, 1093886392, 2704991380, 4059725080,
            1625573608, 2471671232, 1763939042, 2734410153, 4028854994, 2952269163, 1527756733,
            3902245417, 803045644, 1140158788, 3552349570, 235707516, 415130691, 1269910803,
            2620435440, 2226985943, 534205480, 2823709851, 4167053910, 3680035619, 2757219390,
            253917945, 3675657485, 761900957, 921345945, 3266224194, 3148826681, 1686290818,
            1647986984, 495687313, 977442969, 519576012, 2062617190, 2755583385, 2380042959,
            3142598908, 2437799893, 2426856697, 3052553836, 1753471289, 3915929071, 181022453,
            2017995427, 2796049960, 1358824868, 2906668276, 3538494963, 1500035161, 65877569,
            3786619137, 2956889923, 2470576554, 1511345314, 2266296788, 2066914712, 94664780,
            4203735289, 4281330982, 2763817600, 2319245226, 944042376, 3922820514, 3935434053,
            3397738753, 243208651, 4248331561, 1105500069, 2967638830, 1029380469, 1099175028,
            3684769174, 970577857, 824995756, 2937133428, 1925916100, 859262581, 1913695947,
            99275310, 848678738, 1204388593, 2545149594, 4025381218, 2655396831, 4274996806,
            785850435, 2813888154, 2491029176, 729818073, 3512685438, 2347032890, 236189106,
            1548333126, 4226775910, 3531794275, 2605168049, 2258187662, 3684015953, 898250663,
            3771349383, 4093644918, 1624210803, 4281075128, 3093735055, 1291164275, 4037665805,
            400599276, 1273249058, 2375386975, 3439029906, 3333739393, 21660248, 1230861454,
            4062325366, 4236459577, 114385419, 3486611078, 2042004563, 1720831514, 2860273565,
            1626594640, 1874700160, 2999308559, 3363764551, 3500763507, 2853826537, 2479469741,
            1210500932, 2562869107, 880924171, 3384557003, 4168144997, 1148570091, 3116312623,
            3172212634, 3567662417, 2642768241, 2015203625, 322037435, 4195745331, 482368754,
            3667466677, 4219023014, 1434757526, 2822946590, 1936561533, 2947351890, 76179171,
            2209227842, 2435463017, 276550749, 3368341828, 4262885294, 527655253, 3745940749,
            947007746, 3600866533, 4084045218, 3905637169, 702492342, 3383700150, 1661174941,
            1763804378, 961484162, 439776914, 257725152, 2840617852, 2635835773, 2403444459,
            2908195944, 2902712886, 3595015469, 1460138072, 457118198, 2120525120, 2083051232,
            2885301328, 3622650790, 400659000, 184135173, 1137972313, 759714739, 1306898817,
            2898422672, 1499186793, 2809562653, 1117081917, 3344337520, 1802186651, 3627008548,
            3860814929, 3728070085, 2991502661, 1782981707, 2477289364, 3565582296, 4061650811,
            1579851913, 3689665892, 75184626, 2690145835, 1228774440, 781089767, 3218967841,
            4064814684, 3163493596, 2809482905, 208507155, 3756966102, 1779229104, 3680138867,
            1751377038, 2598643358, 741546321, 1303997493, 1306096237, 3769872893, 3911517876,
            1315212882, 2839259600, 1408676647, 4129419272, 26525771, 1163846026, 4159566079,
            3195690749, 3064298320, 2468791883, 2538731242, 3488224592, 840135976, 493847318,
            3680037513, 4066665187, 1669269859, 29113490, 3642824198, 2180773838, 3705727774,
            3741660915, 2916119284, 4126524803, 2531904672, 3689890848, 3760318626, 2463539219,
            2074029166, 3481349310, 834750020, 3864728871, 2085171104, 1481087706, 385893521,
            1753696318, 262108731, 3110985970, 3185711468, 3592333917, 4001141364, 1777140007,
            1668227551, 3014458968, 3982753649, 216294504, 3414213843, 553573571, 4237875195,
            1780838673, 2208517053, 1405463181, 3074428565, 443193338, 3142617921, 426182091,
            3549357900, 3829054100, 3730720095, 3556916232, 3050819311, 395210557, 3290215021,
            1925989323, 1278915506, 2074504769, 788246561, 4036378728, 2546297900, 3576484297,
            881981653, 3844099771, 1100647287, 3275806264, 1545433580, 2973403693, 2010768484,
            58589600, 2055927634, 900275269, 1772160551, 3642278816, 759464205, 3337186197,
            2884437454, 1815406779, 1826092146, 1703588272, 91001350, 785570260, 4114370752,
            2690000574, 4090829518, 3792473390, 2886081610, 712723937, 3835538037, 4094897515,
            2015334309, 3367660714, 1368192432, 1580207087, 2030632060, 1542088491, 1685523972,
            4182209840, 1673405540, 4001729368, 595538569, 1903475145, 3297819296, 946281001,
            1202436672, 4111768072, 412627407, 1029652681, 2792765909, 2040861363, 2987136935,
            22966596, 3410302892, 3001821942, 1981338581, 3480779498, 1173591145, 4071007940,
            1927554934, 1430729301, 2103178216, 3055596527, 3263660591, 4266315882, 3008856523,
            1661503737, 2281231147, 4261532350, 2177588068, 1785850443, 62425813,
        ],
    );
}

#[cfg(feature = "32_bit_limbs")]
#[test]
#[should_panic]
fn limbs_modular_invert_fail_1() {
    limbs_modular_invert(&mut [10; 3], &[], &mut [10; 3]);
}

#[cfg(feature = "32_bit_limbs")]
#[test]
#[should_panic]
fn limbs_modular_invert_fail_2() {
    let ds = &[1, 2, 3];
    let mut scratch = vec![0; limbs_modular_invert_scratch_len(ds.len())];
    limbs_modular_invert(&mut [10; 2], ds, &mut scratch);
}

#[cfg(feature = "32_bit_limbs")]
#[test]
#[should_panic]
fn limbs_modular_invert_fail_3() {
    let ds = &[4, 5];
    let mut scratch = vec![0; limbs_modular_invert_scratch_len(ds.len())];
    limbs_modular_invert(&mut [10; 3], ds, &mut scratch);
}

fn verify_limbs_modular_div_mod(ns: &[Limb], ds: &[Limb], borrow: bool, qs: &[Limb], rs: &[Limb]) {
    let n = Natural::from_limbs_asc(ns);
    let d = Natural::from_limbs_asc(ds);
    let q = Natural::from_limbs_asc(qs);
    let r = Natural::from_limbs_asc(rs);
    let n_len = ns.len();
    let d_len = ds.len();
    let q_len = n_len - d_len;
    let qd = q * d;
    assert_eq!(n < qd, borrow);
    assert!(qd.eq_mod_power_of_two(&n, u64::wrapping_from(q_len) << Limb::LOG_WIDTH));
    let expected_r = (Integer::from(n) - Integer::from(qd))
        .mod_power_of_two(u64::wrapping_from(n_len) << Limb::LOG_WIDTH)
        >> (u64::wrapping_from(q_len) << Limb::LOG_WIDTH);
    assert_eq!(expected_r, r);
}

#[cfg(feature = "32_bit_limbs")]
#[test]
fn test_limbs_modular_div_mod_schoolbook() {
    let test =
        |qs_in: &[Limb], ns_in: &[Limb], ds: &[Limb], borrow, qs_out: &[Limb], ns_out: &[Limb]| {
            let mut qs = qs_in.to_vec();
            let mut ns = ns_in.to_vec();
            let inverse = limbs_modular_invert_limb(ds[0]).wrapping_neg();
            assert_eq!(
                _limbs_modular_div_mod_schoolbook(&mut qs, &mut ns, ds, inverse),
                borrow
            );
            let q_len = ns.len() - ds.len();
            assert_eq!(&qs[..q_len], qs_out);
            assert_eq!(&ns[q_len..], ns_out);
            verify_limbs_modular_div_mod(ns_in, ds, borrow, qs_out, ns_out);
        };
    // lowest_q && limbs_slice_add_limb_in_place(&mut qs[q_diff..], 1)
    test(&[10; 3], &[0, 0, 0], &[1, 2], false, &[0], &[0, 0]);
    // !(lowest_q && limbs_slice_add_limb_in_place(&mut qs[q_diff..], 1))
    test(&[10; 3], &[1, 2, 3], &[1, 2], false, &[1], &[0, 3]);
    test(
        &[10; 3],
        &[1, 2, 3],
        &[5, 6],
        true,
        &[3435973837],
        &[858993456, 4294967294],
    );
    test(&[10; 3], &[1, 2, 3, 4], &[1, 2, 3], false, &[1], &[0, 0, 4]);
    test(
        &[10; 3],
        &[1, 2, 3, 4],
        &[1, 0xffff_ffff, 3],
        false,
        &[1],
        &[3, 4294967295, 3],
    );
    test(&[10; 3], &[0, 1], &[1], false, &[0], &[1]);
}

#[cfg(feature = "32_bit_limbs")]
#[test]
#[should_panic]
fn limbs_modular_div_mod_schoolbook_fail_1() {
    _limbs_modular_div_mod_schoolbook(&mut [10; 3], &mut [1, 2, 3], &[], 1);
}

#[cfg(feature = "32_bit_limbs")]
#[test]
#[should_panic]
fn limbs_modular_div_mod_schoolbook_fail_2() {
    let ds = &[1, 2, 3];
    let inverse = limbs_modular_invert_limb(ds[0]).wrapping_neg();
    _limbs_modular_div_mod_schoolbook(&mut [10; 3], &mut [1, 2, 3], ds, inverse);
}

#[cfg(feature = "32_bit_limbs")]
#[test]
#[should_panic]
fn limbs_modular_div_mod_schoolbook_fail_3() {
    let ds = &[1, 2];
    let inverse = limbs_modular_invert_limb(ds[0]).wrapping_neg();
    _limbs_modular_div_mod_schoolbook(&mut [], &mut [1, 2, 3], ds, inverse);
}

#[cfg(feature = "32_bit_limbs")]
#[test]
#[should_panic]
fn limbs_modular_div_mod_schoolbook_fail_4() {
    let ds = &[4, 5];
    let inverse = limbs_modular_invert_limb(ds[0]).wrapping_neg();
    _limbs_modular_div_mod_schoolbook(&mut [10; 3], &mut [1, 2, 3], ds, inverse);
}

#[cfg(feature = "32_bit_limbs")]
#[test]
fn test_limbs_modular_div_mod_divide_and_conquer() {
    let test =
        |qs_in: &[Limb], ns_in: &[Limb], ds: &[Limb], borrow, qs_out: &[Limb], ns_out: &[Limb]| {
            let mut qs = qs_in.to_vec();
            let mut ns = ns_in.to_vec();
            let inverse = limbs_modular_invert_limb(ds[0]).wrapping_neg();
            assert_eq!(
                _limbs_modular_div_mod_divide_and_conquer(&mut qs, &mut ns, ds, inverse),
                borrow
            );
            let q_len = ns.len() - ds.len();
            assert_eq!(&qs[..q_len], qs_out);
            assert_eq!(&ns[q_len..], ns_out);
            verify_limbs_modular_div_mod(ns_in, ds, borrow, qs_out, ns_out);
        };
    // q_len <= d_len
    // q_len < DC_BDIV_QR_THRESHOLD
    // q_len != d_len
    test(&[10; 3], &[0, 0, 0], &[1, 2], false, &[0], &[0, 0]);
    test(&[10; 3], &[1, 2, 3], &[1, 2], false, &[1], &[0, 3]);
    test(
        &[10; 3],
        &[1, 2, 3],
        &[5, 6],
        true,
        &[3435973837],
        &[858993456, 4294967294],
    );
    test(&[10; 3], &[1, 2, 3, 4], &[1, 2, 3], false, &[1], &[0, 0, 4]);
    test(
        &[10; 3],
        &[1, 2, 3, 4],
        &[1, 0xffff_ffff, 3],
        false,
        &[1],
        &[3, 4294967295, 3],
    );
    // q_len == d_len
    test(&[10; 4], &[0; 4], &[1, 0], false, &[0, 0], &[0, 0]);
    // q_len > d_len
    // q_len_mod_d_len < DC_BDIV_QR_THRESHOLD
    // q_len_mod_d_len != d_len
    // lo < DC_BDIV_QR_THRESHOLD in _limbs_modular_div_mod_divide_and_conquer_helper
    // hi < DC_BDIV_QR_THRESHOLD in _limbs_modular_div_mod_divide_and_conquer_helper
    test(&[10; 5], &[0; 5], &[1, 0], false, &[0, 0, 0], &[0, 0]);
    test(
        &[10; 4],
        &[1, 2, 3, 4],
        &[5, 6],
        true,
        &[3435973837, 3607772528],
        &[4123168602, 4294967294],
    );
    test(
        &[10; 5],
        &[1, 2, 3, 4, 5],
        &[7, 8, 9],
        false,
        &[3067833783, 175304787],
        &[1051828726, 2717224210, 4],
    );
    // q_len_mod_d_len == d_len
    test(
        &[10; 6],
        &[1, 2, 3, 4, 5, 6],
        &[7, 8],
        false,
        &[3067833783, 175304787, 3481052211, 2770888938],
        &[3602692266, 0],
    );
    // q_len >= DC_BDIV_QR_THRESHOLD
    test(
        &[10; 111],
        &[
            238690007, 851362023, 2059930942, 863267985, 3076614342, 3047275605, 1421974480,
            393459707, 388753961, 1307811244, 1724185886, 1342073382, 3451829757, 511726014,
            460409053, 863948559, 755242682, 1610976003, 1095233439, 3983048866, 3486643678,
            1487854845, 1830823553, 2167088595, 2000609352, 3778875209, 1877274219, 3295032048,
            1477159538, 2048839778, 1451455912, 2109980052, 1750913495, 391343357, 3276142698,
            2641970441, 1571798863, 2401599044, 1467594428, 2128234517, 3438746006, 227485655,
            15222216, 256928874, 3095411638, 111550405, 2230139158, 531435393, 1299420097,
            783687022, 3432104224, 1656185186, 3410451479, 1448536986, 1411134389, 3874476101,
            2765514254, 2128294132, 3954579563, 2329369626, 3269515791, 3855344744, 1503334643,
            1671855141, 3162383277, 1731111055, 3777334519, 1174367318, 1945392580, 966689109,
            97441364, 1465255424, 1616147497, 1637231485, 1811763876, 2884209513, 3019238075,
            1328651869, 840247524, 344122022, 795760234, 289967503, 616630287, 675829910,
            2847875873, 2811380606, 2236228680, 4067593481, 2980091801, 2832971103, 2491091113,
            1521816576, 4075571575, 2543360203, 935927249, 573194417, 1822073845, 1839465906,
            3275095514,
        ],
        &[
            2515301847, 3904775757, 133728302, 3903482605, 3523183307, 1531057916, 1011111105,
            1204888196, 587552558, 2259844136, 2514432920, 3885615695, 1529240459, 2527102686,
            1527502935, 3607833032, 3108651811, 1015333242, 2650209133, 499583440, 2106087248,
            3218570602, 187468843, 2524810763, 3875472062, 3825849708, 2963555251, 2365237686,
            2035410556, 3853326592, 2366649615, 757846500, 2808712542, 1010450631, 2537107077,
            415304475, 2322781433, 1747200466, 3029815769, 2722060855, 3586580760, 2610036947,
            2383069225, 1479189021, 3488202013, 3088351671, 2313154907, 1103886425, 3716175621,
            1172908513,
        ],
        false,
        &[
            3119021825, 2664508330, 2031628331, 478764351, 1877838675, 14612131, 652799697,
            1178144318, 581220955, 1647659598, 1352407033, 2397453730, 3102518439, 248362411,
            760583238, 3183702428, 3503543471, 1633363102, 700510731, 2278494661, 3883161292,
            2875693392, 778768718, 1830608772, 4092108024, 1084731936, 2636788137, 1618403943,
            2120905188, 1304331644, 3129515489, 1701146314, 2248764147, 4096904357, 4179132986,
            1285739406, 4084818677, 3908907080, 2892808133, 3130632865, 1541722253, 754313201,
            49163159, 4048683373, 1840022468, 3666703478, 149207896, 1807686489, 529174445,
        ],
        &[
            222246482, 233545700, 3332794578, 1998197261, 3881642604, 2334420680, 457729581,
            1028684141, 1820939861, 393050552, 3364087427, 980919077, 215964517, 2941392816,
            735903426, 707494399, 1663858662, 1254976633, 2324830169, 279707711, 2388586745,
            1736265304, 1292267389, 1204103850, 1444415893, 646068967, 361893912, 1168453387,
            4162569836, 37496928, 2388108126, 4045054107, 479165313, 2859008180, 3729669518,
            790583185, 1990610890, 653432721, 4260517455, 1533264118, 4071210056, 1925491571,
            2468006372, 1418208775, 3998441757, 2911027604, 1743255069, 4051022203, 3853317804,
            3130583770,
        ],
    );
    // q_len_mod_d_len >= DC_BDIV_QR_THRESHOLD
    test(
        &[10; 172],
        &[
            119338358, 2430782482, 2540297421, 188973918, 3420087589, 1543598052, 1550450700,
            3792047461, 889269407, 501191530, 2576798720, 2543454220, 3210031718, 485123386,
            106926418, 550954803, 939577053, 4245574922, 3198319089, 3116005666, 2750993558,
            1870348975, 1975807411, 1781898658, 487257459, 1417798881, 2833805593, 3259853663,
            1497754962, 686849710, 2609757048, 3718757183, 57671149, 3248634542, 3521889134,
            4157073590, 177642810, 2320627206, 3417728001, 301744109, 1374315478, 1156075184,
            2442293407, 1057610827, 1297359181, 1747109539, 2141404099, 4281881065, 138386125,
            3063455685, 3257890728, 3858193084, 3304890228, 238881307, 3445664438, 1185407578,
            2888653737, 993706894, 1967766053, 127412966, 2403399672, 1285486798, 908290107,
            1510442679, 4206401596, 3276759710, 11374285, 3959337953, 2236839585, 1565413293,
            2800534730, 3519885942, 3614906874, 2633795417, 3347806654, 569358328, 2189946218,
            1203262343, 2746982062, 62980684, 2586441066, 3124531637, 2381648646, 105584535,
            2941906813, 4638308, 3536520384, 446015359, 345521288, 2337847433, 1716341197,
            3434262596, 327360947, 2195093682, 1901891799, 2053064947, 1866727148, 1933602442,
            1896991511, 2434864863, 2509221232, 4146560978, 1738009642, 1186271375, 1991440446,
            388280769, 169881608, 3374872656, 4866502, 1578994123, 3894433257, 1685621086,
            3090617712, 2446643244, 1027311466, 2913067733, 415217914, 206402492, 3701056394,
            1797709466, 3451818053, 648910037, 1949755852, 3049709007, 1611096612, 271402178,
            2578204568, 481131710, 1944796007, 2365170803, 32134309, 3750170475, 1864104146,
            3460592883, 1303514890, 1133731290, 3830118297, 591382459, 3363797689, 3707044033,
            3781009395, 1183270231, 3773122255, 3243748324, 3121647216, 3297073440,
        ],
        &[
            1049478211, 680469795, 747349000, 2496192539, 3157275628, 2809929985, 1340573873,
            2369546793, 2965031816, 1069643167, 3522649492, 82508657, 3745222809, 2653443896,
            2691224863, 3638169243, 2790760129, 4050384292, 1236545914, 17769303, 3123357666,
            3308586064, 230925596, 2288243675, 526850016, 3478799166, 1359885289, 375398501,
            1996193928, 224867464, 3724522919, 3776621157, 1721777221, 1941498131, 1319934893,
            335479091, 1206826435, 1008537741, 2525891651, 3027900562, 4088218789, 1755627645,
            2151342900, 1492538444, 3337655012, 1349454, 757064511, 1793808978, 1243123906,
        ],
        false,
        &[
            3523610706, 4095718486, 1445432431, 1673437541, 4020367945, 3745015492, 3016399130,
            2189565108, 2158132813, 1848828598, 2472767424, 878094830, 2680402548, 1260943793,
            2476928489, 1177867634, 1646518182, 2946352334, 2967411271, 795570707, 2492588175,
            1099595857, 2363747444, 2197221897, 2821893422, 2883961834, 3448280420, 786023016,
            2349590684, 2639964406, 1547208182, 3946067756, 3185616768, 3182946836, 2191883192,
            714873272, 792265815, 933013306, 2758420490, 3469512009, 2749660816, 1740114201,
            1648303579, 1226176719, 4026247645, 894127522, 574096753, 1891430834, 2973532085,
            944441129, 1683821712, 681573051, 3596769123, 1196189501, 2202034777, 1230292795,
            3495428083, 3349595990, 3089151840, 3902324247, 1824847451, 783543484, 3845016445,
            1815687272, 3454243, 2400067141, 2812607721, 1192925916, 2545803688, 4259913124,
            2525790266, 1603659073, 2954188152, 3220648056, 4024945180, 1854165635, 2161271037,
            517485723, 3238095654, 89843703, 3273382586, 3798028954, 1204973927, 2456421551,
            1909094133, 2001850210, 3332598500, 2971871953, 2353788999, 1241071170, 422153499,
            3611758239, 1771812426, 1704380646, 2934602124, 2834187644, 518477462,
        ],
        &[
            266027871, 609493494, 1199784782, 1682700206, 4164056974, 2244647064, 14359526,
            1914376228, 1643693158, 449364942, 41001758, 2790190796, 1578020376, 30923228,
            2290083886, 793751679, 3951462642, 4187532857, 4144262715, 2260802306, 203413221,
            3707574023, 576327919, 33186882, 2830664220, 3895250804, 3878634772, 2739709544,
            1332976664, 1238738498, 2733771934, 2370719463, 1598734028, 1315681082, 1037147578,
            3551458133, 3406603032, 2882741411, 196631076, 833893415, 1307502306, 2956084628,
            3466863337, 682644819, 4092006006, 1963236296, 154386710, 1982810036, 3147006703,
        ],
    );
    // lo >= DC_BDIV_QR_THRESHOLD in _limbs_modular_div_mod_divide_and_conquer_helper
    // hi >= DC_BDIV_QR_THRESHOLD in _limbs_modular_div_mod_divide_and_conquer_helper
    test(
        &[10; 704],
        &[
            4185751770, 949164274, 3900519725, 1754790124, 2927570383, 1610053170, 3366859463,
            1066429707, 3501570618, 2367440639, 2328634068, 3704221588, 2322372141, 3380520853,
            4189820685, 485163788, 2195405920, 3117134592, 3277704486, 3921062791, 4106797055,
            3045508412, 661029638, 2678369724, 1467681615, 1851814983, 2960522150, 2294339994,
            489626124, 1242331300, 3385810062, 1149294828, 4088074806, 3724039365, 3770424399,
            2493469584, 806372748, 3771669403, 1111232705, 3478087568, 4029774748, 3551452116,
            3110587082, 2488974879, 47749858, 2223367929, 873250000, 2012398807, 1861118382,
            2706639555, 2880844104, 1868093092, 3743135694, 4074318903, 2930806087, 2281983526,
            1378855744, 3388340416, 3195092613, 3141388671, 3385803629, 2248154961, 716647719,
            408786065, 4189607626, 2706804476, 392451433, 843831220, 2117893506, 3763769755,
            2423989357, 1884254215, 4268634885, 1347756990, 4289680773, 1595972140, 1860322889,
            3365907154, 654256963, 3331834702, 3229143368, 1643589278, 3268087485, 3428966374,
            3734153935, 506918314, 2193830653, 1524006905, 2233546309, 2451094754, 983474066,
            1062775683, 1398440782, 617471652, 233856640, 1491439739, 194893774, 404597210,
            3349886938, 807897566, 1268209008, 3507741641, 434756682, 3067317419, 1955402334,
            3598337478, 4236902625, 3345914967, 2108259867, 4199783792, 3533374250, 690146057,
            2735070107, 3232842523, 3628050608, 139149260, 1670944793, 3256209787, 3411654393,
            1946511496, 2082461349, 2746160530, 1671886353, 2094620437, 1492520252, 3287026452,
            1499589769, 2631443030, 4265952385, 1560009101, 1665017895, 3582256582, 583800370,
            1971617104, 1393694131, 1717803931, 2118915823, 606443859, 76766530, 1028659200,
            3222396398, 491393514, 2650674330, 1420523709, 990196161, 4164467322, 955609751,
            3658315631, 3108133206, 2441918819, 119215334, 1647135728, 1151329712, 2270557882,
            2839636265, 1788114480, 953442631, 220077499, 3739679968, 289913489, 153493659,
            2215060199, 654989994, 2506760104, 3263600596, 2504124177, 3901175056, 3815693428,
            4062899928, 656080429, 1691317505, 2738892449, 2218799091, 254384726, 3472889999,
            452028418, 2323167132, 3160160509, 2790465254, 3506704767, 920776279, 1555295659,
            2088038090, 3587541031, 704460377, 41385058, 117178999, 3630755471, 2068346931,
            1737173706, 943790911, 1174415673, 2975257119, 4104946893, 563605415, 3504496607,
            3460311420, 3481281138, 2065638799, 222198878, 693087774, 2553540537, 3515067895,
            493992216, 2675820307, 1624273500, 537035998, 1538452403, 227298276, 566431973,
            3341420291, 2663602752, 849190806, 517998830, 674919319, 1319125805, 3230314450,
            889723668, 3312911398, 2040926687, 1551018220, 217350907, 1190271637, 2196470418,
            582739501, 574580675, 627521985, 3462620295, 1826546772, 1200183559, 2511667565,
            3321520722, 1760501936, 3401858303, 2056315825, 2956669134, 591282350, 2228097677,
            3953970187, 3763033846, 3981289762, 2843535951, 4035523339, 1074508115, 3233409639,
            314820046, 1519729781, 1729078105, 4201604342, 3380921403, 2184949152, 2897857848,
            212321156, 481361797, 3780255393, 2528871308, 2219779174, 3502413298, 2433932491,
            2088433048, 1119465465, 553056530, 2681509152, 1990025128, 4113937421, 757723844,
            4065055099, 1438167045, 1714067756, 295039437, 3553014346, 1500257339, 121711495,
            1299814419, 1481787451, 466462561, 3450349124, 3354633040, 4197116852, 2300067620,
            2300312798, 734816444, 668372087, 610325644, 1820480332, 312923552, 1371828336,
            386480792, 3231465004, 2119854347, 2503795939, 37544982, 2127724350, 3977310867,
            906274532, 3014798043, 1163507806, 39393504, 3203870929, 2603325424, 601940205,
            1446813021, 4008328844, 1129836361, 2242436794, 1108252363, 710998579, 3822246787,
            4245857572, 227662739, 3162273355, 2718012967, 512837928, 1146047591, 1624412382,
            4172642116, 2479791213, 2246659717, 2115301250, 144504796, 3097248580, 1488044443,
            3235358299, 310016185, 727752929, 3403555569, 1034814907, 572097587, 1799465727,
            3315327068, 1904601168, 1060041227, 95653066, 3179621384, 2784606474, 3635929233,
            3002198637,
        ],
        &[
            925120207, 4225173411, 773590203, 2705088909, 760018119, 3560986781, 3276778645,
            569879745, 275063826, 3553444079, 3591608936, 938243104, 3604596571, 1820901407,
            4022554834, 1440792481, 574650989, 3656262710, 4150032702, 1559596409, 3960538469,
            1809314494, 2152378256, 825148860, 2074258358, 2059483645, 3119970833, 3052492792,
            1083432735, 2994856903, 3287600147, 2502703055, 1752688956, 4149576868, 1709984301,
            3235915685, 487122947, 437538202, 3178502734, 1263854855, 135705911, 2843982074,
            4164166971, 4100829511, 3031022541, 3201076966, 1805387578, 1826440600, 557213027,
            2792934052, 2243352750, 1801883920, 3301321918, 469048417, 2725138727, 2947700289,
            1913798124, 574678647, 2000040094, 2336849657, 3912194680, 1616490328, 2363261019,
            3380210359, 2784609072, 835985245, 1062319853, 2519822447, 4185407058, 3253459482,
            3240288702, 3425190358, 3392304118, 3339858917, 227057671, 2117867538, 1238503500,
            1783611406, 1671436072, 4020871006, 3708283179, 1814419869, 2809845213, 402675383,
            700520900, 4021715245, 3864091313, 1886661387, 2898624118, 2266154557, 1538350152,
            4205425742, 2641391768, 3508390452, 202172288, 2270033614, 787751496, 4225843194,
            2087465714, 718749793, 4160365132, 121686135, 3232242907, 1290170166, 2696610438,
            2043913461, 2304403306,
        ],
        false,
        &[
            4221978630, 1973199499, 4118761517, 1280124308, 1169734844, 4186771056, 1549813668,
            2075241811, 3420909216, 3907043806, 2541993804, 282548280, 1975129143, 3336674855,
            4090776129, 2428071752, 3676342369, 3454430534, 316538936, 243907370, 2971927846,
            251436476, 2221794683, 2822328444, 528428056, 1993265952, 3040794479, 4050913221,
            2509817742, 2793009366, 3346235129, 4179770275, 1329386656, 3069305579, 422911051,
            232216774, 3312143191, 81270597, 779322188, 1011095209, 1055038871, 1975842925,
            1732790895, 733239904, 1557320335, 1710699531, 4221175046, 721245441, 2600219287,
            1818367711, 1883945801, 1722730504, 3667715777, 3514130820, 2079744029, 4097159692,
            8702783, 1634848318, 4003868364, 3189174634, 154328123, 3136083300, 1256793950,
            3908958390, 3995938868, 3505295673, 15682981, 1733079452, 2199765868, 1399865418,
            3931463027, 216129100, 1771409837, 4170117419, 2889309579, 1323366430, 3037738897,
            3024721374, 3698031352, 1843487639, 2640258708, 2514361590, 67538017, 3752890769,
            2377631023, 1117874819, 2034201383, 3233935115, 186520404, 1781753373, 2159589499,
            1457819895, 1955947342, 3294618852, 2583537479, 1780703679, 1295362239, 4288927730,
            3528770822, 290885828, 1022721043, 2379556752, 249111996, 1042924458, 3285072303,
            1799654769, 341780256, 2011707698, 4011728901, 4131230694, 243833190, 3438825130,
            732870287, 3977999178, 1964878050, 1772633237, 3427011489, 4149075167, 3147152113,
            4186542306, 3008212122, 2269822538, 2457396003, 2899887041, 3084745386, 2805864858,
            2636345155, 2806159180, 1448641497, 1724536998, 3602736476, 670315274, 821858587,
            3976166693, 1431302113, 994517893, 3205096696, 734083218, 684810460, 871706632,
            1619463495, 1943812284, 3232191634, 1688008439, 959671513, 861714098, 3632682856,
            4008579961, 1713155910, 621038709, 2171689707, 16974992, 1322572013, 3716365836,
            1503115330, 3655753010, 3148139022, 862756091, 2477797665, 1345732090, 2351929785,
            4244479677, 3338662555, 590731935, 3482514189, 1766212776, 1514121012, 3065000224,
            1126651654, 3402553599, 4032051831, 2997384063, 1732308544, 1185658163, 505658742,
            12068286, 191037370, 3820036984, 1808669698, 4025106072, 1258717124, 2996770408,
            104941276, 3293831485, 3303505858, 1959694112, 2104003029, 513795826, 682626035,
            1611502331, 165846820, 3906438907, 2655225469, 1304471424, 2263663116, 2896749335,
            2359126350, 2213606484, 1429710281, 2842535444, 2328001305, 1030529844, 72684272,
            3885232193, 4190971495, 1802226099, 3077502465, 1399196074, 15975559, 1608426341,
            2824610166, 3242678682, 97752959, 1141976170, 2545270306, 2934382174, 1423201353,
            4009237774, 989437497, 3792380846, 2436069063, 101138334, 3054205179, 476518326,
            45092653, 1388468856, 622609810, 3089605077, 273759253, 2522262643,
        ],
        &[
            1326262193, 4033304858, 3860284891, 3270761392, 301590389, 3160950768, 2103051311,
            421308210, 339700217, 2084975913, 4010857750, 3321647285, 2893234504, 3337934258,
            2470197482, 3426298259, 3795587565, 2533784226, 1029322143, 2753534641, 1002751731,
            1383277453, 1739180040, 4179121877, 686043541, 3404602754, 2524149226, 1961421140,
            739626289, 50422302, 4167603214, 890939538, 544526709, 333127915, 1031745192,
            2528526981, 2519624435, 2088255264, 2561443326, 3976592858, 1904453814, 37801928,
            2483368030, 3723552401, 479916426, 2605772934, 4101701491, 2731241841, 516350289,
            1540979081, 2317342783, 3699898529, 2962115900, 618662503, 360824901, 2483974833,
            3444107029, 23562940, 1137290279, 793246641, 3743331916, 1726283098, 3569199524,
            898653133, 4096842332, 1438551593, 32970915, 3426974921, 444732961, 724921875,
            1414708840, 1717003917, 1924528246, 4171817847, 3372667246, 3830123695, 927406351,
            2027580181, 1664983727, 2533132252, 1161370976, 2395800918, 1493087279, 3712645656,
            216022641, 405129823, 437352819, 2790439088, 3977337552, 1902827120, 3057912539,
            3003163486, 3875702633, 3752739451, 987987508, 2784338852, 840729416, 101169395,
            3198958489, 4287799304, 1745316888, 3524003193, 1226093819, 3034997281, 714903529,
            1035449811, 1648914672,
        ],
    );
}

#[cfg(feature = "32_bit_limbs")]
#[test]
#[should_panic]
fn limbs_modular_div_mod_divide_and_conquer_fail_1() {
    _limbs_modular_div_mod_divide_and_conquer(&mut [10; 3], &mut [1, 2, 3], &[], 1);
}

#[cfg(feature = "32_bit_limbs")]
#[test]
#[should_panic]
fn limbs_modular_div_mod_divide_and_conquer_fail_2() {
    let ds = &[1, 2, 3];
    let inverse = limbs_modular_invert_limb(ds[0]).wrapping_neg();
    _limbs_modular_div_mod_divide_and_conquer(&mut [10; 3], &mut [1, 2, 3], ds, inverse);
}

#[cfg(feature = "32_bit_limbs")]
#[test]
#[should_panic]
fn limbs_modular_div_mod_divide_and_conquer_fail_3() {
    let ds = &[1, 2];
    let inverse = limbs_modular_invert_limb(ds[0]).wrapping_neg();
    _limbs_modular_div_mod_divide_and_conquer(&mut [], &mut [1, 2, 3], ds, inverse);
}

#[cfg(feature = "32_bit_limbs")]
#[test]
#[should_panic]
fn limbs_modular_div_mod_divide_and_conquer_fail_4() {
    let ds = &[4, 5];
    let inverse = limbs_modular_invert_limb(ds[0]).wrapping_neg();
    _limbs_modular_div_mod_divide_and_conquer(&mut [10; 3], &mut [1, 2, 3], ds, inverse);
}

fn verify_limbs_modular_div(ns: &[Limb], ds: &[Limb], qs: &[Limb]) {
    let n = Natural::from_limbs_asc(ns);
    let d = Natural::from_limbs_asc(ds);
    let q = Natural::from_limbs_asc(qs);
    assert_eq!(
        (q * d).mod_power_of_two(u64::wrapping_from(ns.len()) << Limb::LOG_WIDTH),
        n
    );
}

#[cfg(feature = "32_bit_limbs")]
#[test]
fn test_limbs_modular_div_schoolbook() {
    let test = |qs_in: &[Limb], ns_in: &[Limb], ds: &[Limb], qs_out: &[Limb]| {
        let mut qs = qs_in.to_vec();
        let mut ns = ns_in.to_vec();
        let inverse = limbs_modular_invert_limb(ds[0]).wrapping_neg();
        _limbs_modular_div_schoolbook(&mut qs, &mut ns, ds, inverse);
        assert_eq!(&qs[..ns.len()], qs_out);
        verify_limbs_modular_div(ns_in, ds, qs_out);
    };
    test(&[10; 3], &[0, 0, 0], &[1, 2], &[0, 0, 0]);
    test(&[10; 3], &[1, 2, 3], &[1, 2], &[1, 0, 3]);
    test(
        &[10; 3],
        &[1, 2, 3],
        &[5, 6],
        &[3435973837, 3607772528, 3401614098],
    );
    test(&[10; 3], &[1, 2, 3], &[1, 2, 3], &[1, 0, 0]);
    test(&[10; 3], &[1, 2, 3], &[1, 0xffff_ffff, 3], &[1, 3, 2]);
}

#[cfg(feature = "32_bit_limbs")]
#[test]
#[should_panic]
fn limbs_modular_div_schoolbook_fail_1() {
    _limbs_modular_div_schoolbook(&mut [10; 3], &mut [1, 2, 3], &[], 1);
}

#[cfg(feature = "32_bit_limbs")]
#[test]
#[should_panic]
fn limbs_modular_div_schoolbook_fail_2() {
    let ds = &[1, 2, 3, 4];
    let inverse = limbs_modular_invert_limb(ds[0]).wrapping_neg();
    _limbs_modular_div_schoolbook(&mut [10; 3], &mut [1, 2, 3], ds, inverse);
}

#[cfg(feature = "32_bit_limbs")]
#[test]
#[should_panic]
fn limbs_modular_div_schoolbook_fail_3() {
    let ds = &[1, 2];
    let inverse = limbs_modular_invert_limb(ds[0]).wrapping_neg();
    _limbs_modular_div_schoolbook(&mut [10, 10], &mut [1, 2, 3], ds, inverse);
}

#[cfg(feature = "32_bit_limbs")]
#[test]
#[should_panic]
fn limbs_modular_div_schoolbook_fail_4() {
    let ds = &[4, 5];
    let inverse = limbs_modular_invert_limb(ds[0]).wrapping_neg();
    _limbs_modular_div_schoolbook(&mut [10; 3], &mut [1, 2, 3], ds, inverse);
}

#[cfg(feature = "32_bit_limbs")]
#[test]
fn test_limbs_modular_div_divide_and_conquer() {
    let test = |qs_in: &[Limb], ns_in: &[Limb], ds: &[Limb], qs_out: &[Limb]| {
        let mut qs = qs_in.to_vec();
        let mut ns = ns_in.to_vec();
        let inverse = limbs_modular_invert_limb(ds[0]).wrapping_neg();
        _limbs_modular_div_divide_and_conquer(&mut qs, &mut ns, ds, inverse);
        assert_eq!(&qs[..ns.len()], qs_out);
        verify_limbs_modular_div(ns_in, ds, qs_out);
    };
    // q_len > d_len first time
    // q_len < DC_BDIV_QR_THRESHOLD first time
    // q_len != d_len
    test(&[10; 3], &[0, 0, 0], &[1, 2], &[0, 0, 0]);
    test(&[10; 3], &[1, 2, 3], &[1, 2], &[1, 0, 3]);
    test(
        &[10; 3],
        &[1, 2, 3],
        &[5, 6],
        &[3435973837, 3607772528, 3401614098],
    );
    // q_len <= d_len
    // q_len < DC_BDIV_QR_THRESHOLD second time
    test(&[10; 3], &[1, 2, 3], &[1, 2, 3], &[1, 0, 0]);
    test(&[10; 3], &[1, 2, 3], &[1, 0xffff_ffff, 3], &[1, 3, 2]);
    // q_len == d_len
    test(
        &[10; 4],
        &[1, 2, 3, 4],
        &[5, 6],
        &[3435973837, 3607772528, 3401614098, 2790010755],
    );
    // q_len > d_len second time
    test(
        &[10; 5],
        &[1, 2, 3, 4, 5],
        &[7, 8],
        &[3067833783, 175304787, 3481052211, 2770888938, 2968937350],
    );
    // q_len >= DC_BDIV_QR_THRESHOLD first time
    test(
        &[10; 101],
        &[
            2614433502, 201952551, 1985699938, 3737156448, 1826834370, 390646530, 3862902767,
            3701087729, 3240671658, 1498939256, 405421884, 2500498977, 543951667, 3836845972,
            114681939, 1915271357, 1549193218, 2855181942, 1722136441, 2766310271, 47656978,
            3837638424, 4016489648, 3574908855, 271673898, 401895301, 1488021015, 2138694572,
            2044000169, 958933265, 3144481463, 2779079775, 1326886023, 2406822210, 3541050174,
            2770735565, 2480957566, 2243398174, 2238068283, 311009614, 1882015784, 1325726230,
            997031698, 1581908377, 2605721422, 3189028102, 272460210, 490645275, 2254115078,
            1729448452, 3279102284, 4891191, 3182892978, 4279769790, 76488030, 2146767575,
            3135871036, 2565128600, 1134722432, 4021959710, 2443099174, 3511788218, 3402507407,
            3887545637, 1602118380, 3373080814, 913482070, 2525212842, 458807656, 2191742476,
            189120803, 1571244040, 2065986906, 3536519990, 1106920062, 249073982, 3953429556,
            70634017, 2295215236, 1095935313, 3576698687, 4150987084, 3091466601, 2659048520,
            2421964497, 478008822, 4183767176, 3019500765, 472981990, 4237993573, 2387724271,
            2897482399, 2735157706, 3951571091, 1100488960, 772381751, 3385833448, 243788259,
            2673522310, 2507994216, 422336110,
        ],
        &[
            1465267273, 74481649, 4134700379, 1230170156, 365676293, 3483084975, 1197662581,
            2640006295, 4011823868, 3248823520, 3487252378, 2404109212, 1035566706, 2348272566,
            1563713437, 926167746, 4275574143, 2618001622, 3006090084, 758724212, 2363503275,
            2777706618, 36668516, 1573638162, 826631123, 1003261600, 3834425037, 3917704239,
            380020162, 1200612060, 4053700768, 4029551185, 1269962948, 3135204397, 1191219015,
            2005782900, 600631609, 2788434518, 160830671, 1865310436, 2821311021, 1359155705,
            390596229, 173852699, 2808888002, 845149215, 4091564759, 2997755999, 3196096033,
            2442709791, 2497943703,
        ],
        &[
            2268505070, 3175859475, 3142537387, 3900159731, 1159682617, 4189328550, 3907703309,
            1212735193, 532303389, 2766948169, 2016978110, 2967794961, 2774851624, 3217650683,
            2925509985, 3764969541, 958893059, 3417020824, 1954191584, 3562512044, 2446134389,
            2177043907, 2722738527, 1056354433, 163366464, 2100641128, 2795771616, 981138683,
            2004843724, 421545248, 931541656, 2667221997, 1053518296, 3427347852, 943193977,
            1693724312, 497384180, 1592766692, 3814767396, 496551406, 761630525, 122738561,
            2053011267, 3134192635, 3959716126, 756419570, 4291525522, 52995454, 2355566740,
            1535344262, 3457101895, 1561710520, 629646311, 1264617650, 1304911374, 3953997387,
            101220699, 606111922, 3169531883, 119225490, 2099572326, 3662568011, 2701978464,
            2354203828, 3024227856, 812859784, 3907484219, 895862916, 2367636279, 3049608863,
            3534493707, 303599528, 235895898, 3152156937, 3282734021, 2504903737, 3347451841,
            105947633, 2602282968, 2091238035, 1697885061, 2125538933, 1538362896, 3260245263,
            4185444552, 1173878884, 860722873, 4135695975, 3027742222, 4045316121, 684087923,
            2221029460, 2175787664, 4254578535, 1093169950, 3230867467, 1521099406, 1031502141,
            3310189672, 2767979128, 3491264110,
        ],
    );
    // n >= DC_BDIV_Q_THRESHOLD in _limbs_modular_div_divide_and_conquer_helper
    // lo < hi in _limbs_modular_div_divide_and_conquer_helper
    test(
        &[10; 369],
        &[
            926256687, 2852364395, 3370590143, 2584805050, 1597100583, 529558289, 126580396,
            4262060268, 1358185452, 3688826498, 2880947234, 2448955814, 2642826080, 1444415359,
            2262174529, 4252876126, 1546829518, 1026350339, 461104688, 3572581738, 1379301297,
            1469000044, 1232904583, 1130621172, 3414532348, 2076979854, 415474734, 138424304,
            2741622037, 1356956847, 3700037198, 3056382371, 4003358430, 4114290085, 2632329664,
            2757229707, 942973054, 2844466602, 2536850025, 1562205098, 2369019562, 479441879,
            1133122146, 3033404131, 799055770, 2801165147, 333840674, 1266456054, 3826844211,
            2394399329, 1580344224, 4208515641, 3938843492, 2943006000, 3095897464, 3657696853,
            1895017685, 1174400257, 856895147, 2769847676, 2637358396, 4211838346, 2677238745,
            3116142044, 2687432725, 1110573568, 933169252, 2112520496, 1203633399, 706652780,
            1876380535, 947010911, 2311376766, 3912635689, 3738597172, 2407075297, 1150178856,
            332957826, 2061573893, 1936087771, 2146544892, 3812143813, 4006647140, 1808470881,
            3639090995, 3102762721, 3422984617, 3555513955, 3249465976, 4102963672, 1077718033,
            2477507069, 1259888894, 1319895809, 2840602832, 488930783, 280413795, 1714984325,
            906714553, 4044121361, 2834701307, 353693245, 630667692, 714081891, 689252325,
            2538920747, 1229220355, 1965412395, 2366311709, 3490987487, 4244144248, 3004878982,
            1934198881, 3439419469, 584060055, 3763445399, 1754985895, 3426861913, 3852827741,
            2905990235, 591028154, 3955620274, 2446523634, 2269181228, 2155869554, 2785380931,
            1067038528, 4226586573, 938767979, 3463341351, 729920782, 3672068894, 3277213230,
            3829428878, 78609376, 2725264455, 1334526325, 3852128883, 83033112, 3171538426,
            212483737, 1705821676, 4130869601, 985721852, 4137618486, 3647946653, 2078761135,
            2033567134, 922945141, 2842773827, 2731090851, 3725966427, 346163520, 620359799,
            2807835138, 4251526149, 3329030547, 1785319896, 1412060986, 112477766, 2463195081,
            2269604331, 1667556850, 3069673827, 2451159887, 3531154947, 859465533, 797558571,
            2402685684, 1938998432, 3367592143, 1855629490, 415564883, 1771525305, 2108262482,
            878332057, 3591804465, 742811660, 2001773684, 869241071, 3406728833, 4240156422,
            1145567809, 1952848548, 1700151067, 95712656, 1166986301, 2821041275, 1639679488,
            836739412, 159195524, 2990285642, 1385013141, 4175880469, 612922039, 172085215,
            403018883, 954336314, 686090551, 1892450280, 3747619613, 4144413437, 2234712194,
            2339662600, 2244879528, 1753875098, 1838725682, 3357280280, 2192624967, 91122545,
            4248769883, 3595273608, 1004650549, 3206549498, 3722330732, 2319766803, 3308299148,
            3660385401, 1984746697, 2537428039, 837529793, 3423459313, 3380318451, 3600361999,
            1289811131, 2814141705, 1934106458, 1264409971, 2339500232, 2513439371, 628923995,
            161098739, 97046111, 528398469, 1351706370, 2700997745, 3433492154, 3705626784,
            2281353606, 2351376214, 78178014, 4256447668, 2755024441, 1600945286, 2135856519,
            2332322194, 1336372796, 924574937, 3984145695, 806549767, 1455952508, 1602006824,
            1992184377, 175977061, 2976584306, 1501249388, 3211774572, 2177299115, 2436808205,
            1296153861, 1528208726, 2086869059, 4256091310, 3359280803, 3794379308, 2845006300,
            3370727254, 4191386263, 3868923083, 4024786060, 3356572949, 1309623451, 3404587756,
            799637471, 2539690724, 3538256419, 1789660732, 993651510, 868809315, 4070903506,
            3500550366, 3537383550, 3000705462, 2011729323, 1276336091, 3715263489, 3856442137,
            3078455161, 2394585974, 1731395403, 209285071, 4286415453, 3634201569, 2714865379,
            3923934404, 1590322431, 2827746455, 4104930505, 1849053889, 1110373541, 2098826577,
            3752273612, 1449873597, 1543844883, 3523617712, 4278529692, 3074073157, 32217677,
            2222114104, 1507299609, 4254234641, 619965639, 52325523, 2586116737, 3828937288,
            841926627, 3927959971, 1429216471, 4078179238, 4166937366, 964935962, 846542155,
            3665864344, 1340829030, 3980686425, 1463832311, 2710331305, 4041927928, 287911129,
            1092730462, 1712349041, 332408781, 721925455, 3228519043, 2399858087, 1126502586,
            1239406845, 1890441075, 3602881664, 1720394596, 1136141449, 2550451241, 2108470819,
            2381224270, 196743147, 2289453443, 3352746316, 1442822225, 195272465, 1977411238,
            619069892, 1120443118, 2367263780, 2339580211, 3244857684, 413188862, 3648382353,
            1866426486, 3275669837, 714860356, 2503398064, 3520234361, 2602261672, 142956137,
            3457786845, 1647737711, 3596429731, 98035229, 2134549817,
        ],
        &[
            288812247, 1867980581, 1784848883, 3719376405, 891732341, 4042694263, 2315971843,
            4173934812, 3724384121, 3438649023, 817688419, 3717708150, 392002651, 1406301870,
            3000223143, 3208696401, 3333344771, 2069472443, 2868745797, 2276970520, 4200672618,
            4286576728, 3178657413, 2709499760, 3528379042, 37056359, 713896147, 1464335286,
            999714577, 4261103320, 2842057702, 532870143, 318250036, 454191633, 3585978181,
            3853346096, 232386666, 4153228123, 3001669262, 2644858239, 1372523035, 1638844646,
            221021648, 2633701374, 3889749815, 3749206185, 2682504994, 1691062985, 1564838714,
            2021047227, 3653939067, 375766416, 1676298932, 1632585265, 1987642618, 3216589770,
            2139352178, 3531691061, 3135733087, 2974439634, 3240759359, 1441918073, 2963546690,
            956474789, 1010096752, 3295505885, 1556487598, 2763009589, 2181664193, 3830580006,
            567013630, 1792629848, 3395572099, 3047782274, 849031602, 3372175233, 1238500612,
            3602622896, 1224295906, 514205489, 615596822, 3650298487, 3835144940, 4230075746,
            3563666002, 2171604008, 3860998558, 4030801816, 1966076533, 534702268, 4096165465,
            118025721, 3217620626, 1281269306, 2026131743, 1083491983, 2634322198, 1319079531,
            384610271, 343671134, 1924283281, 4110082962, 1035723460, 7922039, 1864294974,
            3433501319, 612818706, 2074478411, 430050897, 347224817, 3689916278, 431159468,
            2396947295, 2216850314, 2873958193, 1052280319, 3807224736, 3366982378, 445016867,
            801857639, 2770754059, 2166713172, 2421080783, 4293281425, 3315144969, 832988729,
            3203751531, 60602646, 3435936620, 2013384606, 3375674785, 506953530, 4135169500,
            2547839556, 1670695010, 2532819097, 1595078260, 1906874739, 4140805961, 909986610,
            1450206000, 2416600358, 78210121, 2461045671, 3017469740, 1248552863, 2491666236,
            3529749845, 1306097619, 609634854, 1618830814,
        ],
        &[
            2153621097, 2032975874, 1092283530, 2105499851, 2772147020, 797232604, 4197023255,
            2316448335, 231339989, 790127543, 2827859807, 3740953002, 2953654149, 4028925052,
            890100763, 944013012, 3074009738, 2799155639, 1581696516, 421616097, 2763522161,
            460382413, 3452929191, 1491944014, 1268408485, 3706732519, 987986692, 1185168616,
            312846948, 1736211677, 4257673428, 3728427015, 3445998410, 2787875431, 2693980376,
            2270279443, 1915043797, 4081500771, 22182374, 2602808921, 4089111581, 316485891,
            1787500084, 2286785318, 1422270801, 799485298, 870038934, 2055189464, 3431348353,
            2777540456, 426645251, 1311005497, 3234663366, 540942104, 1278767054, 3141018165,
            3997602571, 3885692388, 2906279738, 1880065873, 701408818, 1624620668, 2502792336,
            27895058, 3449141668, 731396337, 2025748336, 3252039671, 2316581185, 1576067456,
            959043581, 4043904286, 3885331851, 1432462822, 3531781850, 3866289759, 1120305997,
            421733220, 2095656685, 306908537, 1829908494, 3026950391, 2753364951, 2446351196,
            3811823100, 2096821518, 2024511440, 1827913918, 540355707, 1677071333, 2189975772,
            1140077230, 2361607088, 3292807914, 1616778383, 1428264564, 4185564524, 4078951710,
            3050933070, 1900914292, 1656040826, 4169852007, 3654163666, 459884159, 1142386374,
            2092770650, 4093216198, 3297930392, 1585102456, 2240909415, 2977419294, 1424884171,
            3131984332, 3677770202, 1103210323, 3732259374, 3405359572, 1239187170, 1233825656,
            1171077559, 3166656449, 3557574007, 2517986752, 298018080, 64725485, 3157564402,
            1895722919, 3711770814, 2165944903, 4108826234, 39205698, 3297059852, 2709772591,
            3472388897, 1795079771, 1014084034, 1690969319, 188496797, 362199350, 1538080346,
            3295087220, 3035112492, 860797619, 2138464630, 893193827, 3209353152, 1892791880,
            3956061449, 2582762448, 123764390, 3853335455, 1109119369, 2810579875, 2557150328,
            194723070, 1511406773, 308580645, 1506805209, 3800717643, 1154701911, 3327639678,
            1742392333, 383847505, 808485729, 1107933974, 1843546476, 3160127489, 461019178,
            2758534633, 3136176283, 4161349001, 1122667843, 529002233, 1756067056, 610266011,
            868502089, 1924153935, 3733910978, 2089140891, 2010741130, 1699263293, 1974321295,
            2337744872, 2401421411, 152242715, 1841948095, 4080892494, 3557450617, 1648335241,
            1739529953, 1965700723, 4159737024, 1826643625, 2624044999, 2662463178, 1453688703,
            2373328295, 1284900613, 166103125, 2950850796, 224937865, 2363667655, 1395721930,
            1038140390, 2227351547, 4027728456, 2456853028, 3392407547, 3558026617, 1022960493,
            324320014, 1741363959, 665626647, 1989801844, 1039225187, 2749242260, 2891585679,
            413980454, 1421911978, 542423805, 1198826717, 3829692439, 2424493878, 1743568705,
            3904138435, 957436945, 3380949485, 3874828753, 3764048544, 2784271009, 3709257819,
            2420168014, 2258006234, 1818204898, 4293192208, 1516897791, 4231562984, 1087919881,
            3298788303, 409554742, 363790612, 1163362152, 1851768229, 3036249655, 1304207802,
            2757649751, 1345091600, 3980437826, 845106654, 1191417084, 789417113, 3069537799,
            4128120253, 1724644264, 1850762321, 440075901, 3081463549, 3296565609, 880610907,
            3604815503, 825119004, 662787316, 2065720314, 1905930059, 3158622573, 2441285185,
            609976312, 3214173289, 1972737948, 1856923900, 3881955749, 147509891, 13256522,
            480264715, 2304077206, 4079499728, 1733454240, 683301825, 2067789682, 357755971,
            4064960581, 880616108, 2567161687, 2143724680, 295233846, 885328588, 3528678059,
            2821762581, 438733817, 1651128958, 266078579, 389905061, 451514054, 1632102041,
            3121845303, 1370227908, 2165682378, 4205795758, 3678759448, 3760360877, 3616397292,
            3496735510, 2181567729, 1760479516, 2226441722, 1169335764, 1685289328, 3980766219,
            584449244, 1198456230, 3262408896, 3506319243, 3461775774, 3985269650, 4207509002,
            2496174343, 4246361431, 2525595216, 505792351, 694109202, 2532334608, 177977694,
            3590514888, 1386331403, 3322919897, 3677035627, 1748970524, 2355331384, 2803452306,
            1684779748, 431295285, 2720257929, 1349292466, 196319200, 721926885, 2699941953,
            2509363172, 2856348470, 971658703, 3158854173, 648569495, 806886112, 894065939,
            1809981633, 2207773884, 2422134450, 2395969450, 154939100, 2258690857, 1558269103,
            3746056343, 3625500344, 1655744570, 3783968316, 2684172985, 1026377946, 2668609092,
            3087350250, 1696799137, 4172271775, 2172265355, 1009592900, 3751494892, 1102570367,
            728659538, 896138123, 62660027, 2953563063, 2225405012,
        ],
    );
    // lo == hi in _limbs_modular_div_divide_and_conquer_helper
    test(
        &[10; 130],
        &[
            3959967020, 604241247, 1023896993, 1094415464, 1559137023, 2965982948, 2156029102,
            1706771649, 894030132, 45266116, 3024397174, 2788172395, 890061141, 3642398662,
            2446922996, 2040815673, 4240388236, 3527485030, 2696135743, 1863211571, 4250621960,
            2587213674, 4041734617, 3833321094, 3255910635, 1391342501, 405445752, 1166990562,
            3729755900, 3449768038, 3995921119, 41398076, 589125403, 1408294985, 2526515658,
            979087391, 1829542521, 2584013937, 86635251, 3289463217, 1129003160, 4215486047,
            2533366306, 2464115291, 3785087535, 2492911607, 1526230004, 1102360497, 3665011293,
            2884421895, 324933681, 708889365, 377966516, 1925322820, 2718776900, 3007014420,
            2694491006, 64698980, 2283839644, 3204232940, 897214742, 3983354864, 1516406610,
            4133557944, 2175029320, 609379471, 564247587, 683039961, 1804280416, 4145184207,
            4080873242, 3101363732, 4184296551, 3096748957, 1158225507, 2896147906, 1844344520,
            2528253875, 2002410714, 265589879, 3121801985, 3170049206, 1924743552, 3357216142,
            1965153305, 4252960808, 2092345429, 2837817119, 4284431393, 4293590240, 654671346,
            442937916, 1896790019, 691824410, 525764843, 1906879578, 1441648208, 101533739,
            1634254350, 3353889676, 3656414560, 1273785308, 3544127466, 3459937121, 870751892,
            1042879338, 266055738, 1555417213, 1241879745, 1883960373, 1942927191, 1838179445,
            1068713063, 2025583273, 531467322, 1876253978, 3303292405, 414426425, 1511200112,
            4106411687, 3527482414, 1961626864, 2704598906, 3866316252, 3265850188, 3581763702,
            1084651282, 3286715315, 3240494590, 2037895289,
        ],
        &[
            831013375, 20762440, 1023050464, 2893474254, 1340969251, 2523392356, 3059428058,
            4273516901, 733612744, 2348114766, 527881926, 1821776884, 342733126, 533682011,
            3273669965, 3813354237, 730319485, 3494597442, 3842303180, 2653483407, 1439592834,
            1040222095, 4178562882, 3903858398, 1448880503, 453957758, 2591332887, 1627251265,
            3845154845, 2189626142, 2509689197, 1600458471, 2116253912, 567231261, 4265711834,
            4030352409, 1804529170, 4286478946, 2730794561, 4214016930, 265468824, 1147813206,
            1770605310, 3394893197, 1654160857, 531943003, 32521814, 4040486896, 1507001215,
            3704501969, 651705156, 969516949, 24702145, 1664997108, 421558584, 372837233,
            1254072677, 531592109, 3829378883, 2113868005, 960337326, 3547746167, 1987930996,
            3779916457, 3178987148, 2246813569, 111988945, 2002604914, 923221962, 1220517471,
            3875731717, 456825253, 4034876422, 444954392, 2767163540, 2138086216, 2109913076,
            4089697693, 1989588591, 1122017014, 722640034, 2406717790, 980978606, 3956008296,
            1092718561, 396048014, 3434190160, 3721687760, 980653819, 2134907925, 1119974854,
            3412876362, 3043790819, 185604051, 2832132094, 3655349262, 2911925829, 377462795,
            2359250992, 3598561591, 1539340059, 4033418662, 2214700100, 3039512018, 3007111049,
            4215728089, 2804550486, 3578434606, 227455404, 265376688, 2221211195, 1024077580,
            4234081405, 2702795924, 1578634809, 696069720, 1613277316, 1828976876, 1070942553,
            2681872839, 2525247432, 352687185,
        ],
        &[
            2214746836, 963790571, 514240474, 3287959011, 3633281888, 331145186, 2070936355,
            1275814903, 649598638, 4048580142, 703307156, 1012761762, 1604206100, 3671704900,
            1413149070, 1684128911, 3864334051, 3517749930, 404335570, 3003402025, 300542403,
            3126191669, 3699252803, 1439364308, 4192415949, 1299197928, 1611984161, 2452019244,
            1490517426, 3629863277, 2995875193, 4190690602, 3357095237, 2125051168, 2745878491,
            133070914, 2983910851, 2032579934, 3884117502, 2707418796, 147936035, 2807568299,
            463241876, 2904771792, 974710149, 1446026448, 1012503772, 1241584448, 1218926543,
            22512568, 3540164426, 3704594926, 1675610321, 4283065258, 1692490953, 1496989584,
            1037241778, 2303280516, 3682225212, 1739214044, 602765408, 4279069132, 4056574424,
            1288231393, 2447355568, 1822142590, 2659661918, 520518691, 877252364, 1172314748,
            2143580045, 2927546685, 1702611733, 3329775201, 265548959, 2886036575, 982951504,
            1898736712, 1808101939, 1001715132, 988772812, 3415931945, 3156345141, 2590276172,
            1147813273, 1551504667, 4036713818, 2703846994, 3378891303, 3501124044, 3973617807,
            2147277907, 1948408686, 3297628811, 4200352081, 73680938, 2715396127, 809994587,
            819313279, 2649935820, 3358862368, 3764689552, 1229451982, 3158810723, 1613280893,
            2296459508, 3037083750, 2496650271, 814520391, 1890901501, 2263419075, 880319244,
            571981604, 4091474119, 4150388764, 3742405101, 2249427916, 4175082452, 1674645979,
            71011260, 2431119031, 1958098093, 3007232024, 389827510, 355733904, 3385289187,
            3022974738, 3499817070, 70324044, 1955894168,
        ],
    );
    // q_len >= DC_BDIV_QR_THRESHOLD second time
    test(
        &[10; 136],
        &[
            1635505187, 367942507, 585747625, 3259895362, 2551559511, 2891390854, 210701094,
            253381911, 741016565, 1562764630, 647253529, 995079955, 1415112766, 1121555269,
            3264386894, 1432983665, 3084492729, 4197513843, 2107932479, 911748961, 1669179905,
            3062572274, 160542021, 1653853504, 3878824697, 4044369261, 1986777757, 3535266551,
            1866910827, 4275901664, 354208268, 1288584384, 2863182224, 1221901169, 1253657528,
            592130239, 3568722156, 2486101902, 483424561, 1575660483, 720736121, 1101685031,
            2565922629, 196632433, 1033148213, 969310472, 1995520702, 3260631554, 1562557993,
            45802047, 949951688, 3295028866, 2613836943, 4061881640, 2210607847, 14248080,
            1604642540, 3576146202, 1838134557, 4181752638, 2414843751, 3325579689, 2902708971,
            2230053926, 1716268270, 3844071486, 3423382254, 2254614074, 234521767, 3030206003,
            660556467, 4001187396, 3773254173, 2953162211, 943562247, 2352566705, 3238995051,
            2513628232, 1645194089, 4221434207, 298778061, 1395231701, 3223314097, 3370303237,
            1905903471, 1408845004, 3916893951, 3646732666, 162038877, 1235325374, 1651995328,
            4159903692, 716366148, 2592723919, 2588428010, 2841918047, 2236491801, 1439600422,
            268691456, 2330191766, 371571121, 2510936837, 1992243115, 888863283, 68281559,
            2527602368, 113695533, 2735585253, 1909150691, 1102365183, 1743094105, 2335719272,
            958887136, 4011105869, 2588799839, 630693297, 1764561812, 4102816119, 1751306966,
            3347952786, 2985949642, 2087233415, 4171910514, 4184815114, 2269683542, 2467143008,
            2240451464, 3865437579, 205000839, 537874053, 1119318572, 169965588, 2947313176,
            862816324, 3987040697, 1222400428,
        ],
        &[
            3139654297, 2963323009, 2614026787, 2578421476, 2191104461, 2624045036, 3640460632,
            1417210598, 3126930163, 1027257221, 460590703, 4066457807, 3459488871, 576203252,
            1688476041, 2466961360, 1837547601, 376220531, 4141413316, 1803893809, 1761371554,
            3478953436, 130868688, 3859844778, 2980999350, 3309259618, 1059925822, 2182828747,
            2005291310, 4234145897, 1408307661, 3344594438, 3438553526, 2363099253, 2188599822,
            3464723571, 1041189464, 1746045537, 1958228487, 3752307692, 303751983, 1642664874,
            131752811, 1640394963, 2637801305, 3516563951, 1933714212, 1737019176, 2450206053,
            503586131, 126392718, 2688144827, 1242477456, 2295392334, 466349000, 2569462004,
            1318597067, 1300781532, 1655398676, 2050075490, 3903849354, 3120503464, 171096473,
            29581654, 3447431964, 832547958, 3444142819, 3539975343, 4114704783, 521462868,
            251982313, 1371581103, 3750111566, 2076014585, 988831298, 3885431509, 2528566949,
            1332909323, 41017395, 250182185, 190467400, 477317824, 3346975325, 1469734194,
            3287617291, 1797244834, 3716306921, 3132805196, 4130477334, 931614979, 4159691979,
            2278615012, 3033894917, 953086932, 887198557, 3075690000, 189881536, 2562655208,
            2340948573, 1756155681, 1434962210, 1786798745, 2696354320, 466230606, 265495223,
            3772572252, 4060091719, 4091929587, 2602735823, 3377510257, 285339272, 1093341111,
            1082532166, 1615653819, 2657481369, 1946488895, 3281845888, 8959603, 969779240,
            3948725158, 3119648217, 4059928239, 2639117089, 715898173, 3730038209, 2531002727,
            656254619, 4082370365, 4254910891, 2266367871, 2845947517, 91542353, 988318600,
            2012804020, 2917139165, 2687206014,
        ],
        &[
            344182299, 3565607671, 1425615408, 3688127580, 932395430, 2078412097, 712144307,
            2579135290, 1670334397, 3526571898, 527889915, 1847317444, 3706898982, 1670379914,
            3028965264, 1454573587, 1233674887, 1842735039, 673704170, 2755491011, 3144215569,
            2844132685, 3976352845, 3704439681, 2871494744, 563225203, 477319433, 2394374187,
            3361238262, 4097585783, 2091409235, 2989027616, 251393985, 2038664131, 1900105723,
            2726074037, 3903048322, 601506890, 4227623429, 3732979811, 2904090093, 3911663358,
            694119437, 2312158283, 3761860359, 1226110613, 2077730233, 2543223326, 3098049773,
            3187544264, 3680092572, 3815125216, 1990113409, 382920264, 3200154083, 970587848,
            1032771863, 1792989867, 408437052, 2035811594, 2495259018, 423722523, 3044771958,
            1864896105, 2129868689, 188726050, 1810624947, 1128856008, 504663759, 221476670,
            3718864116, 2197791369, 288158522, 1522677473, 4187008757, 3299027054, 3045833372,
            1408455415, 2175274137, 54848700, 3470586256, 2721864863, 3804754388, 1239548951,
            3301368160, 982306786, 3770156486, 3880485126, 2829505820, 2147636394, 2199815955,
            3505488481, 1942842807, 1772747693, 4108779241, 2096541274, 930806315, 421709313,
            3631892223, 1621500079, 1514788551, 2479798345, 4264484840, 4155460021, 258059056,
            2718683630, 3598111667, 3304295306, 3429094861, 516349540, 2653253840, 1683537378,
            3529770422, 112780533, 2171129104, 167784124, 2755669738, 3293537875, 3629382442,
            614431521, 657960320, 376396606, 4098436288, 822064619, 226101057, 1630664330,
            10604005, 2512924628, 3388389178, 3002235032, 485512099, 1009076950, 1391753479,
            286560938, 1910351313, 2438028481,
        ],
    );
}

#[cfg(feature = "32_bit_limbs")]
#[test]
#[should_panic]
fn limbs_modular_div_divide_and_conquer_fail_1() {
    let ds = &[4];
    let inverse = limbs_modular_invert_limb(ds[0]).wrapping_neg();
    _limbs_modular_div_divide_and_conquer(&mut [10; 3], &mut [1, 2, 3], ds, inverse);
}

#[cfg(feature = "32_bit_limbs")]
#[test]
#[should_panic]
fn limbs_modular_div_divide_and_conquer_fail_2() {
    let ds = &[1, 2, 3, 4];
    let inverse = limbs_modular_invert_limb(ds[0]).wrapping_neg();
    _limbs_modular_div_divide_and_conquer(&mut [10; 3], &mut [1, 2, 3], ds, inverse);
}

#[cfg(feature = "32_bit_limbs")]
#[test]
#[should_panic]
fn limbs_modular_div_divide_and_conquer_fail_3() {
    let ds = &[1, 2];
    let inverse = limbs_modular_invert_limb(ds[0]).wrapping_neg();
    _limbs_modular_div_divide_and_conquer(&mut [10, 10], &mut [1, 2, 3], ds, inverse);
}

#[cfg(feature = "32_bit_limbs")]
#[test]
#[should_panic]
fn limbs_modular_div_divide_and_conquer_fail_4() {
    let ds = &[4, 5];
    let inverse = limbs_modular_invert_limb(ds[0]).wrapping_neg();
    _limbs_modular_div_divide_and_conquer(&mut [10; 3], &mut [1, 2, 3], ds, inverse);
}

#[test]
fn limbs_modular_invert_properties() {
    test_properties_custom_scale(512, pairs_of_unsigned_vec_var_12, |&(ref is, ref ds)| {
        let mut is = is.to_vec();
        let n = ds.len();
        let mut scratch = vec![0; limbs_modular_invert_scratch_len(n)];
        limbs_modular_invert(&mut is, ds, &mut scratch);
        verify_limbs_modular_invert(ds, &is[..n]);
    });
}

#[test]
fn limbs_modular_div_mod_schoolbook_properties() {
    test_properties(
        quadruples_of_three_unsigned_vecs_and_unsigned_var_4,
        |&(ref qs, ref ns, ref ds, inverse)| {
            let ns_old = ns;
            let mut qs = qs.to_vec();
            let mut ns = ns.to_vec();
            let borrow = _limbs_modular_div_mod_schoolbook(&mut qs, &mut ns, ds, inverse);
            let q_len = ns.len() - ds.len();
            verify_limbs_modular_div_mod(ns_old, ds, borrow, &qs[..q_len], &ns[q_len..]);
        },
    );
}

#[test]
fn limbs_modular_div_mod_divide_and_conquer_properties() {
    test_properties_custom_scale(
        128,
        quadruples_of_three_unsigned_vecs_and_unsigned_var_5,
        |&(ref qs, ref ns, ref ds, inverse)| {
            let ns_old = ns;
            let mut qs = qs.to_vec();
            let mut ns = ns.to_vec();
            let borrow = _limbs_modular_div_mod_divide_and_conquer(&mut qs, &mut ns, ds, inverse);
            let q_len = ns.len() - ds.len();
            verify_limbs_modular_div_mod(ns_old, ds, borrow, &qs[..q_len], &ns[q_len..]);
        },
    );
}

#[test]
fn limbs_modular_div_schoolbook_properties() {
    test_properties(
        quadruples_of_three_unsigned_vecs_and_unsigned_var_3,
        |&(ref qs, ref ns, ref ds, inverse)| {
            let ns_old = ns;
            let mut qs = qs.to_vec();
            let mut ns = ns.to_vec();
            _limbs_modular_div_schoolbook(&mut qs, &mut ns, ds, inverse);
            verify_limbs_modular_div(ns_old, ds, &qs);
        },
    );
}

#[test]
fn limbs_modular_div_divide_and_conquer_properties() {
    test_properties_custom_scale(
        512,
        quadruples_of_three_unsigned_vecs_and_unsigned_var_6,
        |&(ref qs, ref ns, ref ds, inverse)| {
            let ns_old = ns;
            let mut qs = qs.to_vec();
            let mut ns = ns.to_vec();
            _limbs_modular_div_divide_and_conquer(&mut qs, &mut ns, ds, inverse);
            verify_limbs_modular_div(ns_old, ds, &qs);
        },
    );
}
