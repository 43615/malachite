use std::str::FromStr;

use malachite_base::num::arithmetic::traits::{
    CeilingDivNegMod, DivMod, Mod, ModAssign, NegMod, NegModAssign,
};
use malachite_base::num::basic::traits::{One, Zero};
use malachite_base::num::conversion::traits::JoinHalves;
use malachite_nz::natural::arithmetic::div_mod::limbs_two_limb_inverse_helper;
use malachite_nz::natural::arithmetic::mod_op::{
    _limbs_mod_divide_and_conquer, _limbs_mod_schoolbook, limbs_mod_by_two_limb_normalized,
    limbs_mod_three_limb_by_two_limb,
};
use malachite_nz::natural::Natural;
use malachite_nz::platform::{DoubleLimb, Limb};
use num::{BigUint, Integer};
use rug;
use rug::ops::RemRounding;

use common::{test_properties, test_properties_custom_scale};
use malachite_test::common::{
    biguint_to_natural, natural_to_biguint, natural_to_rug_integer, rug_integer_to_natural,
};
use malachite_test::inputs::base::{
    pairs_of_unsigned_vec_var_10, quadruples_of_three_unsigned_vecs_and_unsigned_var_2,
    sextuples_of_limbs_var_1, triples_of_two_unsigned_vecs_and_unsigned_var_1,
};
use malachite_test::inputs::natural::{
    naturals, pairs_of_natural_and_positive_natural, pairs_of_natural_and_positive_natural_var_1,
    pairs_of_natural_and_positive_unsigned, pairs_of_unsigned_and_positive_natural,
    positive_naturals, triples_of_natural_natural_and_positive_natural,
};
use malachite_test::natural::arithmetic::mod_op::rug_neg_mod;

fn verify_limbs_mod_three_limb_by_two_limb(
    n_2: Limb,
    n_1: Limb,
    n_0: Limb,
    d_1: Limb,
    d_0: Limb,
    r: DoubleLimb,
) {
    let n = Natural::from_owned_limbs_asc(vec![n_0, n_1, n_2]);
    let d = Natural::from(DoubleLimb::join_halves(d_1, d_0));
    let r = Natural::from(r);
    assert_eq!(n % &d, r);
    assert!(r < d);
}

#[cfg(feature = "32_bit_limbs")]
#[test]
fn test_limbs_mod_three_limb_by_two_limb() {
    let test = |n_2, n_1, n_0, d_1, d_0, r| {
        assert_eq!(
            limbs_mod_three_limb_by_two_limb(
                n_2,
                n_1,
                n_0,
                d_1,
                d_0,
                limbs_two_limb_inverse_helper(d_1, d_0)
            ),
            r
        );
        verify_limbs_mod_three_limb_by_two_limb(n_2, n_1, n_0, d_1, d_0, r);
    };
    test(1, 2, 3, 0x8000_0004, 5, 0x7fff_fffd_ffff_fffe);
    test(2, 0x4000_0000, 4, 0x8000_0000, 0, 0x4000_0000_0000_0004);
    test(
        1614123406,
        3687984980,
        2695202596,
        2258238141,
        1642523191,
        274277675918877623,
    );
}

fn verify_limbs_mod_by_two_limb_normalized(ns: &[Limb], ds: &[Limb], r_0: Limb, r_1: Limb) {
    let n = Natural::from_limbs_asc(ns);
    let d = Natural::from_limbs_asc(ds);
    let expected_r = n % &d;
    let r = Natural::from_owned_limbs_asc(vec![r_0, r_1]);
    assert_eq!(r, expected_r);
    assert!(r < d);
}

#[cfg(feature = "32_bit_limbs")]
#[test]
fn test_limbs_mod_by_two_limb_normalized() {
    let test = |ns: &[Limb], ds: &[Limb], r_0: Limb, r_1: Limb| {
        assert_eq!(limbs_mod_by_two_limb_normalized(ns, ds), (r_0, r_1));
        verify_limbs_mod_by_two_limb_normalized(ns, ds, r_0, r_1);
    };
    test(&[1, 2], &[3, 0x8000_0000], 1, 2);
    test(&[1, 2, 3, 4, 5], &[3, 0x8000_0000], 166, 2147483626);
    test(
        &[4142767597, 2922703399, 3921445909],
        &[2952867570, 2530544119],
        3037232599,
        1218898013,
    );
}

#[test]
#[should_panic]
fn limbs_mod_by_two_limb_normalized_fail_1() {
    limbs_mod_by_two_limb_normalized(&[1, 2], &[3, 4]);
}

#[test]
#[should_panic]
fn limbs_mod_by_two_limb_normalized_fail_2() {
    limbs_mod_by_two_limb_normalized(&[1, 2], &[3, 0x8000_0000, 4]);
}

fn verify_limbs_mod(ns_in: &[Limb], ds: &[Limb], ns_out: &[Limb]) {
    let n = Natural::from_limbs_asc(ns_in);
    let d = Natural::from_limbs_asc(ds);
    let expected_r = n % &d;
    let r = Natural::from_limbs_asc(&ns_out[..ds.len()]);
    assert_eq!(r, expected_r);
    assert!(r < d);
}

#[test]
fn test_limbs_mod_schoolbook() {
    let test = |ns_in: &[Limb], ds: &[Limb], ns_out: &[Limb]| {
        let mut ns = ns_in.to_vec();
        let inverse = limbs_two_limb_inverse_helper(ds[ds.len() - 1], ds[ds.len() - 2]);
        _limbs_mod_schoolbook(&mut ns, ds, inverse);
        assert_eq!(ns, ns_out);
        verify_limbs_mod(ns_in, ds, &ns);
    };
    #[cfg(feature = "32_bit_limbs")]
    {
        test(&[1, 2, 3], &[3, 4, 0x8000_0000], &[1, 2, 3]);
        test(
            &[1, 2, 3, 4, 5, 6],
            &[3, 4, 0x8000_0000],
            &[268, 328, 2147483575, 4294967251, 5, 6],
        );
        test(
            &[0, 0, 0, 1],
            &[1, 0, 2147483648],
            &[4294967295, 4294967295, 2147483647, 1],
        );
        test(
            &[
                2460989955, 642673607, 1971681331, 2338977519, 475442971, 2516527409, 3470931196,
                4262052990,
            ],
            &[
                1430162564, 1873089879, 3090281851, 2861182896, 2502166555, 2486624904, 960387080,
                3073064701,
            ],
            &[
                1030827391, 3064551024, 3176366775, 3772761918, 2268243711, 29902504, 2510544116,
                1188988289,
            ],
        );
        test(
            &[
                0, 67108864, 4294963200, 63, 4294443008, 4294967295, 4294967295, 8388575,
                4294836224, 1073741823,
            ],
            &[33554304, 4294443008, 4294967295],
            &[
                0, 0, 0, 4294443072, 4293918720, 4294967295, 4294967295, 4294967295, 4294836224,
                1073741823,
            ],
        );
    }
    #[cfg(not(feature = "32_bit_limbs"))]
    {
        test(
            &[
                9995257893114397114,
                9401504468144459131,
                558615837638945228,
                10733662027974786928,
                18295107704289976677,
                1814706268673753787,
                12474943759854623335,
                8814778832826774208,
                9159057654048965906,
                4451260977376821357,
                18241701617364042056,
                6169989192350218482,
                15071965537117101028,
                13509168527678537782,
                12224278653171635329,
                16077066393714953826,
                1433938684868066489,
                13014970036232570373,
                899282336249563956,
                3089487642230339536,
                3787737519477527148,
                16667686214395942740,
                8787122953224574943,
                7841835218775877827,
                9693303502025838409,
                16122224776459879427,
                144327425397945219,
            ],
            &[
                2350654041004706911,
                7834348511584604247,
                12756796070221345724,
                3842923787777653903,
                12373799197090248752,
                9712029403347085570,
                1426676505264168302,
                10586232903332693517,
                8387833601131974459,
                6290888746273553243,
                9503969704425173615,
            ],
            &[
                12688955427180652274,
                7641660693922643933,
                8789985477567049482,
                5698832637416200787,
                14684840547760545685,
                2822100467869581421,
                3557573565928866957,
                4409631974409684922,
                16994214656621423610,
                4513108841166793667,
                9009005527785483287,
                4330767427200269309,
                11409205475757922767,
                12430752173702915207,
                11990819624778098799,
                4145020291153594556,
                7099200056207569977,
                3510167930325480168,
                4731667122118327121,
                10720310942075546738,
                5799804483118787221,
                17268037247251138479,
                13305947798457087249,
                1405091439325174594,
                13072181651983436371,
                16122224776459879427,
                144327425397945219,
            ],
        )
    }
}

#[test]
#[should_panic]
fn limbs_mod_schoolbook_fail_1() {
    let ds = &[3, 0x8000_0000];
    let inverse = limbs_two_limb_inverse_helper(ds[ds.len() - 1], ds[ds.len() - 2]);
    _limbs_mod_schoolbook(&mut [1, 2, 3], ds, inverse);
}

#[test]
#[should_panic]
fn limbs_mod_schoolbook_fail_2() {
    let ds = &[3, 4, 5, 0x8000_0000];
    let inverse = limbs_two_limb_inverse_helper(ds[ds.len() - 1], ds[ds.len() - 2]);
    _limbs_mod_schoolbook(&mut [1, 2, 3], ds, inverse);
}

#[test]
#[should_panic]
fn limbs_mod_schoolbook_fail_3() {
    let ds = &[3, 4, 5];
    let inverse = limbs_two_limb_inverse_helper(ds[ds.len() - 1], ds[ds.len() - 2]);
    _limbs_mod_schoolbook(&mut [1, 2, 3], ds, inverse);
}

#[cfg(feature = "32_bit_limbs")]
#[test]
fn test_limbs_mod_divide_and_conquer() {
    let test = |qs_in: &[Limb], ns_in: &[Limb], ds: &[Limb], ns_out: &[Limb]| {
        let mut qs = qs_in.to_vec();
        let mut ns = ns_in.to_vec();
        let ds_len = ds.len();
        let inverse = limbs_two_limb_inverse_helper(ds[ds_len - 1], ds[ds_len - 2]);
        _limbs_mod_divide_and_conquer(&mut qs, &mut ns, ds, inverse);
        assert_eq!(&ns[..ds_len], ns_out);
        verify_limbs_mod(ns_in, ds, &ns);
    };
    test(
        &[10; 4],
        &[1, 2, 3, 4, 5, 6, 7, 8, 9],
        &[3, 4, 5, 6, 7, 0x8000_0000],
        &[718, 910, 1080, 1286, 1492, 2147483434],
    );
    test(
        &[0; 3],
        &[0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0],
        &[0, 0, 0, 0, 1, 0, 0, 2147483648],
        &[0, 0, 0, 0, 4294967295, 4294967295, 4294967295, 2147483647],
    );
    test(
        &[
            1341443830, 680228019, 2358294753, 4240552485, 4220791420, 3445360969, 1267691556,
            3340881424, 992535572, 1421700486, 4136881179,
        ],
        &[
            342694080, 2041952014, 1126110022, 386493367, 2712278177, 1646877232, 868323005,
            1128141558, 2508964077, 2270408768, 413397861, 276293957, 2413870149, 3904853505,
            1276303079, 2556190902, 3967785388, 2803311564, 1963309088, 2281251697, 108392083,
            3821172642, 2048710986, 445614759, 2901896991, 3601903082, 1748962330, 658337341,
            3756770944, 2926642090, 7482898, 2241569433, 3381544088, 3275875595, 3036252835,
            2075586864, 1267727773, 221607050, 3946214050, 921175728, 655433083, 3594825352,
            1857831165, 3460211778, 2710641188, 1271591399, 263125866, 3619333728, 1041602820,
            3231202083, 259949419, 4156557841, 3419638674, 3270070813, 2084018311, 2951772182,
            860428573, 1138531819, 71044931, 3406637788, 3662652535, 3741808197, 86584983,
            1543795459, 160951322, 1039367499, 2428548772, 3604743617, 1138310711, 2881638514,
            2899388867, 3501166651, 161644747, 2395978477, 2682256494, 3417971200, 624066885,
            1772236754, 48275686, 3979745914, 2458268763, 2470110876, 3143857674, 3359279240,
            46246098, 2912257532, 2916568936,
        ],
        &[
            4267671814, 3181376526, 4204274026, 2772982826, 171341955, 3239339748, 83269891,
            2325049318, 746305994, 1290717192, 1805639230, 1856363646, 3445599715, 1388597950,
            2699498310, 246990054, 1396771726, 265087723, 3372840761, 3260397695, 2010115470,
            2211074582, 1883962263, 256363687, 4012920099, 2367091978, 1485341992, 1836339208,
            1434180757, 2616877872, 1145425491, 1261399773, 3926766027, 3115015865, 1741783714,
            3802513218, 4081750672, 3856503286, 2137512595, 1192985123, 1863041957, 700637154,
            2503934926, 2021744810, 157763047, 453501781, 1898727251, 3741166728, 105996483,
            3390681922, 1127471458, 4229032301, 254843851, 2729237155, 1707011850, 1756734415,
            1864969309, 96539023, 220456923, 3061776324, 1741151628, 1199010536, 2099212259,
            3095715999, 1369052975, 2575251120, 1821995904, 4169452262, 3299830336, 666854626,
            3647011057, 3965571435, 1551218489, 726151433, 1730753749, 750433250, 2084548637,
            475638490, 3209308986, 1536371286, 3458731894, 451976715, 1463077982, 2401462738,
        ],
        &[
            50882392, 3543059939, 2606418187, 171797978, 3702339267, 3400795540, 1675838746,
            3131956910, 3246773095, 2366066134, 1942572319, 200951604, 2751524401, 2229461380,
            953596498, 2149080321, 992246008, 2665146762, 3598754770, 101403369, 2364937647,
            3687287854, 3518388658, 3773344884, 2952272227, 2179289728, 3985568008, 2985468384,
            1733586261, 4006520661, 592636589, 1738983882, 3771432433, 334405279, 30528997,
            3353300809, 3694124666, 1257341879, 1142716002, 3178475445, 1431232435, 2733787829,
            2350134046, 162973337, 604966704, 1355497537, 2006066960, 1053669332, 2166548589,
            1297102232, 878976420, 1030095675, 3202690801, 955256572, 1487108550, 2945568597,
            3875785235, 1390419282, 1216776596, 786261001, 3784540042, 1845909951, 1777517834,
            12237310, 475982412, 3059699536, 4125207911, 2924612871, 3238196381, 2479221661,
            1483884124, 433754513, 447002430, 2684532044, 3494064078, 619277683, 2680056541,
            538552294, 1984267024, 700348592, 1278341418, 1614761367, 3944408375, 1269851701,
        ],
    );
    test(
        &[
            3656551823, 3383257247, 550091805, 1932339117, 3279901067, 2864941409, 3440756420,
            466783416, 651341619, 2318022162, 1201487629, 3064175522, 2345469826, 3581748650,
            2606599593, 3742095121,
        ],
        &[
            3689695988, 3117118992, 1237207334, 1180101208, 2947083336, 2827697081, 221923985,
            2507264800, 619323315, 1516562901, 3186068769, 1013769776, 1271582351, 1669896397,
            2497959088, 3504047880, 4212568439, 1608150067, 4150555892, 374787916, 889323122,
            3833122938, 4262272989,
        ],
        &[
            3226059476, 722714803, 1915993039, 2160412527, 1484228011, 1715426198, 1611850737,
            3097214810,
        ],
        &[
            1074470868, 2174113464, 1715956530, 3963027838, 1871758691, 1809783936, 3173233408,
            1926929270,
        ],
    );
    test(
        &[
            2108009976, 2838126990, 827008974, 4157613011, 3782799311, 839921672, 879731301,
            1926496935, 3712149888, 2363043408, 3863476261, 1703718215, 499165670, 2993223230,
            4279694017, 2976095205, 2193242813, 3593708162, 586354096, 296757650, 242624274,
            199363552, 2802933005, 2759687879, 3925865458, 4217980786, 621040829, 4008464542,
            3795907109, 270168250, 3625538473, 759155103, 3959828159, 1835721901, 1818377089,
            114690984, 2967220963, 2377698568, 2241245638, 2252300906, 3116551983, 3644576818,
            2608501946, 2181270779, 1815210824, 1268283136, 484429506, 1180516809, 559610343,
            2543044915, 3719740023, 558939794, 3989231279, 1089033996, 3509826828, 3545449066,
            3353643945, 2822587915, 2300900020, 309191900, 2371088678, 1169317833, 2688462322,
            704882387, 1429447898, 2514029776, 1955158460, 3862686818, 1584130288, 482000750,
            4224830364, 2104097699, 1183456674, 2270729014, 2607655660, 2966545947, 2931252595,
            759652385, 3970839358, 2487392344, 1507124762, 758697388, 3840603988, 1293583672,
            252424514, 646352064, 1756992845, 2309291248, 3392597937, 2946557682, 3659552460,
            1720311830, 3395887210, 2674135679, 3196424053, 2895118562, 1256983146, 2482795730,
            1922474903, 2105232035, 3692384401, 2891711374, 3496171341, 515080177, 4073860792,
            2051799135, 2279442367, 3258846627, 70977295, 1937954703, 2800340027, 1760719187,
            646417623, 3158839049, 3176203007, 213391749, 869819866, 3906922929, 1586646665,
            1614123406, 3687984980, 1177302158, 272342927, 1441818617, 2083855650, 1541781406,
            3311904586, 106907162, 4108429222, 662974012, 4140594255, 1984524179, 3259771450,
            3863443649, 3307256449, 3597197635, 3771753969, 3551628070, 3550518548, 2546464879,
            3812123817, 2299164636, 2258249267, 815945886, 3725185601, 738801212, 3862546442,
            207778311, 1535617953, 2150997157, 729581295, 143725958, 1410055499, 4204574368,
            2185442793, 3653861199, 1767186378, 3537808267, 1766021033, 2239408696, 1986025224,
            3625288948, 4046347844, 2490523057, 3491861717, 1312039469, 597857291, 206880668,
            1812928615, 3684502664, 3820772609, 1327777451, 1237379465, 764273090, 3594853086,
            2859643842, 1243019386, 3444655918, 1596721727, 2221238575, 2483346164, 2064518283,
            2282844430, 1960424205, 4028198846, 2342293800, 1645322170, 3508868511, 2376856302,
            1764497492, 2461899059, 3430260828, 1083983032, 1448541077, 2081767380, 1131293272,
            2121152826, 4212689224, 2039367869, 2193844060, 1864700761, 1182989130, 1481869846,
            969270162, 3997775597, 1483663077, 394034269, 1586435653, 2281434261, 1937512315,
            836935557, 59742568, 1854699653, 2116629465, 328821302, 1999851100, 604863759,
            556389113, 2057620108, 1992554416, 427465103, 813735424, 487055225, 402647361,
            3006998394, 2146302389, 2308517156, 1063328348, 2382344201, 2665908320, 481118926,
            2376219143, 1164055989, 128362737, 2711666601, 1898018298, 2928344090, 3862251511,
            749517272, 2790599579, 3506539103, 2592038317, 1682088920, 1332639030, 3053921374,
            3066891587, 242466377, 3536065834, 2016487096, 1321862427, 2409873623, 3088797737,
            2840818323, 2052021858, 4079299898, 452968540, 3880575723, 2680668784, 1502544423,
            1619882634, 1068420458, 3236073318, 1740351058, 1183565882, 2761799103, 246817911,
            2967032269, 4003972840, 969974269, 3193561842, 1002645557, 2347161653, 4272895273,
            1522072178, 972383725, 3026624523, 434293193, 2855690795, 2455822196, 2413168892,
            2999634230, 784531194, 249556803, 2559695464, 3131798530, 668810109, 2114036394,
            2861740558, 370716909, 2126014070, 3913884200, 1577476936, 855642956, 2074597201,
            3461659621, 3292762038, 2153122643, 1658901071, 1562860969, 501980289, 1611843440,
            2433026108, 3791871978,
        ],
        &[
            2325147333, 1406197332, 1502532645, 137754493, 1488912421, 1014222449, 1678300831,
            2078887154, 2311629707, 3855402290, 1904906031, 1350026944, 314061674, 919972212,
            1429252796, 544807358, 2607111216, 3001219316, 160533550, 2875169678, 1402474615,
            3234840532, 1662112023, 1943050521, 4132256985, 2915369430, 699620367, 59590583,
            2461837586, 3986106860, 2659659366, 3589796255, 4168995860, 2337625655, 4292546333,
            1793085295, 2647770730, 2871508164, 2660729400, 3630964395, 3874212033, 1240042620,
            1713051992, 2105061240, 968807145, 3026819276, 2442427316, 2718248469, 2572140009,
            1793916894, 2112926236, 1058005225, 1528978151, 98430379, 3348888463, 2121431457,
            3545708238, 3975070402, 764453596, 192861224, 2698588322, 1493819664, 2502294971,
            3139295505, 1318649192, 1552623529, 2989328476, 1592829691, 1175278450, 182489613,
            1858350437, 2440903999, 1622786339, 162763913, 4106583944, 609833788, 1344925844,
            3910333895, 1369398307, 51929280, 2214052160, 78601532, 642016948, 3966440550,
            4161875340, 3764174238, 2944905670, 832634369, 2082700552, 3444794582, 962611192,
            38510846, 2733538376, 2141542785, 621670923, 3130866640, 1666281368, 3628581169,
            3965100367, 2889091703, 762371524, 3752935086, 656901001, 2374421435, 3084212494,
            1186140919, 3420046356, 775236355, 1337865306, 2051118555, 713071112, 1946850844,
            1427068060, 3949026319, 3075128554, 438166063, 3975561046, 858907746, 26964870,
            3843362808, 1461820702, 3090970200, 1037540471, 289966660, 2768763862, 50890120,
            580189324, 2911422550, 3684738914, 2025034397, 414622319, 2287243961, 3268939669,
            3547523099, 4011963324, 1768695320, 1859343614, 2123856143, 4141054481, 765801396,
            359993985, 3668605792, 3613648266, 1778728280, 2547397231, 2456061149, 2562918666,
            2903450513, 1994190773, 99234624, 3722083920, 4262323306, 202219441, 4201857695,
            3988878636, 1533308334, 401400520, 1069756554, 2457773969, 2892388936, 3423117995,
            1944069442, 492036629, 3426800580, 2282483359, 4006366620, 1695364515, 2555180845,
            1669287836, 349290429, 778467450, 2020203604, 2218159817, 1450404019, 1278304750,
            2412695340, 1592154884, 3868182043, 2240370481, 3859902860, 1008825116, 412233394,
            2475457637, 3664379433, 4204584226, 2750684469, 4113507475, 2916584959, 285955744,
            739598569, 18278051, 3768126932, 2181905109, 2612988076, 1827656088, 1160380415,
            4160443718, 1846086671, 3050604645, 2547108010, 2828666778, 3252702258, 3885923576,
            2331974758, 730724707, 1528859315, 4288784328, 3677151116, 445199233, 3304488688,
            3566979465, 3541025426, 2491779846, 3112990742, 2583249486, 3403111749, 1930721237,
            3428792463, 2896462048, 2985885576, 1819460734, 21206096, 3560441846, 987100555,
            2844904275, 84854892, 1268249628, 3963306788, 3338670067, 2504599089, 65588657,
            321493327, 4249673617, 4150876068, 721566898, 2186945060, 922948272, 1502464627,
            1426914435, 2906888275, 3454987739, 2609132626, 2073366782, 1058809001, 1226951003,
            2624503637, 282722778, 1407178266, 3304346308, 3613017687, 2397594777, 161128076,
            1938083248, 3042822216, 3958145306, 1431161184, 4147630074, 1744618540, 3729847703,
            2366216428, 2101731625, 2812677939, 3587016062, 1626785569, 3117017254, 3720581461,
            4254564252, 2400911475, 750362271, 3062375802, 2182368701, 268751862, 2682134876,
            274793576, 2417658182, 2321240923, 4200603818, 1349142841, 4066976957, 1043247680,
            679021323, 2933095037, 1621487581, 225868669, 1030678959, 1236344244, 972640788,
            1784301152, 578117349, 3509551550, 214420003, 3786992737, 802372148, 3562194086,
            2187046946, 3600373521, 4275090943, 2120016813, 4177241875, 3185774231, 2397692077,
            1015362399, 2178889151, 3433916223, 1688082118, 1971242178, 236388706, 3802829765,
            521309115, 2299816689, 3207614143, 1053195464, 3584561145, 1178690670, 2940812254,
            3321982035, 2754825123, 3073598062, 202404806, 547895545, 1188944547, 1056841779,
            529463805, 204665384, 850370055, 2063320161, 3724100092, 1180272690, 1398467003,
            2814052449, 1311768018, 659771105, 3226477227, 4230080238, 2134344405, 1461172705,
            2728018383, 1816821358, 3231137250, 2012377728, 2206916761, 3121807673, 3037967028,
            3653505029, 4164239058, 1337501466, 2487452346, 428839025, 3321493092, 2920064796,
            2750126813, 3635762100, 2659829309, 1992243088, 2359420187, 861816585, 4182313312,
            1389528266, 2890138969, 2195001695, 576635805, 1974585967, 851480113, 1896534852,
            3143828462, 4276040597, 3921135859, 2394233682, 2692972118, 2103941456, 3931376544,
            3790764632, 2278428793, 3381340311, 3516241824, 2923157557, 1276268033, 3471729699,
            2370137091, 2637023305, 4027814477, 3711009696, 3667995314, 459819000, 1002878772,
            2658190707, 1189561796, 1831813150, 2874008201,
        ],
        &[
            1703326352, 1625259628, 3642322228, 911402341, 2158835226, 939248485, 3607511108,
            2863853568, 1611642161, 1312857772, 1839433327, 567060478, 3139863681, 3642698184,
            3744632443, 712538472, 2692932947, 576185818, 156934113, 518107105, 2803035863,
            2284220097, 3447382922, 2400125006, 3565062840, 160044186, 3644393084, 4196433258,
            3391883838, 1115703759, 2380388002, 962895870, 4001772616, 2311278419, 2620271020,
            3047789793, 3229254302, 3182628087, 2718480927, 2872538422, 1963990826, 2856537226,
            1729736384, 372544200, 1482170753, 3370665422, 305555060, 4060802437, 1456459795,
            2848113958, 1036273297, 3245835346, 3355862097, 3242734427, 3313897419, 4230036415,
            1425594704, 2428756491, 420147714, 3218149930, 1791217142, 2881741659, 3231612869,
            845372829, 1635665046, 1525482197, 3779462557, 2279005731, 626908159, 2963734610,
            215448882, 2517668355, 3294128769, 1167990371, 2344651228, 2882002195, 3350056381,
            3749638142, 476010196, 2304276366, 1088082897, 1927672185, 3316329053, 1174989749,
            1101596429, 3054511229, 1685228241, 2301284206, 2526016461, 684171580, 3869889559,
            2606492401, 2114658735, 1419214215, 2779052449, 2594333668, 2225446358, 1211258458,
            4029343999, 2816277230, 4098142949, 1987363952, 2732004911, 2516355975, 2365350298,
            1747416524, 3951513077, 3526462790,
        ],
        &[
            1707334789, 979340170, 3926273349, 2029694660, 686358037, 1260123629, 689471236,
            4127009836, 1697317324, 3024229658, 3968952300, 2265029759, 733830093, 2234057965,
            799627406, 1641742523, 2511563041, 678204198, 60484965, 1732955108, 1348641815,
            1389334445, 3762643904, 3914179461, 4076462931, 3234877741, 2806715190, 3058911852,
            3068848122, 80861952, 660210165, 2035863667, 3882844515, 2652987274, 207029959,
            4170201248, 1224653886, 3554890284, 323203565, 969583090, 2280910221, 2548241625,
            2048045350, 3691775573, 3750377304, 2623340073, 1726676400, 2551234664, 3420452119,
            1785849707, 3581615935, 3521097022, 4008380099, 4200557552, 3795120169, 488463511,
            3784467967, 2462685342, 1684084055, 1072125823, 765304928, 2900468163, 3209242917,
            399160769, 3897765190, 3241572534, 1027203705, 4127226109, 154941175, 1755153596,
            4225252328, 1209101989, 2906888698, 1481930532, 2884731435, 2416462752, 553651049,
            2247421040, 3347507436, 1936621186, 3156059073, 4059864280, 3191940359, 3872902453,
            783002816, 3711047515, 1471051688, 357992570, 1061754510, 3765779801, 4106840335,
            3213049794, 1824410844, 2555550067, 1066295382, 3248869963, 4006861446, 3297772017,
            3418388327, 2284151457, 766215224, 1091253635, 2070830666, 1435103841, 1408352671,
            338399542, 2946293497, 412804347,
        ],
    );
    test(
        &[
            3333140561, 2349469031, 666934289, 3646788197, 3373340607, 3062489357, 1781577064,
            3971231072, 2027939726, 18149756, 461121573, 1026270057, 4154481498, 3854995191,
            2829169318, 2604923553, 1399568275, 4214150257, 1269657447, 527209086, 559827800,
            1978807620, 1942748659, 3544969161, 760896836, 694370989, 3323597771, 1950755821,
            1740588707, 2716546795, 1636681281, 131422512, 2683077565, 4107286368, 3475458482,
            1406752921, 2741526831, 625075474, 1356017187, 660778033, 4078598031, 2127023485,
            1900179860, 2413773277, 2442990944, 850894581, 1061627184, 2255197913, 490496693,
            400007380, 3092474488, 1228905086, 1949288324, 1866222251, 4084867584, 219026194,
            1513678816, 2415719293, 671740632, 2331463444, 1649508273, 622524186, 36198287,
            385821590, 3891184984, 3888867762, 823766845, 871168771, 4220135146, 3182319759,
            3811051122, 2244319794, 1994956782, 3515960993, 3523512148, 4142104035, 11404747,
            3407068856, 2661473296, 1343912700, 1278923149, 1319603671, 3928437020, 2678906106,
            1133029551, 3498992572, 3960506675, 2156562886, 2180928089, 4027866586, 3363079195,
            2699625088, 10633112, 1776348429, 2657266039, 366882369, 3755249663, 1513004482,
            385462618, 1235118123, 2498536948, 2963795538, 373052379, 4211662453, 1125414031,
            3132282357, 2555861787, 3949045845, 2694335672, 335933961, 2882374566, 3487775198,
            1816750435, 3017829161, 964613564, 159555703, 1822850997, 2275865751, 4158541302,
            2501990511, 3721844651, 2781838144, 1795741626, 377630941, 2137086277, 150771080,
            3410699853, 2181744662, 3165518125, 156617039, 3099687100, 2159351188, 340108091,
            2408725718, 1639869303, 1752843886, 1941447467, 2157946488, 1515895552, 3624132653,
            3556726921, 2697391196, 3650363912, 2596921683, 3641623430, 3884964637, 4229700714,
            1936259996, 3765315225, 4087511128, 746291101, 1752759843, 699518598, 2102672534,
            2335948897, 4138231225, 3162828440, 2881768368, 1254885146, 2977691172, 2250072411,
            2614007259, 2771551612, 776074685, 3162839614, 1471012556, 523323297, 1856466918,
            4090405884, 813410161, 100155385, 1084252628, 1599609446, 139407955, 4121369443,
            1963225032, 2735275753, 100107317, 1064061529, 50786861, 1654370440, 3334472166,
            1385803654, 3881645932, 3538258401, 1238925138, 1307191791, 2439918414, 1853442725,
            3584719283, 2139830944, 1008033673, 2159214266, 1728151904, 2054140804, 2246372905,
            1296034828, 732486414, 4197166746, 2149038695, 2421556216, 2209917678, 2053724924,
            3695308867, 2810551805, 3486105675, 979515789, 2065617241, 3321246575, 4275036932,
            3028497318, 1883398852, 1301060583, 2486427309, 592113155, 2482121819, 53211642,
            3067158128, 2316354328, 2457370797, 1766767168, 4130364650, 1394191393, 893956183,
            3188688185, 1875859783, 3686866863, 3294062742, 2146834313, 2406586432, 1574602180,
            3208002016, 1067708846, 1620126309, 593911816, 1573785767, 2208656217, 4037191927,
            3437397556, 425721135, 3749387007, 407468749, 4203518167, 557223936, 3186718435,
            3473504989, 2673679280, 1478635903, 4172750097, 1469776418, 2542136327, 941914936,
            3438581078, 3116581940, 3479694655, 159558945, 3809792710, 2458053073, 945749848,
            3386290936, 950397544, 148027778, 275178526, 1664599931, 2000347485, 3312866545,
            4123761723, 2408292910, 4050298, 4225958969, 2745635153, 1877283873, 90573827,
            3031684040, 2275034810, 476532317, 4006527249, 2818283214, 661127690, 2880950746,
            3285389422, 965419004, 1273458580, 1611437669, 4165036259, 503131762, 337440890,
            1274837150, 3486913543, 1110808141, 3573281492, 3543428578, 4165550725, 79661970,
            1465954224, 4160343768, 3753977684, 849800837, 1568284940, 1214508489, 777072754,
            3766232553, 4163385462, 3428999259, 906027128, 4231567110, 1070253805, 2975789822,
            1794042990, 2937404746, 3315145973, 3978541255, 191961431, 2940436214, 614874984,
            868388988, 4078685796, 2613877234, 3380127687, 2664922311, 3262235038, 741871774,
            1144269180, 4258950699, 3668553647, 3162392321, 927199539, 557637561, 1114912670,
            84346866, 4241634616, 592125931, 1914166161, 1225886409, 722682712, 2163011354,
            2585075265, 2786722853, 1993844439, 3433052694, 3718814733, 3881165856, 1749980152,
            2115861966, 3664836486, 1644814678, 603487648, 821270634, 3041437740, 925329308,
            414275079, 3675481275, 583965775, 3319812843, 270816609, 1752806861, 3191564196,
            3197116565, 2440000620, 4074382088, 3346183865, 176525856, 3011091744, 746158938,
            1522027948, 930706422, 2574400675, 4141639266, 758742087, 1418306156, 493509688,
            4102390641, 3757183059, 2174506350, 3715933078, 3450125642, 1345548124, 3845070193,
            1563795423, 1304049315, 2604880108, 1998271877, 4078353958, 966179722, 3401781407,
            1708183977, 3890171386, 698646214, 604975097, 4189977050, 1847675543, 2745048720,
            1585177380, 3886892753, 2534712423, 1830125662, 796996186, 3789574770, 2219095884,
            38427113, 3653683439, 1791769536, 3941686320, 2991883118, 1081207663, 3863639548,
            3017351034, 741393256, 2333573607, 2783158305, 2015776314, 3034707152, 1871224010,
            1795881414, 928539629, 3211747317, 461147496, 1512738445, 1178891684, 2603472964,
            1694950214, 3121022285, 91788635, 2303571910, 3259041724, 1240577113, 827064078,
            3847765430, 1254285617, 2609289648, 82835530, 2235563901, 2939680484, 3327268666,
            3659752183, 1783109461, 2828509671, 3804296197, 406800911, 2037292519, 941994402,
            3350211940, 4004870359, 1105941782, 2367553097, 2440982990, 1468367, 2369391483,
            3613174135, 2337161925, 2600055725, 1612773644, 1037201309, 919122459, 1114016493,
            670586694, 594109706, 113464329, 4093636009, 307208587, 3876235186, 3370598978,
            934478190, 2843794891,
        ],
        &[
            2368917411, 3160758175, 1531480588, 2746326450, 3122359045, 1995296172, 310451197,
            1100329853, 2141732304, 3562890277, 4172526924, 4143185198, 2397101926, 620168044,
            828452963, 3271569899, 2726758945, 1647557222, 2748652901, 1029871186, 1773072595,
            1311795717, 2792240418, 3100733307, 298902661, 2608361440, 642743765, 3026335712,
            1586592828, 1251923561, 2152803283, 3359308047, 3979690761, 2548031009, 2148504694,
            2514911217, 401310800, 1418125404, 2325652800, 716233458, 422262103, 376190943,
            1713380879, 2534508846, 2080413009, 2690193951, 2909422387, 2435837201, 176977642,
            224472737, 1590904934, 1664979624, 1748982641, 1284257790, 2779881254, 385265989,
            1148527382, 800142050, 3595556318, 3950265146, 3931111523, 3399894595, 4200004994,
            3727110364, 1510525540, 429323681, 2586345405, 3441619670, 94654169, 2266545045,
            1451808026, 286040435, 364003484, 2106693078, 1916214330, 2622096560, 3504008387,
            1867458297, 4209615436, 2899684845, 3149003214, 2731979274, 2481557740, 234269740,
            1239420776, 2726912636, 1844267393, 1488044058, 1587005400, 145015793, 1637696129,
            1990069464, 3053970062, 676336554, 625771493, 1492378707, 1231018082, 3059699722,
            4113615249, 2967103567, 3335726303, 2137774253, 273460502, 1561489611, 1227429414,
            778315897, 3061631993, 2437789514, 2566029814, 3017507824, 3219754602, 35255136,
            1934306764, 1655248959, 3655963814, 2821596564, 1431977748, 3114012833, 3915822059,
            343010167, 3704265251, 2691314567, 2602475242, 2459094882, 58857240, 2230690665,
            1357656795, 3025543277, 3488674640, 408985076, 80729036, 246851391, 1419653386,
            530010128, 3529087076, 3980421141, 4129023783, 1630771696, 2057278583, 2501545742,
            790764428, 3984347668, 2562445985, 2262348292, 2515967925, 1103371818, 3735595401,
            3210477145, 3387257181, 538884374, 2695206119, 4211749041, 1006274735, 2406061865,
            2654644297, 1268724640, 2399689302, 157759259, 564853502, 865205768, 2174783618,
            3167863384, 1770172407, 1906775255, 3171669377, 2455086709, 1355327864, 3351895167,
            4184858376, 2699533565, 2939169294, 1702277740, 3447680482, 3322351998, 4248517760,
            4100425921, 1169799041, 524849931, 1743345401, 3987645088, 3022177240, 3263737545,
            3656340460, 239445170, 4089162190, 1208712978, 1453215235, 3390225374, 3337889603,
            717395279, 1066458381, 2162685522, 4009460245, 2575879990, 2578471337, 4218103221,
            3046325563, 1352991515, 1561949281, 3488911174, 295633326, 1993756395, 3677304657,
            796898320, 45622345, 2999482773, 2078651788, 1552765091, 428170722, 1748054862,
            4158222865, 1050292437, 249107, 2651086861, 1540178674, 1275557298, 651050585,
            1895599156, 4150309716, 2064336046, 1021257319, 2422595446, 3116755258, 2756656575,
            2328011578, 3632905157, 2576200202, 830418644, 2430246370, 3913080080, 2371749061,
            2683067461, 3611558701, 1603392737, 796477803, 604567756, 1376069347, 1491246154,
            2728262664, 4138498935, 3008562381, 1061547384, 285679033, 2358943172, 1884649492,
            1783482693, 1010268161, 176114433, 794165875, 2362278477, 3903204233, 326754905,
            1988607850, 3187254334, 1749797209, 2986661384, 1759716588, 3137467938, 4067743599,
            1134210801, 3799848836, 1955405545, 3881788427, 3097574490, 3844756657, 3183850151,
            2496328910, 1468671385, 2888878911, 2306353811, 1498824361, 4152891378, 1588217107,
            79108222, 2883552792, 2390312777, 1587172303, 2070384343, 2265280181, 4013380367,
            2742676878, 2654283484, 1471778694, 970959698, 1006151052, 1276307400, 2874101774,
            3169092608, 244587925, 2402787407, 1635687252, 835856534, 321407542, 2307278464,
            2272745321, 2574317642, 729437319, 1682288870, 1482920833, 776000268, 3908963888,
            214874919, 4233311318, 1441385448, 2358127573, 2753681514, 467574656, 4139948165,
            1538275035, 3244920878, 2576965792, 584068468, 3054546876, 2629688518, 4253271747,
            3723872815, 1652066683, 990821089, 2335421805, 1989570928, 240486517, 2872315587,
            3869991906, 3870517664, 1540804424, 397183643, 3750033565, 1433260634, 1506168711,
            3616651625, 512028445, 3746712828, 3278592880, 2611514549, 1214563129, 1259227909,
            1067976218, 3425169051, 741795595, 893688343, 2674408703, 3694908868, 2478153735,
            2220661625, 1022546736, 3719214155, 3161293211, 4131981986, 1473264088, 1651777063,
            1438502715, 290022167, 59234682, 3458968160, 2552001459, 3451530289, 3800073253,
            717882913, 845719525, 1038699111, 3058303772, 1117505279, 3682430977, 2869037104,
            2562493618, 960519305, 4147639705, 1817463351, 3166022129, 3200769866, 789666262,
            2654485924, 3686362402, 2179867687, 3980226915, 3671542918, 1896992204, 1514962591,
            815867715, 3924270086, 4262628477, 3977258034,
        ],
        &[
            491933121, 4095154087, 1190388341, 2123387578, 3299683037, 3840239224, 3891252433,
            3823858915, 548023871, 3189021809, 130119335, 1406023029, 1691542279, 2101470388,
            367145009, 521045073, 1370995123, 202251222, 2377400220, 3656022509, 2413445446,
            3583191945, 150872893, 1253881977, 3664619565, 661519973, 672952411, 1111416155,
            2582282747, 2253466637, 3993637585, 1023965093, 4055175549, 1721196160, 4271105372,
            1844335262, 794907961, 3970777280, 1279126024, 3389187110, 6388771, 3557792034,
            2503975364, 1216157736, 4081863507, 1212796362, 22717034, 3517296783, 3126258972,
            454147562, 4182968994, 685295412, 2996150679, 840677609, 2775806132, 2555856748,
            2855553012, 2971949846, 3057579317, 954558068, 1251032539, 2673204563, 697957636,
            1312479140, 2686740988, 2005131101, 664387193, 2169938189, 4081160067, 3469684725,
            123152292, 2899902365, 1142266692, 2066860665, 647803613, 3574778631, 1302596512,
            678200322, 3509569151, 849744577, 1521760114, 3195673981, 111241164, 623461570,
            3571445453, 200189218, 4138515602, 665845464, 4184871542, 1353865395, 2913489035,
            3076207781, 2549062531, 3446687793, 685940105, 1430268106, 2488363196, 1172253595,
            4151501269, 3292280286, 2025935004, 3388911026, 1080796771, 3386986959, 4175562557,
            2440556214, 9871988, 5488492, 4179517076, 908443542, 364965294, 2303037125, 369102673,
            1570100894, 3615415741, 3133015360, 2623933135, 211314818, 3377760249, 2285528104,
            3096807957, 3213907502, 3633343924, 2065769028, 300167487, 1745300631, 1943126607,
            1065862406, 2422304458, 523765517, 57630113, 520436682, 581485167, 527613705,
            1677813796, 2698743484, 2448718551, 1681977324, 4183961145, 333724319, 2667028740,
            3403027352, 1499647517, 2965583197, 1090547876, 1536215624, 3407325498, 1392474450,
            3354142052, 3326326224, 1138672330, 1577104875, 235932133, 3877789753, 1822119722,
            305251772, 3802044423, 608489509, 2727503310, 865373313, 3763994776, 3206318655,
            88097048, 4241064408, 1171067683, 4250936686, 729121178, 763857558, 450636528,
            2096197907, 1427186250, 1251064262, 3036762405, 2966424923, 880639864, 1995310474,
            2023015792, 4198637421, 3996151657, 3070092174, 331733799, 2680348059, 2601390369,
            92920881, 600583651, 1323663334, 4258529164, 2493258032, 3313489774, 2050494797,
            1494880112, 1342788885, 2493538385, 1096813856, 27701253, 2762164402, 3934044073,
            2289089808, 721323988, 2246162231, 2514451824, 3095057964, 1921436785, 2847276160,
            1369952734, 4246781184, 3442030977, 3930627222, 614706399, 3051396564, 3044240928,
            3450585985, 2120836933, 3006035710, 178202067, 736149219, 623937260, 1958379885,
            3104814268, 3269365015, 914726129, 2951180538, 3940965189, 1869582492, 2599100173,
            1009213592, 1410445689, 1179880005, 3583285938, 1921636631, 434725812, 735782942,
            2548761027, 3733379485, 3466163816, 2455801926, 1673952134, 2422059957, 4005305357,
            2795894062, 3245947918, 4171997564, 2269244989, 1975479474, 2449387935, 2550893401,
            4033149, 3723976428, 3871853952, 3210178057, 2062131312, 1434821634, 1130065536,
            4276609753, 41976415, 968125282, 853099726, 3675357389, 3545982836, 1237895428,
            88970686, 4259275077,
        ],
        &[
            3428605691, 3747865452, 3179948115, 2350061225, 568002466, 1150456745, 398797276,
            1289784855, 1713342581, 1243415582, 2262476431, 2640854581, 2126611553, 279688048,
            1750838292, 4147801215, 1090003542, 3022523567, 193306367, 3095010320, 4106129220,
            2615828356, 2229875117, 1066352114, 1628397898, 370050060, 4157038478, 3551524420,
            3356007005, 71309641, 801692593, 3448737794, 2187893878, 3694205688, 3993669226,
            1704384353, 437976508, 281233142, 3685881986, 557022935, 2623696682, 3473835466,
            2373703925, 4102552649, 3005124737, 1604665678, 2894612216, 113726438, 326916434,
            2354584210, 2207672568, 1272863868, 1643657755, 453968751, 3873638645, 2388412558,
            2026577065, 3555348237, 2342844423, 564662317, 3301275728, 2205414701, 1980322846,
            2111846734, 3351655044, 3986317737, 3746472405, 4065813457, 3783710419, 2063617629,
            3337397526, 396000532, 1367889075, 3493608147, 3502046919, 4063752078, 2026966957,
            1730343114, 1889308216, 2064908820, 1350757250, 953211432, 3171180512, 3683852864,
            2865517189, 9728788, 4075807873, 230559850, 3447666295, 3875782338, 2964025959,
            3279832060, 1701408562, 1524777719, 2018628821, 877683542, 2894422993, 2842238026,
            2368190181, 2574790540, 3301078931, 519264490, 2640226714, 1382986517, 2712031077,
            1268830384, 2018243821, 1374899410, 1932087493, 4236194373, 2079152365, 1069353434,
            2794047491, 3019576051, 1360117274, 3615353679, 3816194597, 563906666, 1827758233,
            3391740972, 4039283822, 474920421, 602146150, 3520459365, 2217822485, 1815675107,
            1257332805, 101198736, 3156910259, 1281759597, 2577040428, 1316988841, 790502779,
            2183328888, 3514409721, 3117638288, 2751392867, 625199304, 4183171081, 810287943,
            199775540, 2896399552, 1276626819, 3536203521, 3977249862, 1553852925, 1596788767,
            4199876212, 4164476281, 1700598937, 4111801568, 897035781, 3318378574, 4049506305,
            2522517679, 2296942227, 91515126, 2738354614, 3444113221, 776723413, 2322159108,
            258188842, 4014626824, 2677530556, 2630906411, 2348643583, 2619411399, 1783064149,
            3684137491, 4249816060, 2342260236, 4186117248, 3931377058, 283592002, 2818946531,
            2155019855, 1212182985, 937681548, 520081464, 1686760025, 4003314294, 120323668,
            3282730481, 1331500167, 2103184161, 453960707, 3079516933, 4193898972, 279508919,
            2459211929, 4262295127, 1413249938, 2652447340, 1521334653, 3641279725, 1047788888,
            2569690437, 3517124875, 527659101, 950373677, 562851515, 3518587604, 2668894245,
            2265163836, 2975852422, 3168107907, 3219343979, 3364338005, 4122186542, 3517854206,
            626303838, 201513242, 4042863292, 4203206994, 154681851, 1046188872, 1014035958,
            1565481708, 783475007, 1419399714, 1439418252, 3671223860, 338436030, 2221870804,
            275182251, 790279697, 3288665213, 3033639795, 2320556485, 1648356934, 326278183,
            429784181, 104482651, 1051376296, 3823684587, 3057907898, 4214146560, 2770254088,
            2132180852, 515232230, 3723417512, 3994583184, 1170935740, 565152109, 1486190861,
            2906472005, 3154973145, 1571950735, 1391459913, 2972445791, 1670706254, 2522911431,
            2665886703, 2875123532, 623767904, 1291947264, 3935970871, 2500309617, 3931020115,
            3436644927, 3672390796, 2307254280,
        ],
    );
    test(
        &[
            386353625, 2283334827, 253851108, 4279287864, 2561872983, 1000131216, 216965099,
            1733322743, 3814906874, 520558483, 2573981410, 3011109093, 1361665859, 2981910167,
            2501833654, 2673979284, 2696912361, 797890797, 97183495, 2324611911, 3471887001,
            1013155374, 524729310, 3971281568, 2873934524, 1076401482, 1645093822, 423739674,
            3400177353, 3716049850, 2858905860, 3351077705, 1478568656, 3370413874, 3966773377,
            1660817988, 3770638166, 698194415, 92466505, 399941585, 3301477423, 2578917060,
            3012966571, 1915213695, 3062576400, 2979801504, 3838450560, 975685759, 3154985631,
            1986911427, 3559636850, 2134674515, 3128102806, 1097660929, 1212690783, 3611467219,
            1232001761, 904465835, 671601217, 2829397960, 3910014855, 2035732477, 3262086074,
            3077756473, 1064556527, 3095006074, 436186642, 3844079107, 2798261317, 3470373096,
            218408908, 4184804463, 2826021777, 1939569756, 1452808097, 1149547097, 316749819,
            1631475409, 4023391942, 513096309, 3730431754, 3391919570, 4153138767, 1328779762,
            3015228258, 2487205968, 213982794, 1927310263, 897606115,
        ],
        &[
            133654450, 371159391, 40768202, 2113895976, 2732923987, 3215138425, 2391931662,
            2672734577, 195120416, 939150931, 1941696822, 2919872876, 2564539452, 3080820908,
            2846583634, 3349568397, 3465385329, 3550405793, 1724556069, 151917586, 3772273289,
            4156003461, 2380288065, 356475766, 4123619567, 1619017859, 3739529130, 490749645,
            267879469, 2890847693, 3854244893, 3384266657, 115723042, 103663103, 267682519,
            965965574, 1841386548, 2476428873, 6965648, 3347378817, 4174270937, 911558590,
            1958087705, 1467103561, 1925556384, 607664404, 2051263137, 3092553737, 3239342455,
            1360744647, 331798903, 938411111, 3063265275, 4144610940, 624250586,
        ],
        &[
            3712980585, 4273305215, 2588121912, 1482202110, 247010829, 2649827458, 2673293530,
            50266420, 3870816552,
        ],
        &[
            3140142351, 3638334268, 927590030, 3257445174, 190628332, 423978494, 2125526010,
            2335881748, 2011775260,
        ],
    );
    test(
        &[
            3451729766, 1173985848, 93029266, 2489920009, 3973680219, 780152687, 1953113811,
            856318718, 3314090115, 2569865885, 10849561, 743853677, 1946859719, 3063924404,
            3352045106, 101532091, 429420318, 3158186124, 1342100634, 1680882573, 4042659776,
            565667221, 989688746, 4541446, 834463803, 3523014310, 3432977627, 1818084880,
            3544409611, 1926948225, 3663387900, 1035293697, 285923430, 3096314023, 664014848,
            2054069437, 3124990832, 115905130, 1379323203, 2244054884, 2012040660, 1620087465,
            1907788850, 132467852, 3020885577, 238576412, 567018667, 3426013542, 3145012002,
            2070201540, 1421424259, 2074360440, 810615969, 153078550, 825376847, 2436604908,
            1365021492, 288298963, 3753461462, 4215347696, 514661745, 3484458912, 4247537127,
            1579462876, 3865189996, 1018915575, 2974009562, 3501816358, 2821759336, 2722697353,
            517866351, 632193686, 1959130106, 2570573609, 3726681184, 1695074321, 1803440017,
            268435105, 2059636298, 1870796488, 3616705235, 779907146, 3840642834, 3690603635,
            889240128, 4220497978, 1506894274, 3744062951, 3031958651, 4062058444, 2309758423,
            1411665710, 1638698058, 1784343146, 373693019, 3239595939, 1656022725, 1985062241,
            2188775097, 395478226, 2732514978, 2804731752, 4294707867, 2796289890, 4286815139,
            2694259304, 3400027223, 2866208426, 712658287, 3005677674, 3799280383, 333964254,
            426632823, 1071506508, 424615774, 1216913008, 1528084851, 2440789637, 8647650,
            1482353199, 1079815951, 1741478231, 335212928, 3230225069, 812456049, 1107265661,
            309740350, 39813940, 1038050523, 3708554333, 2276389162, 3145208114, 286364489,
            2078653938, 2343246544, 761958231, 2400118006, 2820784413, 91083352, 868359282,
            2976918690, 1899156995, 2927253740, 2971404198, 955553520, 2163090892, 1779162381,
            3706789234, 1427323973, 2892945053, 3765307938, 1888304940, 4281185143, 4063224403,
            3895821018, 292451283, 1315405597, 1278053061, 2659048964, 1651475603, 2464063324,
            2470117886, 885060568, 2223396118, 983203622, 2153273837, 909540554, 11662729,
            1290088356, 3558268851, 2470462290, 3816443571, 1219777270, 1663771088, 2059674235,
            3741754207, 918293007, 1170814255, 2592844500, 34078497, 868179007, 2916133370,
            224466504, 1457353443, 743181292, 2045016399, 4268051489, 2582113750, 108054210,
            1045580699, 1021681246, 4287699909, 2442965928, 2358040249, 2188665290, 2493816549,
            1868457202, 1538714165, 3141445884, 1886427078, 2413842865, 3754082182, 1242353411,
            837326189, 1891378866, 2004934119, 2718308820, 1293740965, 3706050263, 660923758,
            4037329521, 1659464686, 3767070633, 2733667846, 1303579884, 720201259, 4178102594,
            1521257108, 3676354960, 2861869547, 1694835235, 1663377877, 1033893232, 1788049008,
            2131980496, 1380320795, 1706971693, 1547085187, 4249747381, 4022331904, 3773862935,
            186851005, 1122661765, 2869769810, 714482846, 122240297, 1990969517, 1505355345,
            1418846887, 2157766299, 3944099174, 752193837, 2717991695, 3106584127, 2176113460,
            2424010054, 2202537322, 735567917, 2635174646, 57167007, 1501943516, 3981020168,
            2264071537, 1811387936, 3230232665, 2056500724, 2470649052, 298208196, 361093257,
            837772742,
        ],
        &[
            3759203346, 4116788486, 472182301, 1657732406, 1379670583, 1302865697, 694415200,
            281678172, 1654699562, 3014506006, 1741431230, 3860463155, 1145719988, 3566676616,
            2320845102, 2321995000, 536415919, 2387437419, 3567575351, 89009414, 1112333426,
            3147195251, 3149954561, 1503279897, 3064049622, 172526224, 3226367243, 4252316042,
            2985921401, 3319920602, 2971463135, 662010514, 2716903751, 3114900209, 4294888231,
            2302528059, 2985636330, 4227410510, 523042380, 1128527265, 2237860860, 2902190407,
            2028066064, 43980114, 85965472, 1423570354, 370469915, 2799642260, 678694776,
            4007712353, 1236341524, 2105667795, 1513858354, 3031596159, 3550734930, 4152331215,
            778814882, 736616127, 1334786757, 193672910, 4005017476, 49451649, 274162308,
            193472860, 3849716547, 1147344616, 3779102036, 636364760, 49841072, 4203872775,
            2917594088, 2516158563, 1718950767, 2409600701, 4112139783, 968713133, 2367692503,
            1383637739, 1447827357, 70112330, 1597216524, 1036612170, 47442040, 3535655506,
            3217988958, 1524147015, 1542229372, 4278993048, 1177373055, 2455939135, 3977288741,
            2323766505, 2631150922, 2494146789, 1766908673, 2014027584, 3170299898, 2200469205,
            447095672, 3553741345, 1471247393, 1705231371, 3597764506, 2179927417, 2057038135,
            2877684583, 4157842671, 3988568107, 136943619, 1758053719, 133243005, 1316787143,
            3912460869, 3007503154, 673776671, 2300353234, 2544200665, 1154464703, 2377559298,
            2085288775, 570803259, 1718587627, 1887771341, 2141823671, 812587685, 473768462,
            3537328856, 2051785610, 1867482529, 386483431, 2102139021, 3579998391, 1082229057,
            4197498026, 2004997074,
        ],
        &[
            3960768807, 1512612890, 3846503597, 4289005374, 3202073567, 4260281911, 4219386150,
        ],
        &[
            1749675900, 83311145, 2319870768, 2301367900, 1271820700, 747192890, 2232034578,
        ],
    );
    test(
        &[
            1444823481, 1895962470, 1145820971, 951685031, 1619286897, 645659681, 3225126137,
            1237595037, 528204561, 3332610202, 2935828481, 3511627759, 3794280700, 504366468,
            2867551534, 432130908, 1682537913, 2112976328, 291513836, 2849031909, 3326433036,
            1925364297, 3779561553, 487877982, 435659240, 1540143453, 3711236017, 1440132082,
            825660149, 1624471959, 1941539144,
        ],
        &[
            110690520, 2114031203, 436730283, 2624140005, 3364550071, 806172129, 2495686202,
            3508099340, 1915440069, 3196245075, 3757278096, 786923263, 1820433641, 3283619351,
            2326488762, 119217121, 3545365539, 3063896557, 1866040341, 3325517573, 713948948,
            2863092530, 2356199798, 3131342786, 4122497749, 3637172320, 2586791774, 2794104974,
            1738360752, 1591954820, 2633103962, 398797289, 30804220, 2682142316, 1858898375,
            2406882215, 999588447, 645011646, 3469603876, 3657151690, 2477958807, 286833025,
            1802487901, 2709688493, 2318425877, 3516543869,
        ],
        &[
            3866576925, 1873138890, 1768109056, 2705255084, 4241776445, 658244374, 286815054,
            153522406, 2020517918, 87408861, 541283899, 2327698817, 696800449, 1357243166,
            2373189783,
        ],
        &[
            1748815118, 2402822363, 2091637344, 2074482742, 2316188658, 2370992052, 3607116276,
            2077769165, 1723590682, 2807481888, 338472032, 1807369086, 4009280963, 3941733223,
            1094544382,
        ],
    );
    test(
        &[0; 7],
        &[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        &[0, 0, 0, 1, 0, 2147483648],
        &[0, 0, 0, 4294967289, 4294967295, 2147483647],
    );
    test(
        &[
            2516900350, 3628420684, 45459239, 1513614219, 989392388, 453507217, 1512254264,
            2426221826, 1233076550, 244898124, 2764583004, 3329101881, 1699874673, 3208045667,
            2210327365, 948719692, 29636434, 309163724, 626642377, 3476255186, 2213282765,
            3561515942, 4189534597, 950518908, 139348404, 1259661856, 694161725, 2634491186,
            3727710582, 788362676, 3045474119, 4091304988, 2805201294, 3987583308, 1169494314,
            1793738933, 1926962859, 143323906, 3767356737, 2736821279, 3155234958, 369913573,
            2104538395, 1964464892, 120182245, 1607533355, 3512159772, 428709975, 3273911427,
            1151542509, 2860816013, 1136173381, 662332459, 3578077057, 3243603823, 818341966,
            1912641848, 3483224197, 605429894, 746864868, 3712846888, 2818736253, 462940792,
            3732576280, 1660947800, 1011233610, 843846147, 2308498613, 1878649446, 1442264468,
            2962205673, 2832862233, 1244894861, 1156622958, 1582973750, 1574948490, 3846938629,
            935089728, 1705244040, 4043433438, 3114254174, 1062986960, 3905677705, 1930766407,
            1354562200, 955778452, 2932639939, 249007379, 3763599833, 32702674, 3759419411,
            4281057196, 1688108074, 3861261668, 444663411, 2875533494, 971084229, 1671724356,
            681694042, 1336342690, 3989885039, 3351736702, 3656186109, 2518436399, 3272921467,
            235621572, 641659042, 2119882595, 1983842751, 1488017726, 3187465143, 2506358055,
            3348535321, 999852594, 4293611527, 1073384603, 250481194, 4148825621, 3839501948,
            3818994640, 1414056232, 2701465891, 499495991, 1361504858, 1308748876, 1650859371,
            3722040369, 223548436, 2431095012, 3829963049, 367284736, 451104830, 3192609374,
            959276880, 2266256342, 4176815348, 3580491737, 674113379, 4084740134, 883805748,
            892822580, 2297912891, 2348080766, 3777075710, 2743249275, 1929349295, 2464988855,
            1327032420, 1398791640, 2085211945, 889984414, 883598216, 1429348413, 154972877,
            3622910749, 1670306325, 2187005411, 651154286, 2688016708, 1041316505, 2776658464,
            161390395, 3846865057, 3267383835, 1010302540, 3607316170, 1418199870, 3954492322,
            922710287, 1323651551, 2431904946, 3054195005, 902509698, 1670133092, 1092971517,
            1075109776,
        ],
        &[
            1426636939, 2291732338, 3067548371, 1958595483, 4265832187, 1189668824, 2839754982,
            3301139255, 530760593, 3029188645, 1298922175, 1055363550, 2070850046, 992858009,
            1206997984, 1510007185, 2204463849, 2600547912, 3402640587, 372285673, 54684613,
            211924658, 2690037178, 1114469505, 374316665, 319939537, 1363579227, 25099128,
            2808696886, 2318162131, 1283473588, 4173665536, 1302236115, 2981103428, 364658024,
            3500679214, 73401477, 2399140443, 2401409782, 974668784, 3260945138, 700031094,
            619920306, 2267288646, 225106679, 2520705554, 760523499, 2971006600, 2155228491,
            967349835, 2899641188, 2567983244, 1086821788, 208644014, 2327565301, 3873773388,
            1254243651, 3371628757, 1486945462, 3153661571, 3596439034, 3448680976, 2884772533,
            2113693162, 3571562346, 3271064301, 2352298427, 2624271304, 2147301202, 1628031526,
            2268489536, 2460058239, 3824853526, 1114448457, 1711950597, 2805133745, 3886047152,
            1482425544, 3015333985, 1726209429, 1945238011, 2536476005, 1974758758, 3373425305,
            2797746190, 1649833243, 2549697741, 2772403629, 1276934258, 1197267921, 480328120,
            3145095762, 647795990, 605209910, 1896440782, 2021024361, 4280085434, 384535302,
            228210377, 1342562609, 550195641, 304643910, 803682708, 2640613597, 214734489,
            3610647775, 3787633026, 3169459037, 2718345417, 1486978425, 4213419405, 2452166506,
            2369416903, 2146131022, 3632701374, 857903632, 2077812289, 2633196639, 1727541399,
            1445819648, 1663740433, 2573746586, 150961985, 2843003920, 2121435332, 503235641,
            2162411412, 2641993335, 2306838455, 3013627797, 187911601, 2832638744, 3245525711,
            4114681913, 4248626985, 892023341, 4180070411, 462293938, 2339665566, 886499165,
            2680618581, 1275413281, 1653569893, 3506841220, 805196234, 2798162194, 2468871331,
            3396930973, 2515921922, 897743120, 2034157178, 2373161268, 3355723218, 3914014661,
            994426990, 2992401161, 2581503631, 697892172, 82419160, 2053001658, 3320533046,
            3791389127, 1839288008, 270908689, 1413534997, 429338594, 997502210, 3103236226,
            2401510054, 2663896427, 3727426794, 2724686279, 3944143754,
        ],
        &[
            3845376373, 2532376922, 273377135, 3677509657, 2349096840, 865593650, 3913447585,
            3605798835, 2383627001, 256434907, 1598943794, 582857664, 2095029213, 493203050,
            4072709797, 2373943493, 3435129133, 3493851471, 1582101091, 2328189763, 853133742,
            2400321806, 3544763029, 3255311766, 2487877428, 2345846021, 3540974504, 1867377852,
            2499885368, 3386759756, 3964579463, 3290899719, 2797957335, 2863338106, 3380325251,
            1361967176, 2820693326, 1270065483, 2316076985, 20080038, 2796142674, 1493193006,
            3582143536, 1315905237, 884491638, 2352205614, 3522766470, 1928358187, 1698951621,
            4079830723, 3210021170, 3465329392, 3919799352, 4222905913, 255999498, 707431500,
            4259794201, 604859264, 3884712299, 2790776367, 3466495862, 1352500875, 1421557254,
            3449668508, 339288181, 2600471637, 2364459698, 1593691125, 3908068568, 1590428078,
            3967743945, 361284513, 1947639764, 2146594709, 698658216, 2934691142, 3852641925,
            2677524346, 3136105113, 3755616420, 393422782, 4055467971, 836734774, 1342622278,
            1842869702, 3646198604, 3250586544, 1155965487, 3143510276, 264136749, 764849704,
            2833843864, 3628999351, 1603529516, 3414178524, 2241268229, 1653241000, 3792840587,
        ],
        &[
            2033854275, 3346500754, 1026391195, 2931755468, 4132970223, 507488150, 3787819697,
            4267307150, 2229023955, 3535124792, 2115982537, 3261552465, 1403786253, 4168838966,
            2905077003, 3343366362, 4058434477, 3051762274, 2754465216, 2139644668, 2121257326,
            147231635, 1411313351, 1942773925, 1518792733, 4026871852, 1608765600, 2674641821,
            3388658059, 4045496133, 4161170911, 1328400056, 1288717066, 741487928, 2130937044,
            3073981280, 486422437, 2174741216, 4004413829, 1284627600, 1179437164, 1177246499,
            2634583310, 2950709339, 3500520165, 502702338, 3556716680, 3168781392, 201139498,
            1773610178, 1336109110, 75169920, 4261358748, 3946913462, 1177416531, 1904421971,
            529501654, 760059661, 2718436151, 1695275660, 769729199, 1160292778, 1476806846,
            913674448, 1863234151, 2549859956, 2693241338, 2672780028, 1641057282, 3939169714,
            1414934690, 318354912, 300864018, 400872379, 1081977009, 3047385148, 3103660917,
            175274494, 1331622900, 1558233166, 3851938640, 205628404, 992837552, 615234521,
            3588694980, 848421132, 513268312, 468730797, 1030322804, 1991013271, 1629772980,
            3351179781, 2259742484, 957712992, 1217297297, 2285959262, 947300257, 3115413281,
        ],
    );
}

#[test]
#[should_panic]
fn limbs_mod_divide_and_conquer_fail_1() {
    let ds = &[3, 4, 5, 6, 0x8000_0000];
    let inverse = limbs_two_limb_inverse_helper(ds[ds.len() - 1], ds[ds.len() - 2]);
    _limbs_mod_divide_and_conquer(&mut [10; 4], &mut [1, 2, 3, 4, 5, 6, 7, 8, 9], ds, inverse);
}

#[test]
#[should_panic]
fn limbs_mod_divide_and_conquer_fail_2() {
    let ds = &[3, 4, 5, 6, 7, 0x8000_0000];
    let inverse = limbs_two_limb_inverse_helper(ds[ds.len() - 1], ds[ds.len() - 2]);
    _limbs_mod_divide_and_conquer(&mut [10; 4], &mut [1, 2, 3, 4, 5, 6, 7, 8], ds, inverse);
}

#[test]
#[should_panic]
fn limbs_mod_divide_and_conquer_fail_3() {
    let ds = &[3, 4, 5, 6, 7, 8];
    let inverse = limbs_two_limb_inverse_helper(ds[ds.len() - 1], ds[ds.len() - 2]);
    _limbs_mod_divide_and_conquer(&mut [10; 4], &mut [1, 2, 3, 4, 5, 6, 7, 8, 9], ds, inverse);
}

#[test]
fn test_div_mod() {
    let test = |u, v, remainder| {
        let mut x = Natural::from_str(u).unwrap();
        x.mod_assign(Natural::from_str(v).unwrap());
        assert!(x.is_valid());
        assert_eq!(x.to_string(), remainder);

        let mut x = Natural::from_str(u).unwrap();
        x.mod_assign(&Natural::from_str(v).unwrap());
        assert!(x.is_valid());
        assert_eq!(x.to_string(), remainder);

        let r = Natural::from_str(u)
            .unwrap()
            .mod_op(Natural::from_str(v).unwrap());
        assert!(r.is_valid());
        assert_eq!(r.to_string(), remainder);

        let r = Natural::from_str(u)
            .unwrap()
            .mod_op(&Natural::from_str(v).unwrap());
        assert!(r.is_valid());
        assert_eq!(r.to_string(), remainder);

        let r = (&Natural::from_str(u).unwrap()).mod_op(Natural::from_str(v).unwrap());
        assert!(r.is_valid());
        assert_eq!(r.to_string(), remainder);

        let r = (&Natural::from_str(u).unwrap()).mod_op(&Natural::from_str(v).unwrap());
        assert!(r.is_valid());
        assert_eq!(r.to_string(), remainder);

        let mut x = Natural::from_str(u).unwrap();
        x %= Natural::from_str(v).unwrap();
        assert!(x.is_valid());
        assert_eq!(x.to_string(), remainder);

        let mut x = Natural::from_str(u).unwrap();
        x %= &Natural::from_str(v).unwrap();
        assert!(x.is_valid());
        assert_eq!(x.to_string(), remainder);

        let r = Natural::from_str(u).unwrap() % Natural::from_str(v).unwrap();
        assert!(r.is_valid());
        assert_eq!(r.to_string(), remainder);

        let r = Natural::from_str(u).unwrap() % &Natural::from_str(v).unwrap();
        assert!(r.is_valid());
        assert_eq!(r.to_string(), remainder);

        let r = &Natural::from_str(u).unwrap() % Natural::from_str(v).unwrap();
        assert!(r.is_valid());
        assert_eq!(r.to_string(), remainder);

        let r = &Natural::from_str(u).unwrap() % &Natural::from_str(v).unwrap();
        assert!(r.is_valid());
        assert_eq!(r.to_string(), remainder);

        let r = BigUint::from_str(u)
            .unwrap()
            .mod_floor(&BigUint::from_str(v).unwrap());
        assert_eq!(r.to_string(), remainder);

        let r = BigUint::from_str(u).unwrap() % &BigUint::from_str(v).unwrap();
        assert_eq!(r.to_string(), remainder);

        let r = rug::Integer::from_str(u)
            .unwrap()
            .rem_floor(rug::Integer::from_str(v).unwrap());
        assert_eq!(r.to_string(), remainder);

        let r = rug::Integer::from_str(u).unwrap() % rug::Integer::from_str(v).unwrap();
        assert_eq!(r.to_string(), remainder);

        assert_eq!(
            Natural::from_str(u)
                .unwrap()
                .div_mod(Natural::from_str(v).unwrap())
                .1
                .to_string(),
            remainder
        );
    };
    test("0", "1", "0");
    test("0", "123", "0");
    test("1", "1", "0");
    test("123", "1", "0");
    test("123", "123", "0");
    test("123", "456", "123");
    test("456", "123", "87");
    test("4294967295", "4294967295", "0");
    test("4294967295", "4294967295", "0");
    test("1000000000000", "1", "0");
    test("1000000000000", "3", "1");
    test("1000000000000", "123", "100");
    test("1000000000000", "4294967295", "3567587560");
    test("1000000000000000000000000", "1", "0");
    test("1000000000000000000000000", "3", "1");
    test("1000000000000000000000000", "123", "37");
    test("1000000000000000000000000", "4294967295", "3167723695");
    test("1000000000000000000000000", "1234567890987", "530068894399");
    test(
        "100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\
        0",
        "1234567890987654321234567890987654321",
        "779655053998040854338961591319296066",
    );
    test(
        "100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\
        0",
        "316049380092839506236049380092839506176",
        "37816691783627670491375998320948925696",
    );
    test(
        "253640751230376270397812803167",
        "2669936877441",
        "1520301762334",
    );
    test(
        "3768477692975601",
        "11447376614057827956",
        "3768477692975601",
    );
    test("3356605361737854", "3081095617839357", "275509743898497");
    test(
        "1098730198198174614195",
        "953382298040157850476",
        "145347900158016763719",
    );
    test(
        "69738658860594537152875081748",
        "69738658860594537152875081748",
        "0",
    );
    test(
        "1000000000000000000000000",
        "1000000000000000000000000",
        "0",
    );
    test("0", "1000000000000000000000000", "0");
    test("123", "1000000000000000000000000", "123");
}

#[test]
#[should_panic]
fn mod_assign_fail() {
    Natural::from(10u32).mod_assign(Natural::ZERO);
}

#[test]
#[should_panic]
fn mod_assign_ref_fail() {
    Natural::from(10u32).mod_assign(&Natural::ZERO);
}

#[test]
#[should_panic]
fn mod_fail() {
    Natural::from(10u32).mod_op(Natural::ZERO);
}

#[test]
#[should_panic]
fn mod_val_ref_fail() {
    Natural::from(10u32).mod_op(&Natural::ZERO);
}

#[test]
#[should_panic]
fn mod_ref_val_fail() {
    (&Natural::from(10u32)).mod_op(Natural::ZERO);
}

#[test]
#[should_panic]
fn mod_ref_ref_fail() {
    (&Natural::from(10u32)).mod_op(&Natural::ZERO);
}

#[test]
#[should_panic]
fn rem_assign_fail() {
    let mut n = Natural::from(10u32);
    n %= Natural::ZERO;
}

#[test]
#[should_panic]
fn div_rem_assign_ref_fail() {
    let mut n = Natural::from(10u32);
    n %= &Natural::ZERO;
}

#[test]
#[should_panic]
#[allow(unused_must_use)]
fn rem_fail() {
    Natural::from(10u32) % Natural::ZERO;
}

#[test]
#[should_panic]
#[allow(unused_must_use)]
fn rem_val_ref_fail() {
    Natural::from(10u32) % &Natural::ZERO;
}

#[test]
#[should_panic]
#[allow(unused_must_use)]
fn rem_ref_val_fail() {
    &Natural::from(10u32) % Natural::ZERO;
}

#[test]
#[should_panic]
#[allow(unused_must_use)]
fn rem_ref_ref_fail() {
    &Natural::from(10u32) % &Natural::ZERO;
}

#[test]
fn test_neg_mod() {
    let test = |u, v, remainder| {
        let mut x = Natural::from_str(u).unwrap();
        x.neg_mod_assign(Natural::from_str(v).unwrap());
        assert!(x.is_valid());
        assert_eq!(x.to_string(), remainder);

        let mut x = Natural::from_str(u).unwrap();
        x.neg_mod_assign(&Natural::from_str(v).unwrap());
        assert!(x.is_valid());
        assert_eq!(x.to_string(), remainder);

        let r = Natural::from_str(u)
            .unwrap()
            .neg_mod(Natural::from_str(v).unwrap());
        assert!(r.is_valid());
        assert_eq!(r.to_string(), remainder);

        let r = Natural::from_str(u)
            .unwrap()
            .neg_mod(&Natural::from_str(v).unwrap());
        assert!(r.is_valid());
        assert_eq!(r.to_string(), remainder);

        let r = (&Natural::from_str(u).unwrap()).neg_mod(Natural::from_str(v).unwrap());
        assert!(r.is_valid());
        assert_eq!(r.to_string(), remainder);

        let r = (&Natural::from_str(u).unwrap()).neg_mod(&Natural::from_str(v).unwrap());
        assert!(r.is_valid());
        assert_eq!(r.to_string(), remainder);

        let r = rug_neg_mod(
            rug::Integer::from_str(u).unwrap(),
            rug::Integer::from_str(v).unwrap(),
        );
        assert_eq!(r.to_string(), remainder);

        assert_eq!(
            Natural::from_str(u)
                .unwrap()
                .ceiling_div_neg_mod(Natural::from_str(v).unwrap())
                .1
                .to_string(),
            remainder
        );
    };
    test("0", "1", "0");
    test("0", "123", "0");
    test("1", "1", "0");
    test("123", "1", "0");
    test("123", "123", "0");
    test("123", "456", "333");
    test("456", "123", "36");
    test("4294967295", "1", "0");
    test("4294967295", "4294967295", "0");
    test("1000000000000", "1", "0");
    test("1000000000000", "3", "2");
    test("1000000000000", "123", "23");
    test("1000000000000", "4294967295", "727379735");
    test("1000000000000000000000000", "1", "0");
    test("1000000000000000000000000", "3", "2");
    test("1000000000000000000000000", "123", "86");
    test("1000000000000000000000000", "4294967295", "1127243600");
    test("1000000000000000000000000", "1234567890987", "704498996588");
    test(
        "10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\
         00",
        "1234567890987654321234567890987654321",
        "454912836989613466895606299668358255",
    );
    test(
        "10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\
         00",
        "316049380092839506236049380092839506176",
        "278232688309211835744673381771890580480",
    );
    test(
        "253640751230376270397812803167",
        "2669936877441",
        "1149635115107",
    );
    test(
        "3768477692975601",
        "11447376614057827956",
        "11443608136364852355",
    );
    test("3356605361737854", "3081095617839357", "2805585873940860");
    test(
        "1098730198198174614195",
        "953382298040157850476",
        "808034397882141086757",
    );
    test(
        "69738658860594537152875081748",
        "69738658860594537152875081748",
        "0",
    );
    test(
        "1000000000000000000000000",
        "1000000000000000000000000",
        "0",
    );
    test("0", "1000000000000000000000000", "0");
    test(
        "123",
        "1000000000000000000000000",
        "999999999999999999999877",
    );
}

#[test]
#[should_panic]
fn neg_mod_assign_fail() {
    Natural::from(10u32).neg_mod_assign(Natural::ZERO);
}

#[test]
#[should_panic]
fn neg_mod_assign_ref_fail() {
    Natural::from(10u32).neg_mod_assign(&Natural::ZERO);
}

#[test]
#[should_panic]
fn neg_mod_fail() {
    Natural::from(10u32).neg_mod(Natural::ZERO);
}

#[test]
#[should_panic]
fn neg_mod_val_ref_fail() {
    Natural::from(10u32).neg_mod(&Natural::ZERO);
}

#[test]
#[should_panic]
fn neg_mod_ref_val_fail() {
    (&Natural::from(10u32)).neg_mod(Natural::ZERO);
}

#[test]
#[should_panic]
fn neg_mod_ref_ref_fail() {
    (&Natural::from(10u32)).neg_mod(&Natural::ZERO);
}

#[test]
fn limbs_mod_three_limb_by_two_limb_properties() {
    test_properties(
        sextuples_of_limbs_var_1,
        |&(n_2, n_1, n_0, d_1, d_0, inverse)| {
            let r = limbs_mod_three_limb_by_two_limb(n_2, n_1, n_0, d_1, d_0, inverse);
            verify_limbs_mod_three_limb_by_two_limb(n_2, n_1, n_0, d_1, d_0, r);
        },
    );
}

#[test]
fn limbs_mod_by_two_limb_normalized_properties() {
    test_properties(pairs_of_unsigned_vec_var_10, |(ns, ds)| {
        let (r_0, r_1) = limbs_mod_by_two_limb_normalized(&ns, &ds);
        verify_limbs_mod_by_two_limb_normalized(&ns, &ds, r_0, r_1);
    });
}

#[test]
fn limbs_mod_schoolbook_properties() {
    test_properties(
        triples_of_two_unsigned_vecs_and_unsigned_var_1,
        |(ref ns_in, ref ds, inverse)| {
            let mut ns = ns_in.clone();
            _limbs_mod_schoolbook(&mut ns, ds, *inverse);
            verify_limbs_mod(ns_in, ds, &ns);
        },
    );
}

#[test]
fn limbs_mod_divide_and_conquer_properties() {
    test_properties_custom_scale(
        128,
        quadruples_of_three_unsigned_vecs_and_unsigned_var_2,
        |(ref qs_in, ref ns_in, ref ds, inverse)| {
            let mut qs = qs_in.clone();
            let mut ns = ns_in.clone();
            _limbs_mod_divide_and_conquer(&mut qs, &mut ns, ds, *inverse);
            verify_limbs_mod(ns_in, ds, &ns);
        },
    );
}

fn mod_properties_helper(x: &Natural, y: &Natural) {
    let mut mut_x = x.clone();
    mut_x.mod_assign(y);
    assert!(mut_x.is_valid());
    let remainder = mut_x;

    let mut mut_x = x.clone();
    mut_x.mod_assign(y.clone());
    let remainder_alt = mut_x;
    assert!(remainder_alt.is_valid());
    assert_eq!(remainder_alt, remainder);

    let remainder_alt = x.mod_op(y);
    assert!(remainder_alt.is_valid());
    assert_eq!(remainder_alt, remainder);

    let remainder_alt = x.mod_op(y.clone());
    assert!(remainder_alt.is_valid());
    assert_eq!(remainder_alt, remainder);

    let remainder_alt = x.clone().mod_op(y);
    assert!(remainder_alt.is_valid());
    assert_eq!(remainder_alt, remainder);

    let remainder_alt = x.clone().mod_op(y.clone());
    assert!(remainder_alt.is_valid());
    assert_eq!(remainder_alt, remainder);

    let mut remainder_alt = x.clone();
    remainder_alt %= y;
    assert!(remainder_alt.is_valid());
    assert_eq!(remainder_alt, remainder);

    let mut remainder_alt = x.clone();
    remainder_alt %= y.clone();
    assert!(remainder_alt.is_valid());
    assert_eq!(remainder_alt, remainder);

    let remainder_alt = x % y;
    assert!(remainder_alt.is_valid());
    assert_eq!(remainder_alt, remainder);

    let remainder_alt = x % y.clone();
    assert!(remainder_alt.is_valid());
    assert_eq!(remainder_alt, remainder);

    let remainder_alt = x.clone() % y;
    assert!(remainder_alt.is_valid());
    assert_eq!(remainder_alt, remainder);

    let remainder_alt = x.clone() % y.clone();
    assert!(remainder_alt.is_valid());
    assert_eq!(remainder_alt, remainder);

    let remainder_alt = x.div_mod(y).1;
    assert_eq!(remainder_alt, remainder);

    let num_remainder = natural_to_biguint(x).mod_floor(&natural_to_biguint(y));
    assert_eq!(biguint_to_natural(&num_remainder), remainder);

    let num_remainder = natural_to_biguint(x) % &natural_to_biguint(y);
    assert_eq!(biguint_to_natural(&num_remainder), remainder);

    let rug_remainder = natural_to_rug_integer(x).rem_floor(natural_to_rug_integer(y));
    assert_eq!(rug_integer_to_natural(&rug_remainder), remainder);

    let rug_remainder = natural_to_rug_integer(x) % natural_to_rug_integer(y);
    assert_eq!(rug_integer_to_natural(&rug_remainder), remainder);

    assert!(remainder < *y);
    assert_eq!(&remainder % y, remainder);
}

#[test]
fn div_mod_properties() {
    test_properties_custom_scale(
        512,
        pairs_of_natural_and_positive_natural,
        |&(ref x, ref y)| {
            mod_properties_helper(x, y);
        },
    );

    test_properties_custom_scale(
        512,
        pairs_of_natural_and_positive_natural_var_1,
        |&(ref x, ref y)| {
            mod_properties_helper(x, y);
        },
    );

    test_properties(naturals, |n| {
        assert_eq!(n % Natural::ONE, 0 as Limb);
    });

    test_properties(positive_naturals, |n| {
        assert_eq!(n % n, 0 as Limb);
        assert_eq!(Natural::ZERO % n, 0 as Limb);
        if *n > 1 as Limb {
            assert_eq!(Natural::ONE % n, 1 as Limb);
        }
    });

    test_properties(
        triples_of_natural_natural_and_positive_natural,
        |&(ref x, ref y, ref z)| {
            assert_eq!((x + y) % z, (x % z + y % z) % z);
            assert_eq!(x * y % z, (x % z) * (y % z) % z);
        },
    );

    test_properties(
        pairs_of_natural_and_positive_unsigned,
        |&(ref n, u): &(Natural, Limb)| {
            assert_eq!(n % u, n % Natural::from(u));
        },
    );

    test_properties(
        pairs_of_unsigned_and_positive_natural,
        |&(u, ref n): &(Limb, Natural)| {
            assert_eq!(u % n, Natural::from(u) % n);
        },
    );
}

fn neg_mod_properties_helper(x: &Natural, y: &Natural) {
    let mut mut_x = x.clone();
    mut_x.neg_mod_assign(y);
    assert!(mut_x.is_valid());
    let remainder = mut_x;

    let mut mut_x = x.clone();
    mut_x.neg_mod_assign(y.clone());
    let remainder_alt = mut_x;
    assert!(remainder_alt.is_valid());
    assert_eq!(remainder_alt, remainder);

    let remainder_alt = x.neg_mod(y);
    assert!(remainder_alt.is_valid());
    assert_eq!(remainder_alt, remainder);

    let remainder_alt = x.neg_mod(y.clone());
    assert!(remainder_alt.is_valid());
    assert_eq!(remainder_alt, remainder);

    let remainder_alt = x.clone().neg_mod(y);
    assert!(remainder_alt.is_valid());
    assert_eq!(remainder_alt, remainder);

    let remainder_alt = x.clone().neg_mod(y.clone());
    assert!(remainder_alt.is_valid());
    assert_eq!(remainder_alt, remainder);

    //TODO
    /*
    let (quotient_alt, remainder_alt) = (x.div_round(y, RoundingMode::Ceiling), x.neg_mod(y));
    assert_eq!(quotient_alt, quotient);
    assert_eq!(remainder_alt, remainder);
    */

    let rug_remainder = rug_neg_mod(natural_to_rug_integer(x), natural_to_rug_integer(y));
    assert_eq!(rug_integer_to_natural(&rug_remainder), remainder);

    assert!(remainder < *y);
}

#[test]
fn neg_mod_properties() {
    test_properties(pairs_of_natural_and_positive_natural, |&(ref x, ref y)| {
        neg_mod_properties_helper(x, y);
    });

    test_properties(
        pairs_of_natural_and_positive_natural_var_1,
        |&(ref x, ref y)| {
            neg_mod_properties_helper(x, y);
        },
    );

    test_properties(naturals, |n| {
        assert_eq!(n.neg_mod(Natural::ONE), 0 as Limb);
    });

    test_properties(positive_naturals, |n| {
        assert_eq!(n.neg_mod(n), 0 as Limb);
        assert_eq!(Natural::ZERO.neg_mod(n), 0 as Limb);
        assert_eq!(Natural::ONE.neg_mod(n), n - 1 as Limb);
    });

    test_properties(
        triples_of_natural_natural_and_positive_natural,
        |&(ref x, ref y, ref z)| {
            assert_eq!((x + y).neg_mod(z), (x % z + y % z).neg_mod(z));
            assert_eq!((x * y).neg_mod(z), ((x % z) * (y % z)).neg_mod(z));
        },
    );

    test_properties(
        pairs_of_natural_and_positive_unsigned,
        |&(ref n, u): &(Natural, Limb)| {
            assert_eq!(n.neg_mod(u), n.neg_mod(Natural::from(u)));
        },
    );

    test_properties(
        pairs_of_unsigned_and_positive_natural,
        |&(u, ref n): &(Limb, Natural)| {
            assert_eq!(u.neg_mod(n), Natural::from(u).neg_mod(n));
        },
    );
}
